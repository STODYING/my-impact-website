<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IMPACT â€“ MAKE A IMPACT</title>
  <meta name="description" content="IMPACT â€“ ì¹´í…Œê³ ë¦¬ í€µë‚´ë¹„, ì§„í–‰ë¥  ë°”, ê´€ë ¨ê¸€, í˜ì´ì§€ë„¤ì´ì…˜, ë‹¤í¬ëª¨ë“œ ì§€ì›">

  <link rel="icon" href="logo.png" type="image/png">
  <link rel="apple-touch-icon" href="logo.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="IMPACT">

  <style>
  /* ===========================
     ìƒ‰ìƒ í† í° & ë‹¤í¬ ëª¨ë“œ
     =========================== */
  :root{
    --bg: #f6f7f9;
    --text: #111;
    --muted: #666;
    --card: #fff;
    --border: rgba(0,0,0,0.08);
    --shadow: rgba(0,0,0,0.06);
    --accent: #2e8b57;
    --overlay: #fff;
    --progress: #ff7a1a;
  }
  
  [data-theme="dark"]{
    --bg: #0f1115;
    --text: #f1f3f5;
    --muted: #a6adbb;
    --card: #171a21;
    --border: rgba(255,255,255,0.08);
    --shadow: rgba(0,0,0,0.35);
    --accent: #39c07c;
    --overlay: #12151b;
    --progress: #ff9f45;
  }
  
  [data-theme="dark"] img, 
  [data-theme="dark"] video { 
    filter: none !important; 
  }

  /* ===========================
     ê¸°ë³¸/ë¦¬ì…‹
     =========================== */
  *, *::before, *::after { box-sizing: border-box; }
  html, body { height: 100%; }
  body{
    margin:0; background:var(--bg); color:var(--text); line-height:1.6;
    font-family:"Noto Sans KR","Apple SD Gothic Neo","Segoe UI",Roboto,Arial,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    scroll-behavior:smooth; overscroll-behavior-y:contain; -webkit-tap-highlight-color:transparent;
    overflow-x: hidden;
  }
  a{ color:inherit; text-decoration:none; }
  img{ display:block; max-width:100%; height:auto; }
  input[type="search"]::-webkit-search-cancel-button{ cursor:pointer; }

  .wrap{ max-width:1400px; margin:0 auto; padding:0 20px; }
  .hidden{ display:none !important; }
  .visually-hidden{
    position:absolute !important; height:1px; width:1px; overflow:hidden;
    clip:rect(1px,1px,1px,1px); white-space:nowrap;
  }

  /* ===========================
     HEADER
     =========================== */
  header.header{
    position:sticky; top:0; z-index:1200; background:var(--card);
    border-bottom:1px solid var(--border); backdrop-filter: blur(6px);
    transition: box-shadow .25s ease, transform .18s ease;
  }
  .header-inner{
    height:72px; display:flex; align-items:center; gap:16px;
    max-width:1400px; margin:0 auto; padding:0 20px;
    justify-content: space-between;
  }
  .brand{ display:flex; align-items:center; gap:12px; }
  .brand .logo{
    display:flex; gap:8px; align-items:center; font-weight:900; font-size:26px; letter-spacing:1px; cursor:pointer;
  }
  .brand .logo small{ font-size:11px; color:var(--muted); font-weight:800; display:block; line-height:1; }

  .header-actions{ display:flex; gap:8px; align-items:center; }
  
  .icon-btn{
    background:none; border:none; color:var(--text); cursor:pointer; 
    font-size:20px; padding:8px; display:flex; align-items:center; justify-content:center;
  }
  
  .hamburger-icon {
    width:24px; height:24px; position:relative; display:inline-block;
  }
  .hamburger-icon span,
  .hamburger-icon span::before,
  .hamburger-icon span::after {
    display:block; position:absolute; height:2px; width:20px;
    background:var(--text); border-radius:2px;
  }
  .hamburger-icon span { top:50%; transform:translateY(-50%); }
  .hamburger-icon span::before { content:''; top:-7px; }
  .hamburger-icon span::after { content:''; top:7px; }

  /* ===========================
     NAV OVERLAY
     =========================== */
  .nav-overlay{
    position:fixed; top:0; right:-50%; width:50%; height:100vh;
    background:var(--overlay); z-index:2200; transition:right .32s cubic-bezier(.2,.9,.2,1), visibility 0s .32s, opacity .32s;
    display:flex; flex-direction:column; padding:64px 40px; box-shadow:-6px 0 40px var(--shadow);
    visibility:hidden; opacity:0; color:var(--text);
  }
  .nav-overlay.active{ right:0; visibility:visible; opacity:1; transition:right .32s cubic-bezier(.2,.9,.2,1), visibility 0s, opacity .32s; }
  .nav-close{ position:absolute; top:28px; right:28px; background:none; border:none; font-size:30px; cursor:pointer; color:var(--text); z-index:2300; }
  .nav-search{ display:flex; align-items:center; gap:10px; margin-bottom:36px; }
  .nav-search input[type="search"]{ flex:1; border:none; border-bottom:2px solid var(--text); padding:10px 8px; outline:none; font-weight:700; font-size:16px; background:transparent; color:var(--text); }
  .nav-list{ list-style:none; padding:0; margin:0 0 24px; display:flex; flex-direction:column; gap:18px; }
  .nav-list li{ font-size:28px; font-weight:900; cursor:pointer; color:var(--text); transition: color .16s ease; }
  .nav-list li:hover{ color:var(--accent); }
  .nav-footer-links{ margin-top:auto; display:flex; gap:12px; align-items:center; font-weight:800; flex-wrap:wrap; }
  .nav-footer-links a{ color:var(--text); font-size:13px; cursor:pointer; }
  
  /* í…Œë§ˆ ì „í™˜ ë²„íŠ¼ */
  .theme-toggle {
    position:absolute; bottom:40px; left:40px;
    background:var(--card); border:1px solid var(--border); 
    border-radius:8px; padding:8px 12px; cursor:pointer;
    display:flex; align-items:center; gap:6px;
    font-weight:700; font-size:14px; color:var(--text);
    transition: transform .12s ease;
  }
  .theme-toggle:hover { transform:translateY(-2px); box-shadow:0 4px 12px var(--shadow); }

  @media (max-width:680px){
    .nav-overlay{ left:0; right:-100%; width:100%; padding:36px 20px; box-shadow:none; }
    .nav-overlay.active{ right:0; left:0; }
    .nav-list li{ font-size:22px; }
    .nav-close{ top:20px; right:20px; }
    .theme-toggle{ bottom:20px; left:20px; }
  }

  /* ===========================
     HOME
     =========================== */
  .home{ max-width:1400px; margin:28px auto; display:flex; flex-direction:column; gap:28px; padding:0 20px 40px; }
  
  /* PC: ì™¼ìª½ í°ì¹´ë“œ + ì˜¤ë¥¸ìª½ 4ê°œ ì‘ì€ì¹´ë“œ / ë°˜ëŒ€ íŒ¨í„´ */
  .row{ 
    display:grid; 
    grid-template-columns:2fr 1fr; 
    gap:20px; 
    align-items:start; 
    margin-bottom:20px;
  }
  .row.reverse { 
    grid-template-columns:1fr 2fr; 
  }
  
  .col-hero{ 
    position:relative; 
    border-radius:12px; 
    overflow:hidden; 
    min-height:500px; 
    background:#222; 
    cursor:pointer; 
  }
  .col-hero .hero{ 
    width:100%; 
    height:100%; 
    object-fit:cover; 
    display:block; 
    min-height:500px; 
  }
  .col-hero .hero-overlay{
    position:absolute; 
    inset:auto 0 0 0; 
    padding:22px; 
    display:flex; 
    flex-direction:column; 
    gap:12px;
    background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,0.55)); 
    color:#fff;
  }
  .col-hero .hero-title{ 
    margin:0; 
    font-size:28px; 
    font-weight:900; 
    line-height:1.05; 
    max-width:92%; 
  }
  
  .col-cards{ 
    display:flex; 
    flex-direction:column; 
    gap:12px; 
    height:500px;
    overflow-y:auto;
    padding-right:8px;
  }
  
  /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
  .col-cards::-webkit-scrollbar { width:6px; }
  .col-cards::-webkit-scrollbar-track { background:var(--border); border-radius:3px; }
  .col-cards::-webkit-scrollbar-thumb { background:var(--muted); border-radius:3px; }
  .col-cards::-webkit-scrollbar-thumb:hover { background:var(--accent); }

  .card{ 
    background:var(--card); 
    border-radius:10px; 
    overflow:hidden; 
    border:1px solid var(--border);
    transition: box-shadow .16s ease, transform .12s ease; 
    cursor:pointer; 
    position:relative; 
    z-index:1; 
    color:var(--text); 
  }
  .card:hover{ 
    transform:translateY(-6px); 
    box-shadow:0 12px 30px var(--shadow); 
  }
  .card .thumb{ 
    width:100%; 
    height:120px; 
    overflow:hidden; 
    background:#2b2f36; 
  }
  .card .thumb img{ 
    width:100%; 
    height:100%; 
    object-fit:cover; 
    display:block; 
  }
  .card .card-body{ padding:12px; }
  .card h3{ 
    font-size:16px; 
    font-weight:800; 
    margin:0 0 8px; 
    color:var(--text); 
  }
  
  .cat-badge{ 
    display:inline-block; 
    padding:6px 10px; 
    border-radius:6px; 
    font-weight:800; 
    font-size:12px; 
    color:#fff; 
  }
  .hero-cats{ 
    position:absolute; 
    right:16px; 
    bottom:16px; 
    display:flex; 
    gap:6px; 
  }
  .cat-tech{ background:#1e90ff; } 
  .cat-eat{ background:#ff6347; }
  .cat-style{ background:#32cd32; } 
  .cat-culture{ background:#8a2be2; }
  .cat-life{ background:#ffa500; color:#000; } 
  .cat-editors-pick{ background:#ff1493; }

  /* í˜ì´ì§€ë„¤ì´ì…˜ */
  .pager{ 
    display:flex; 
    justify-content:center; 
    align-items:center; 
    gap:8px; 
    padding:18px 0 8px; 
    flex-wrap:wrap; 
    color:var(--text);
  }
  .pager a, .pager button{
    background:var(--card); 
    border:1px solid var(--border); 
    color:var(--text);
    padding:6px 10px; 
    border-radius:8px; 
    cursor:pointer; 
    font-weight:800; 
    font-size:13px;
  }
  .pager .current{ 
    background:transparent; 
    border:none; 
    color:#ff7a1a; 
    font-weight:900; 
  }
  .pager .ellipsis{ 
    opacity:.6; 
    border:none; 
    background:transparent; 
  }

  /* ëª¨ë°”ì¼: ì„¸ë¡œ ë°°ì¹˜ */
  @media (max-width:1100px){
    .row, .row.reverse{ 
      grid-template-columns:1fr; 
      gap:12px;
    }
    .col-hero { 
      min-height:300px; 
      order:1;
    }
    .col-hero .hero { 
      min-height:300px; 
    }
    .col-cards{ 
      height:auto;
      overflow-y:visible;
      padding-right:0;
      display:grid; 
      grid-template-columns:repeat(2, 1fr);
      gap:12px; 
      order:2;
    }
  }
  
  @media (max-width:600px){
    .col-cards{ 
      grid-template-columns:1fr;
    }
  }

  /* ===========================
     ê³µí†µ ì˜¤ë²„ë ˆì´
     =========================== */
  .category-overlay, .post-overlay, .search-overlay, .about-page, .editors-overlay{
    position:fixed; 
    inset:0; 
    z-index:1800; 
    overflow:auto; 
    padding:28px; 
    background:var(--overlay);
    opacity:0; 
    visibility:hidden; 
    transform:translateY(8px);
    transition:opacity .18s ease-out, transform .18s ease-out, visibility 0s .18s; 
    color:var(--text);
  }
  .post-overlay{ 
    z-index:1900; 
    padding:0; /* ì§„í–‰ë°”ë¥¼ ìœ„í•´ íŒ¨ë”© ì œê±° */
  }
  .category-overlay.active, .post-overlay.active, .search-overlay.active, .about-page.active, .editors-overlay.active{
    opacity:1; 
    visibility:visible; 
    transform:translateY(0); 
    transition:opacity .18s ease-out, transform .18s ease-out, visibility 0s;
  }
  .category-overlay.closing, .post-overlay.closing, .search-overlay.closing, .about-page.closing, .editors-overlay.closing{
    opacity:0; 
    transform:translateY(8px); 
    visibility:visible;
  }

  /* ===========================
     POST í™”ë©´
     =========================== */
  /* ì§„í–‰ë¥  ë°” - ìµœìƒë‹¨ ê³ ì • */
  .progress-wrap{
    position:fixed;
    top:0;
    left:0;
    right:0;
    z-index:2100; 
    background:transparent; 
    height:4px;
  }
  .progress-bar{
    width:0%; 
    height:4px; 
    background:var(--progress);
    transition:width .08s linear; 
    border-top-right-radius:2px; 
    border-bottom-right-radius:2px;
  }

  /* ìŠ¤í¬ë¡¤ ì‹œ ë‚˜íƒ€ë‚˜ëŠ” íˆ´ë°” */
  .post-toolbar{
    position:fixed; 
    top:8px; 
    left:50%; 
    transform:translateX(-50%) translateY(-60px);
    width:min(1200px, calc(100% - 24px)); 
    height:48px; 
    display:flex; 
    justify-content:space-between; 
    align-items:center;
    padding:0 12px; 
    border-radius:12px; 
    background:color-mix(in oklab, var(--overlay) 88%, transparent);
    border:1px solid var(--border); 
    box-shadow:0 6px 20px var(--shadow);
    backdrop-filter: blur(8px);
    transition:transform .18s ease; 
    opacity:1; 
    pointer-events:none;
    color:var(--text);
  }
  .post-toolbar.show{ 
    transform:translateX(-50%) translateY(0); 
    pointer-events:auto;
  }
  .post-toolbar .tool-left{ 
    display:flex; 
    align-items:center; 
    gap:10px; 
    font-weight:900; 
    cursor:pointer; 
  }
  .post-toolbar .tool-right .hamburger{ 
    width:36px; 
    height:28px; 
    border-radius:8px; 
    border:1px solid var(--border); 
    background:var(--card); 
    cursor:pointer; 
    display:flex; 
    align-items:center; 
    justify-content:center; 
  }
  .post-toolbar .hamburger span{ 
    display:block; 
    width:18px; 
    height:2px; 
    background:var(--text); 
    position:relative; 
  }
  .post-toolbar .hamburger span::before, 
  .post-toolbar .hamburger span::after{
    content:""; 
    position:absolute; 
    left:0; 
    width:18px; 
    height:2px; 
    background:var(--text);
  }
  .post-toolbar .hamburger span::before{ top:-6px; }
  .post-toolbar .hamburger span::after{ top:6px; }
  
  /* í¬ìŠ¤íŠ¸ ë‚´ìš© ì˜ì—­ */
  .post-content-wrapper {
    padding:28px;
    padding-top:40px; /* ì§„í–‰ë°” ê³µê°„ */
  }
  
  .post-article{ 
    margin:0 auto; 
    max-width:900px; 
  }
  
  /* í¬ìŠ¤íŠ¸ í—¤ë” ì„¹ì…˜ */
  .post-header {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:24px;
    margin-bottom:32px;
    align-items:center;
  }
  
  .post-header-image {
    width:100%;
    height:400px;
    overflow:hidden;
    border-radius:12px;
    background:#000;
  }
  
  .post-header-image img {
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  
  .post-header-info {
    display:flex;
    flex-direction:column;
    justify-content:center;
    gap:16px;
  }
  
  .post-header-info h1 {
    font-size:32px;
    font-weight:900;
    margin:0;
    color:var(--text);
    line-height:1.2;
  }
  
  .post-meta {
    display:flex;
    gap:12px;
    align-items:center;
  }
  
  .post-content{ 
    color:var(--text); 
    line-height:1.9; 
  }
  
  /* ëª¨ë°”ì¼ í¬ìŠ¤íŠ¸ ë ˆì´ì•„ì›ƒ */
  @media (max-width:768px) {
    .post-header {
      grid-template-columns:1fr;
    }
    
    .post-header-image {
      height:300px;
    }
    
    .post-header-info h1 {
      font-size:24px;
    }
    
    /* ìœ íŠœë¸Œ ë“± ì„ë² ë“œ ìš”ì†Œ í¬ê¸° ì œí•œ */
    .post-content iframe,
    .post-content video,
    .post-content embed,
    .post-content object {
      max-width:100% !important;
      width:100% !important;
      height:auto !important;
    }
    
    .post-content .wp-video,
    .post-content .video-container {
      max-width:100% !important;
      overflow:hidden;
    }
  }

  /* ê²€ìƒ‰ë°” */
  .search-bar{ 
    display:flex; 
    align-items:center; 
    background:var(--card); 
    border-radius:50px; 
    box-shadow:0 6px 20px var(--shadow); 
    padding:6px 10px; 
    gap:8px; 
    border:1px solid var(--border); 
  }
  .search-bar input[type="search"]{ 
    flex:1; 
    border:none; 
    outline:none; 
    font-size:16px; 
    padding:12px 14px; 
    border-radius:50px; 
    background:transparent; 
    color:var(--text); 
  }
  .search-bar .close-btn{ 
    background:none; 
    border:none; 
    font-size:20px; 
    cursor:pointer; 
    color:var(--muted); 
  }

  /* TO TOP */
  .to-top{
    position:fixed; 
    right:22px; 
    bottom:22px; 
    width:52px; 
    height:52px; 
    border-radius:12px; 
    background:var(--card); 
    color:var(--text);
    display:flex; 
    align-items:center; 
    justify-content:center; 
    font-size:22px; 
    z-index:2500; 
    box-shadow:0 12px 30px var(--shadow);
    opacity:0; 
    transform:translateY(20px); 
    border:1px solid var(--border); 
    transition:all .28s cubic-bezier(.2,.9,.2,1); 
    cursor:pointer;
  }
  .to-top.show{ 
    opacity:1; 
    transform:translateY(0); 
  }

  /* FOOTER */
  footer.site-footer{ 
    background:#111; 
    color:#eee; 
    padding:40px 20px; 
    margin-top:20px; 
  }
  [data-theme="dark"] footer.site-footer{ 
    background:#0b0c10; 
    color:#cfd3dc; 
  }
  .footer-inner{ 
    max-width:1400px; 
    margin:0 auto; 
    display:flex; 
    justify-content:space-between; 
    gap:20px; 
    align-items:flex-start; 
    flex-wrap:wrap; 
  }
  .footer-brand{ 
    font-size:40px; 
    font-weight:900; 
    color:#fff; 
    font-style:italic; 
  }
  .footer-links a{ 
    color:#ddd; 
    cursor:pointer; 
    display:block; 
    font-weight:800; 
    margin-bottom:8px; 
  }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header" id="siteHeader" role="banner" aria-label="ì‚¬ì´íŠ¸ í—¤ë”">
    <div class="header-inner wrap">
      <div class="brand" aria-label="IMPACT brand">
        <div class="logo" id="logoBtn" onclick="router.goHome()" tabindex="0" title="IMPACT â€“ go home">
          <img src="logo.png" alt="IMPACT logo" style="width:36px;height:36px;border-radius:8px;object-fit:cover;">
          <div>
            <div style="line-height:1">IMPACT</div>
            <small>MAKE A IMPACT</small>
          </div>
        </div>
      </div>

      <div class="header-actions" role="navigation" aria-label="ìƒë‹¨ ë©”ë‰´">
        <button class="icon-btn" id="topSearchBtn" onclick="openNavlessSearch()" title="ê²€ìƒ‰" aria-label="ê²€ìƒ‰">
          ğŸ”
        </button>
        <button class="icon-btn" aria-controls="navOverlay" aria-expanded="false" onclick="ui.toggleNav()" title="ë©”ë‰´" aria-label="ë©”ë‰´">
          <span class="hamburger-icon"><span></span></span>
        </button>
      </div>
    </div>
  </header>

  <!-- NAV OVERLAY -->
  <aside class="nav-overlay" id="navOverlay" aria-hidden="true" aria-label="ì¹´í…Œê³ ë¦¬ ë„¤ë¹„ê²Œì´ì…˜">
    <button class="nav-close" aria-label="ë„¤ë¹„ ë‹«ê¸°" onclick="ui.toggleNav(true)">Ã—</button>
    <div style="display:flex;flex-direction:column;gap:12px;">
      <div class="nav-search" role="search" aria-label="ë„¤ë¹„ ê²€ìƒ‰">
        <span style="font-size:18px">ğŸ”</span>
        <input type="search" id="globalNavSearch" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" aria-label="ë„¤ë¹„ ê²€ìƒ‰ì–´">
      </div>
      <ul class="nav-list" id="navList" role="menu" aria-label="ì¹´í…Œê³ ë¦¬ ëª©ë¡"></ul>
      <div class="nav-footer-links">
        <a href="javascript:void(0)" onclick="ui.toggleNav(true); router.openAbout()">ABOUT</a>
        <a href="javascript:void(0)" onclick="ui.toggleNav(true); router.openEditors()">EDITORS</a>
        <a href="javascript:void(0)" onclick="alert('NEWSLETTER í˜ì´ì§€ëŠ” ì¶”í›„ êµ¬í˜„ë©ë‹ˆë‹¤')">NEWSLETTER</a>
        <a href="https://www.instagram.com/ceo_impact_official" target="_blank" rel="noopener">INSTAGRAM</a>
      </div>
    </div>
    <button class="theme-toggle" onclick="toggleTheme()">
      <span id="themeIcon">ğŸŒ™</span>
      <span id="themeText">ë‹¤í¬ëª¨ë“œ</span>
    </button>
  </aside>

  <!-- HOME -->
  <main class="home" id="home" role="main" aria-live="polite" tabindex="-1">
    <div id="rowsContainer" aria-live="polite"></div>
    <div id="homeLoading" style="text-align:center;color:var(--muted);padding:18px 0"></div>
    <nav id="homePager" class="pager" aria-label="í˜ì´ì§€ ì´ë™"></nav>
  </main>

  <!-- CATEGORY OVERLAY -->
  <section class="category-overlay" id="categoryOverlay" aria-hidden="true" role="region">
    <div class="wrap">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;border-bottom:1px solid var(--border);padding-bottom:12px;">
        <div>
          <div id="categoryOverlayTitle" style="font-size:24px;font-weight:900;">CATEGORY</div>
          <div id="categoryOverlaySubtitle" style="font-size:13px;color:var(--muted);margin-top:4px;">ì¹´í…Œê³ ë¦¬ ì„¤ëª…</div>
        </div>
        <div><button class="icon-btn" onclick="router.closeCategory()" style="font-size:24px;">Ã—</button></div>
      </div>
      <div id="categoryGrid" class="category-grid" style="margin-top:18px; display:grid; gap:18px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); padding:20px 0 10px;"></div>
      <nav id="categoryPager" class="pager" aria-label="ì¹´í…Œê³ ë¦¬ í˜ì´ì§€ ì´ë™"></nav>
      <div id="categoryLoading" style="text-align:center;color:var(--muted);padding:14px 0"></div>
    </div>
  </section>

  <!-- EDITORS OVERLAY -->
  <section class="editors-overlay" id="editorsOverlay" aria-hidden="true" role="region">
    <div class="wrap">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;border-bottom:1px solid var(--border);padding-bottom:14px;">
        <div>
          <h2 style="font-size:24px;margin:0">EDITORS</h2>
          <div style="color:var(--muted);font-size:13px">ì°¸ì—¬ ì—ë””í„°ì™€ ê¸€ì„ í™•ì¸í•˜ì„¸ìš”.</div>
        </div>
        <div><button class="icon-btn" onclick="router.closeEditors()" style="font-size:24px;">Ã—</button></div>
      </div>
      <div id="editorsGridWrapper" style="margin-top:18px;">
        <div id="editorsGrid" class="editors-grid" style="display:grid; grid-template-columns: repeat(auto-fill,minmax(160px,1fr)); gap:16px;"></div>
        <div id="editorsLoading" style="text-align:center;color:var(--muted);padding:18px 0"></div>
      </div>
      <div id="editorProfileSection" style="display:none;margin-top:18px;">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;">
          <div>
            <div id="editorProfileName" style="font-weight:900;font-size:20px"></div>
            <div id="editorProfileBio" style="color:var(--muted);font-size:13px"></div>
          </div>
          <div><button class="icon-btn" onclick="showEditorsList()" style="font-size:16px;">ëª©ë¡ìœ¼ë¡œ</button></div>
        </div>
        <div id="editorPostsGrid" class="category-grid" style="display:grid; gap:18px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));"></div>
        <div id="editorPostsLoading" style="text-align:center;color:var(--muted);padding:18px 0"></div>
      </div>
    </div>
  </section>

  <!-- POST OVERLAY -->
  <article class="post-overlay" id="postOverlay" aria-hidden="true" role="article">
    <!-- ìƒë‹¨ ì§„í–‰ë¥  ë°” -->
    <div class="progress-wrap"><div class="progress-bar" id="progressBar"></div></div>
    
    <!-- ìŠ¤í¬ë¡¤ ì‹œ ë‚˜íƒ€ë‚˜ëŠ” íˆ´ë°” -->
    <div class="post-toolbar" id="postToolbar">
      <div class="tool-left" onclick="router.goHome()">
        <img src="logo.png" alt="IMPACT" style="width:24px;height:24px;border-radius:6px;object-fit:cover;">
        <span>IMPACT</span>
      </div>
      <div class="tool-right">
        <button class="hamburger" aria-label="ë©”ë‰´" onclick="ui.toggleNav(false)"><span></span></button>
      </div>
    </div>

    <div class="post-content-wrapper">
      <div style="width:100%;max-width:1200px;margin:0 auto;">
        <div style="display:flex;justify-content:flex-end;gap:12px;margin-bottom:18px">
          <button class="icon-btn" onclick="router.closePost()" style="font-size:24px;">Ã—</button>
        </div>
        <div class="post-article" id="postArticle"></div>

        <!-- ê´€ë ¨ ê¸€ -->
        <section id="relatedSection" style="max-width:1200px;margin:28px auto 0;display:none;">
          <h3 style="font-size:20px;font-weight:900;margin:0 0 12px;">ê´€ë ¨ ê¸€</h3>
          <div id="relatedGrid" style="display:grid; gap:16px; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"></div>
        </section>
      </div>
    </div>
  </article>

  <!-- SEARCH OVERLAY -->
  <section class="search-overlay" id="searchOverlay" aria-hidden="true" role="search">
    <div class="wrap" style="max-width:1100px;margin:0 auto;">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px">
        <div style="flex:1">
          <div class="search-bar" role="search" aria-label="ì‚¬ì´íŠ¸ ê²€ìƒ‰">
            <input type="search" class="search-input" id="searchInputTop" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥ (Enter)" aria-label="ê²€ìƒ‰ì–´">
            <button type="button" class="close-btn" onclick="ui.closeSearch()">Ã—</button>
          </div>
        </div>
      </div>
      <div id="searchResults" class="category-grid" style="display:grid; gap:18px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));"></div>
    </div>
  </section>

  <!-- ABOUT PAGE -->
  <section class="about-page" id="aboutPageSection" aria-hidden="true" role="region">
    <div class="wrap">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:18px">
        <div>
          <h2 style="font-size:32px;margin-bottom:10px">ABOUT</h2>
          <div style="color:var(--text);font-size:15px;line-height:1.8">
            <p><strong>IMPACT</strong> ëŠ” ç¾Â·å‰ KAIST IP-CEO ë° POSTECH CEO í•™ìƒë“¤ì´ í•¨ê»˜ ë§Œë“œëŠ” ì‹¬ì¸µ ì½˜í…ì¸  í”Œë«í¼ì…ë‹ˆë‹¤.</p>
            <p>ê¸°ìˆ Â·ê²½ì˜Â·ì°½ì˜ì„±ì˜ êµì°¨ì ì—ì„œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í†µì°°ì„ ì „ë‹¬í•©ë‹ˆë‹¤.</p>
          </div>
          <div style="margin-top:20px"><button class="icon-btn" onclick="router.closeAbout()" style="font-size:24px;">Ã—</button></div>
        </div>
      </div>
    </div>
  </section>

  <!-- TO TOP -->
  <button class="to-top" id="toTopBtn" title="ë§¨ ìœ„ë¡œ" aria-label="ë§¨ ìœ„ë¡œ">â†‘</button>

  <!-- FOOTER -->
  <footer class="site-footer" role="contentinfo" aria-label="ì‚¬ì´íŠ¸ í‘¸í„°">
    <div class="wrap footer-inner">
      <div>
        <div class="footer-brand">IMPACT</div>
        <div style="margin-top:10px;color:#ddd;font-size:13px">ê´‘ê³  ì œíœ´ | <a href="mailto:ceo.impact.official@gmail.com">ceo.impact.official@gmail.com</a></div>
        <div style="color:#ddd;font-size:13px;margin-top:6px">ë³´ë„ìë£Œ | <a href="mailto:ceo.impact.official@gmail.com">ceo.impact.official@gmail.com</a></div>
      </div>
      <div class="footer-links">
        <a href="javascript:void(0)" onclick="router.openAbout()">ABOUT</a>
        <a href="javascript:void(0)" onclick="router.openEditors()">EDITORS</a>
        <a href="javascript:void(0)" onclick="alert('NEWSLETTER í˜ì´ì§€ëŠ” ì¶”í›„ êµ¬í˜„ë©ë‹ˆë‹¤')">NEWSLETTER</a>
        <a href="https://www.instagram.com/ceo_impact_official" target="_blank" rel="noopener">INSTAGRAM</a>
      </div>
      <div class="footer-right"><div style="font-weight:800;color:#fff">IMPACT CEO. ALL RIGHTS RESERVED.</div></div>
    </div>
  </footer>

  <!-- ì¹´ë“œ í…œí”Œë¦¿ -->
  <template id="cardTpl">
    <article class="card" role="article">
      <div class="thumb"><img src="" alt=""></div>
      <div class="card-body">
        <div class="cat-row"></div>
        <h3 class="title"></h3>
        <div class="meta" style="display:flex;align-items:center;gap:8px;color:var(--muted);font-size:13px;">
          <img class="author-avatar" src="" alt="" style="width:36px;height:36px;border-radius:50%;object-fit:cover;">
          <div>
            <div class="author-name" style="color:var(--text);font-weight:800;"></div>
            <div class="date" style="font-size:12px;"></div>
          </div>
        </div>
      </div>
    </article>
  </template>

  <!-- ì—ë””í„° ì¹´ë“œ í…œí”Œë¦¿ -->
  <template id="editorTpl">
    <div class="editor-card" role="button" tabindex="0" style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center;display:flex;flex-direction:column;align-items:center;gap:10px;cursor:pointer;">
      <img class="editor-avatar" src="" alt="" style="width:84px;height:84px;border-radius:50%;object-fit:cover;">
      <div class="editor-name" style="font-weight:800;font-size:15px;color:var(--text)"></div>
      <div class="editor-bio" style="font-size:12px;color:var(--muted)"></div>
    </div>
  </template>

  <script>
/* ==========================================================
   ìƒìˆ˜/ìƒíƒœ
   ========================================================== */
const HOME_PER_PAGE = 20;
const CATEGORIES = { tech:318, eat:123073, style:2286, culture:1098, life:124, "editors-pick":259543 };
const NAV_ORDER = ["TECH","EAT","STYLE","CULTURE","LIFE","EDITORS' PICK"];

const state = {
  homePage: 1,
  homeTotalPages: 1,
  postsCache: {},
  editorsList: [],
  editorsLoaded: false,
  currentScrollPos: 0,
  lastScrollY: 0,
  category: { slug:null, page:1, totalPages:1 }
};

function api(path){
  const p = path.includes('_embed') ? path : (path + (path.includes('?') ? '&' : '?') + '_embed');
  return `/.netlify/functions/wpProxy?path=${encodeURIComponent(p)}`;
}
function headers(){ return {}; }

/* í…Œë§ˆ ì „í™˜ */
function toggleTheme() {
  const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
  
  const icon = document.getElementById('themeIcon');
  const text = document.getElementById('themeText');
  if (newTheme === 'dark') {
    icon.textContent = 'â˜€ï¸';
    text.textContent = 'ë¼ì´íŠ¸ëª¨ë“œ';
  } else {
    icon.textContent = 'ğŸŒ™';
    text.textContent = 'ë‹¤í¬ëª¨ë“œ';
  }
}

/* ìœ í‹¸ */
function formatDate(dstr){ try{ const d=new Date(dstr); return `${d.getFullYear()}. ${String(d.getMonth()+1).padStart(2,'0')}. ${String(d.getDate()).padStart(2,'0')}.`; }catch(e){ return ''; } }
function placeholderDataURI(w=600,h=400,txt='No Image'){ const svg=`<svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}'><rect width='100%' height='100%' fill='#2b2f36'/><text x='50%' y='50%' fill='#9aa3af' font-size='20' text-anchor='middle' dominant-baseline='middle'>${txt}</text></svg>`; return 'data:image/svg+xml;charset=UTF-8,'+encodeURIComponent(svg); }
function pickCategoryClass(s){ if(!s) return ''; s=String(s).toLowerCase(); if(s.includes('tech'))return'cat-tech'; if(s.includes('eat'))return'cat-eat'; if(s.includes('style'))return'cat-style'; if(s.includes('culture'))return'cat-culture'; if(s.includes('life'))return'cat-life'; if(s.includes('editor'))return'cat-editors-pick'; return ''; }
function stripTags(str=''){ return str.replace(/<\/?[^>]+(>|$)/g,""); }

/* NAV ëª©ë¡ */
function renderNavList(){
  const navList=document.getElementById('navList');
  navList.innerHTML='';
  NAV_ORDER.forEach(item=>{
    const li=document.createElement('li');
    li.textContent=item; li.tabIndex=0; li.setAttribute('role','menuitem');
    li.addEventListener('click', ()=>{
      ui.toggleNav(true);
      const slug=item.toLowerCase().replace(/'/g,'').replace(/\s/g,'-');
      if(CATEGORIES[slug]||slug==='editors-pick') router.openCategory(slug);
    });
    li.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' ') li.click(); });
    navList.appendChild(li);
  });
}

/* ì¹´ë“œ */
function createCardNode(post){
  const tpl=document.getElementById('cardTpl');
  const node=tpl.content.firstElementChild.cloneNode(true);
  const imgEl=node.querySelector('.thumb img');
  const thumbUrl=post._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';
  imgEl.src = thumbUrl || placeholderDataURI(1200,800,'No Image');
  imgEl.alt = (post.title?.rendered)?stripTags(post.title.rendered):'thumb';
  node.querySelector('.title').innerHTML = post.title?.rendered ?? 'ì œëª© ì—†ìŒ';

  const avatarImg=node.querySelector('.author-avatar');
  const authorNameEl=node.querySelector('.author-name');
  const dateEl=node.querySelector('.date');
  if(post._embedded?.author?.[0]){
    const a=post._embedded.author[0];
    const av=a.avatar_urls ? (a.avatar_urls['48']||a.avatar_urls['24']) : '';
    avatarImg.src = av || placeholderDataURI(96,96,'U');
    avatarImg.alt = a.name || 'author';
    authorNameEl.textContent = a.name || 'ìµëª…';
  }else{
    avatarImg.src = placeholderDataURI(96,96,'U'); authorNameEl.textContent='ìµëª…';
  }
  dateEl.textContent = formatDate(post.date);

  const catRow=document.createElement('div'); catRow.style.marginBottom='8px';
  const cats=post._embedded?.['wp:term']?.[0] || [];
  cats.forEach(c=>{
    if(c?.name){
      const span=document.createElement('span');
      span.className='cat-badge '+(pickCategoryClass(c.slug||c.name)||'');
      if(!pickCategoryClass(c.slug||c.name)) span.style.background='#666';
      span.textContent=c.name;
      catRow.appendChild(span);
    }
  });
  node.querySelector('.card-body').insertBefore(catRow, node.querySelector('.title'));

  node.addEventListener('click', ()=> openPostOverlayById(post.id));
  node.addEventListener('keydown', e=>{ if(e.key==='Enter') openPostOverlayById(post.id); });
  return node;
}

/* í™ˆ: í˜ì´ì§€ ë‹¨ìœ„ ë¡œë“œ + í˜ì´ì§€ë„¤ì´ì…˜ */
async function loadHome(page=1){
  const rows=document.getElementById('rowsContainer');
  const loading=document.getElementById('homeLoading');
  const pager=document.getElementById('homePager');
  rows.innerHTML=''; loading.textContent='ë¡œë”© ì¤‘...'; pager.innerHTML='';
  try{
    const res=await fetch(api(`posts?per_page=${HOME_PER_PAGE}&page=${page}`),{headers:headers()});
    if(!res.ok){ loading.textContent='ê¸€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'; return; }
    const posts=await res.json();
    const totalPages = parseInt(res.headers.get('X-WP-TotalPages')||'1',10);
    state.homePage=page; state.homeTotalPages=totalPages;

    // ìºì‹œ
    posts.forEach(p=> state.postsCache[p.id]=p);

    // íŒ¨í„´: ì™¼ìª½ í° + ì˜¤ë¥¸ìª½ 4ê°œ, ë‹¤ìŒì€ ë°˜ëŒ€
    for(let i=0;i<posts.length;i+=5){
      const group=posts.slice(i,i+5);
      const row=document.createElement('div'); 
      const isReverse = Math.floor(i/5) % 2 === 1;
      row.className= isReverse ? 'row reverse' : 'row';

      if(!isReverse) {
        // ì™¼ìª½ í° ì¹´ë“œ
        const leftPost=group[0];
        const leftDiv=document.createElement('div'); leftDiv.className='col-hero';
        const heroUrl=leftPost? (leftPost._embedded?.['wp:featuredmedia']?.[0]?.source_url || '') : '';
        leftDiv.innerHTML=`
          <img class="hero" src="${heroUrl || placeholderDataURI(1200,800,'No Image')}" alt="hero">
          <div class="hero-overlay">
            <h2 class="hero-title">${leftPost?.title?.rendered ?? 'ì œëª© ì—†ìŒ'}</h2>
            <div style="display:flex;align-items:center;gap:10px">
              <img class="hero-avatar" src="" alt="" style="width:36px;height:36px;border-radius:50%;object-fit:cover;">
              <div class="hero-author" style="font-weight:800;color:#fff"></div>
              <div class="hero-date" style="margin-left:8px;color:#eee;opacity:.9"></div>
            </div>
          </div>
        `;
        const ha=leftPost?leftPost._embedded?.author?.[0]:null;
        const heroAvatar=leftDiv.querySelector('.hero-avatar');
        heroAvatar.src = (ha?.avatar_urls?.['48']||ha?.avatar_urls?.['24']) || placeholderDataURI(48,48,'U');
        leftDiv.querySelector('.hero-author').textContent = ha?.name || 'ìµëª…';
        leftDiv.querySelector('.hero-date').textContent = leftPost?formatDate(leftPost.date):'';
        leftDiv.addEventListener('click', ()=> openPostOverlayById(leftPost.id));

        const catWrap=document.createElement('div'); catWrap.className='hero-cats';
        const firstCat=leftPost? leftPost._embedded?.['wp:term']?.[0]?.[0] : null;
        if(firstCat){
          const span=document.createElement('span');
          span.className='cat-badge '+pickCategoryClass(firstCat.slug||firstCat.name);
          span.textContent=firstCat.name; catWrap.appendChild(span);
        }
        leftDiv.appendChild(catWrap);
        row.appendChild(leftDiv);

        // ì˜¤ë¥¸ìª½ 4ê°œ
        const rightDiv=document.createElement('div'); rightDiv.className='col-cards';
        group.slice(1,5).forEach(p=>{ if(p){ state.postsCache[p.id]=p; rightDiv.appendChild(createCardNode(p)); } });
        row.appendChild(rightDiv);
      } else {
        // ì˜¤ë¥¸ìª½ í° ì¹´ë“œ (ë°˜ëŒ€ íŒ¨í„´)
        const rightDiv=document.createElement('div'); rightDiv.className='col-cards';
        group.slice(1,5).forEach(p=>{ if(p){ state.postsCache[p.id]=p; rightDiv.appendChild(createCardNode(p)); } });
        row.appendChild(rightDiv);

        const leftPost=group[0];
        const leftDiv=document.createElement('div'); leftDiv.className='col-hero';
        const heroUrl=leftPost? (leftPost._embedded?.['wp:featuredmedia']?.[0]?.source_url || '') : '';
        leftDiv.innerHTML=`
          <img class="hero" src="${heroUrl || placeholderDataURI(1200,800,'No Image')}" alt="hero">
          <div class="hero-overlay">
            <h2 class="hero-title">${leftPost?.title?.rendered ?? 'ì œëª© ì—†ìŒ'}</h2>
            <div style="display:flex;align-items:center;gap:10px">
              <img class="hero-avatar" src="" alt="" style="width:36px;height:36px;border-radius:50%;object-fit:cover;">
              <div class="hero-author" style="font-weight:800;color:#fff"></div>
              <div class="hero-date" style="margin-left:8px;color:#eee;opacity:.9"></div>
            </div>
          </div>
        `;
        const ha=leftPost?leftPost._embedded?.author?.[0]:null;
        const heroAvatar=leftDiv.querySelector('.hero-avatar');
        heroAvatar.src = (ha?.avatar_urls?.['48']||ha?.avatar_urls?.['24']) || placeholderDataURI(48,48,'U');
        leftDiv.querySelector('.hero-author').textContent = ha?.name || 'ìµëª…';
        leftDiv.querySelector('.hero-date').textContent = leftPost?formatDate(leftPost.date):'';
        leftDiv.addEventListener('click', ()=> openPostOverlayById(leftPost.id));

        const catWrap=document.createElement('div'); catWrap.className='hero-cats';
        const firstCat=leftPost? leftPost._embedded?.['wp:term']?.[0]?.[0] : null;
        if(firstCat){
          const span=document.createElement('span');
          span.className='cat-badge '+pickCategoryClass(firstCat.slug||firstCat.name);
          span.textContent=firstCat.name; catWrap.appendChild(span);
        }
        leftDiv.appendChild(catWrap);
        row.appendChild(leftDiv);
      }
      
      rows.appendChild(row);
    }

    loading.textContent = posts.length ? '' : 'ì•„ì§ ê²Œì‹œëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.';
    renderPager(pager, page, totalPages, (to)=> loadHome(to));
  }catch(e){
    console.error(e); loading.textContent='ë©”ì¸ ê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨';
  }
}

/* ê³µí†µ í˜ì´ì§€ë„¤ì´ì…˜ ë Œë” */
function renderPager(container, current, total, onChange){
  container.innerHTML='';
  if(total<=1) return;
  const mkBtn=(label, page, isCurrent=false, disabled=false)=>{
    const el=document.createElement('button');
    el.textContent=label;
    if(isCurrent){ el.className='current'; el.disabled=true; }
    else if(disabled){ el.disabled=true; }
    else{ el.addEventListener('click', ()=> onChange(page)); }
    container.appendChild(el);
  };
  const mkEll=()=>{ const s=document.createElement('span'); s.className='ellipsis'; s.textContent='â€¦'; container.appendChild(s); };

  mkBtn('Â«', 1, false, current===1);
  if(total<=9){
    for(let p=1;p<=total;p++) mkBtn(p, p, p===current);
  }else{
    if(current<=4){
      for(let p=1;p<=5;p++) mkBtn(p,p,p===current);
      mkEll(); mkBtn(total, total);
    }else if(current>=total-3){
      mkBtn(1,1); mkEll();
      for(let p=total-4;p<=total;p++) mkBtn(p,p,p===current);
    }else{
      mkBtn(1,1); mkEll();
      for(let p=current-1;p<=current+1;p++) mkBtn(p,p,p===current);
      mkEll(); mkBtn(total,total);
    }
  }
  mkBtn('Â»', total, false, current===total);
}

/* ì¹´í…Œê³ ë¦¬ í˜ì´ì§€ */
async function loadCategory(slug, page=1){
  if(!slug) return;
  state.category.slug=slug; state.category.page=page;

  const overlay=document.getElementById('categoryOverlay');
  openOverlay(overlay);

  const title=document.getElementById('categoryOverlayTitle');
  const sub=document.getElementById('categoryOverlaySubtitle');
  const desc={ tech:'ê¸°ìˆ ê³¼ í˜ì‹  ì‹¬ì¸µ ë¶„ì„', eat:'ìŒì‹ê³¼ ì™¸ì‹ ë¬¸í™”', style:'íŒ¨ì…˜Â·ë¼ì´í”„ìŠ¤íƒ€ì¼', culture:'ë¬¸í™”ì™€ ì˜ˆìˆ ', life:'ì¼ìƒê³¼ ì‚¶', 'editors-pick':'ì—ë””í„° ì¶”ì²œ' };
  title.textContent=slug.toUpperCase(); sub.textContent=desc[slug] || 'ì¹´í…Œê³ ë¦¬';

  const grid=document.getElementById('categoryGrid'); grid.innerHTML='';
  document.getElementById('categoryLoading').textContent='ë¡œë”© ì¤‘...';
  const pager=document.getElementById('categoryPager'); pager.innerHTML='';

  try{
    const catId=CATEGORIES[slug]; if(!catId){ document.getElementById('categoryLoading').textContent='ì•Œ ìˆ˜ ì—†ëŠ” ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤.'; return; }
    const res=await fetch(api(`posts?categories=${catId}&per_page=${HOME_PER_PAGE}&page=${page}`),{headers:headers()});
    const posts=await res.json();
    const totalPages=parseInt(res.headers.get('X-WP-TotalPages')||'1',10);
    state.category.totalPages=totalPages;

    if(Array.isArray(posts)){
      posts.forEach(p=>{ state.postsCache[p.id]=p; grid.appendChild(createCardNode(p)); });
    }
    document.getElementById('categoryLoading').textContent='';
    renderPager(pager, page, totalPages, (to)=> loadCategory(slug, to));
    history.pushState({page:'category',slug,catPage:page}, '', `#category-${slug}?p=${page}`);
  }catch(e){ console.error(e); document.getElementById('categoryLoading').textContent='ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨'; }
}

/* ì—ë””í„° */
async function loadEditors(){
  if(state.editorsLoaded) return;
  document.getElementById('editorsLoading').textContent='ë¡œë”© ì¤‘...';
  try{
    const res=await fetch(api(`users?per_page=100`),{headers:headers()});
    if(!res.ok) throw new Error('editors api fail '+res.status);
    const users=await res.json();
    state.editorsList=Array.isArray(users)?users:[];
    renderEditorsGrid();
    state.editorsLoaded=true;
    document.getElementById('editorsLoading').textContent='';
  }catch(e){ console.error(e); document.getElementById('editorsLoading').textContent='ì—ë””í„° ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'; }
}
function renderEditorsGrid(){
  const wrap=document.getElementById('editorsGrid'); wrap.innerHTML='';
  const tpl=document.getElementById('editorTpl');
  state.editorsList.forEach(u=>{
    const node=tpl.content.firstElementChild.cloneNode(true);
    const img=node.querySelector('.editor-avatar');
    img.src=(u.avatar_urls && (u.avatar_urls['96']||u.avatar_urls['48']||u.avatar_urls['24'])) || placeholderDataURI(96,96,'U');
    img.alt=u.name||u.slug||'editor';
    node.querySelector('.editor-name').textContent=u.name||u.slug||'unknown';
    node.querySelector('.editor-bio').textContent=u.description||'';
    node.addEventListener('click', ()=> openEditorProfile(u));
    node.addEventListener('keydown', e=>{ if(e.key==='Enter') openEditorProfile(u); });
    wrap.appendChild(node);
  });
}
async function openEditorProfile(user){
  if(!user?.id) return;
  document.getElementById('editorsGridWrapper').style.display='none';
  const section=document.getElementById('editorProfileSection'); section.style.display='block';
  document.getElementById('editorProfileName').textContent=user.name||user.slug||'';
  document.getElementById('editorProfileBio').textContent=user.description||'';
  const grid=document.getElementById('editorPostsGrid'); grid.innerHTML='';
  document.getElementById('editorPostsLoading').textContent='ë¡œë”© ì¤‘...';

  try{
    const res=await fetch(api(`posts?author=${user.id}&per_page=50`),{headers:headers()});
    const posts=await res.json();
    if(Array.isArray(posts)){ posts.forEach(p=>{ state.postsCache[p.id]=p; grid.appendChild(createCardNode(p)); }); }
    document.getElementById('editorPostsLoading').textContent='';
    history.pushState({page:'editor', id:user.id}, '', `#editor-${user.id}`);
  }catch(e){ console.error(e); document.getElementById('editorPostsLoading').textContent='ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨'; }
}
function showEditorsList(){
  document.getElementById('editorProfileSection').style.display='none';
  document.getElementById('editorsGridWrapper').style.display='block';
  history.pushState({page:'editors'}, '', '#editors');
}

/* POST ì˜¤ë²„ë ˆì´ */
async function openPostOverlayById(id){
  if(!id) return;
  state.currentScrollPos=window.scrollY;

  const cached=state.postsCache[id];
  if(cached?.content?.rendered){ renderPostOverlay(cached); return; }
  try{
    const res=await fetch(api(`posts/${id}`),{headers:headers()});
    if(!res.ok) throw new Error('post fetch failed '+res.status);
    const post=await res.json();
    if(!(post._embedded?.author)){
      const res2=await fetch(api(`posts/${id}?_embed`),{headers:headers()});
      if(res2.ok){ const p2=await res2.json(); state.postsCache[id]=p2; renderPostOverlay(p2); return; }
    }
    state.postsCache[id]=post; renderPostOverlay(post);
  }catch(e){ console.error(e); alert('í¬ìŠ¤íŠ¸ ë¡œë“œ ì‹¤íŒ¨'); }
}

function renderPostOverlay(post){
  const overlay=document.getElementById('postOverlay');
  const article=document.getElementById('postArticle');
  const title=post.title?.rendered ?? 'ì œëª© ì—†ìŒ';
  const authorName=post._embedded?.author?.[0]?.name ?? 'ìµëª…';
  const avatar=post._embedded?.author?.[0]?.avatar_urls?.['96'] || post._embedded?.author?.[0]?.avatar_urls?.['48'] || '';
  const cats=(post._embedded?.['wp:term']?.[0]||[]).map(t=>t.name).join(', ') || '-';
  const dateStr=formatDate(post.date);
  const contentHTML=post.content?.rendered ?? post.excerpt?.rendered ?? '';
  const featuredUrl=post._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';

  // ìƒˆë¡œìš´ í¬ìŠ¤íŠ¸ ë ˆì´ì•„ì›ƒ: ì¸ë„¤ì¼ê³¼ ì œëª©/ì •ë³´ ë¨¼ì € í‘œì‹œ
  article.innerHTML=`
    <div class="post-header">
      ${featuredUrl?`<div class="post-header-image"><img src="${featuredUrl}" alt="featured image"></div>`:`<div class="post-header-image"><img src="${placeholderDataURI(800,600,'No Image')}" alt="no image"></div>`}
      <div class="post-header-info">
        <h1>${title}</h1>
        <div class="post-meta">
          <img src="${avatar || placeholderDataURI(96,96,'U')}" alt="author" style="width:52px;height:52px;border-radius:50%;object-fit:cover;">
          <div>
            <div style="font-weight:800;">${authorName}</div>
            <div style="color:var(--muted);font-size:13px">${dateStr} Â· ${cats}</div>
          </div>
        </div>
      </div>
    </div>
    <div class="post-content">${contentHTML}</div>
  `;
  
  // ì´ë¯¸ì§€ ë° ì„ë² ë“œ ìš”ì†Œ ìŠ¤íƒ€ì¼ ì¡°ì •
  article.querySelectorAll('.post-content img').forEach(img=>{ 
    img.style.maxWidth='100%'; 
    img.style.height='auto'; 
    img.style.display='block'; 
    img.style.margin='12px 0'; 
  });
  
  // ìœ íŠœë¸Œ ë“± ì„ë² ë“œ ìš”ì†Œ í¬ê¸° ì œí•œ
  article.querySelectorAll('.post-content iframe, .post-content video, .post-content embed').forEach(el=>{
    el.style.maxWidth='100%';
    el.style.width='100%';
    el.style.height='auto';
  });
  
  // ë¶ˆí•„ìš”í•œ ìš”ì†Œ ì œê±°
  try{ Array.from(article.querySelectorAll('.post-content *')).forEach(el=>{ if(el.textContent?.trim().includes('ì´ ê¸€ ê³µìœ í•˜ê¸°')) el.remove(); }); }catch(e){}
  try{ article.querySelectorAll('.updated, time[itemprop="dateModified"], [data-modified], .post-modified, .modified-date').forEach(el=>el.remove()); }catch(e){}

  // ê´€ë ¨ ê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
  loadRelatedPosts(post);

  // ì§„í–‰ë¥  ë°” ì´ˆê¸°í™”
  updatePostProgress();
  overlay.classList.remove('closing'); 
  overlay.classList.add('active'); 
  overlay.setAttribute('aria-hidden','false');
  overlay.scrollTop = 0;

  // ì£¼ì†Œ ê¸°ë¡
  history.pushState({page:'post',id:post.id}, '', `#post-${post.id}`);
}

/* ê´€ë ¨ ê¸€ */
async function loadRelatedPosts(post){
  const cats = post.categories || [];
  const catId = Array.isArray(cats) && cats.length ? cats[0] : null;
  const section=document.getElementById('relatedSection');
  const grid=document.getElementById('relatedGrid');
  grid.innerHTML=''; section.style.display='none';
  if(!catId){ return; }
  try{
    const res=await fetch(api(`posts?categories=${catId}&per_page=5&orderby=date&order=desc&exclude=${post.id}`),{headers:headers()});
    if(!res.ok) return;
    const arr=await res.json();
    const pick=Array.isArray(arr) ? arr.slice(0,4) : [];
    pick.forEach(p=>{ state.postsCache[p.id]=p; grid.appendChild(createCardNode(p)); });
    if(pick.length){ section.style.display='block'; }
  }catch(e){ console.error(e); }
}

/* ì§„í–‰ë¥  ë°” & íˆ´ë°” í‘œì‹œ */
function updatePostProgress(){
  const ov = document.getElementById('postOverlay');
  const bar = document.getElementById('progressBar');
  const toolbar = document.getElementById('postToolbar');
  if(!ov.classList.contains('active')) return;
  const max = ov.scrollHeight - ov.clientHeight;
  const pct = max>0 ? (ov.scrollTop / max) * 100 : 0;
  bar.style.width = Math.min(100, Math.max(0, pct)) + '%';

  // ì•½ê°„ì´ë¼ë„ ìœ„ë¡œ ìŠ¤í¬ë¡¤í•˜ë©´ íˆ´ë°” í‘œì‹œ
  const y = ov.scrollTop;
  if(y < state.lastScrollY - 2){ // ìœ„ë¡œ ìŠ¤í¬ë¡¤
    toolbar.classList.add('show');
  }else if(y > state.lastScrollY + 50){ // ì•„ë˜ë¡œ ì¶©ë¶„íˆ ìŠ¤í¬ë¡¤í•˜ë©´ ìˆ¨ê¸°ê¸°
    toolbar.classList.remove('show');
  }
  state.lastScrollY = y;
}

/* ê²€ìƒ‰ */
async function doSearch(q){
  if(!q||!q.trim()) return;
  const overlay=document.getElementById('searchOverlay');
  openOverlay(overlay);
  history.pushState({page:'search',query:q}, '', `#search?q=${encodeURIComponent(q)}`);

  const results=document.getElementById('searchResults'); results.innerHTML='';
  try{
    const res=await fetch(api(`posts?search=${encodeURIComponent(q)}&per_page=${HOME_PER_PAGE}&page=1`),{headers:headers()});
    if(!res.ok) throw new Error('search failed '+res.status);
    const posts=await res.json();
    if(!Array.isArray(posts) || posts.length===0){ results.innerHTML='<div style="padding:20px;color:var(--muted)">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'; return; }
    posts.forEach(p=>{ state.postsCache[p.id]=p; results.appendChild(createCardNode(p)); });
  }catch(e){ console.error(e); results.innerHTML='<div style="padding:20px;color:#d33">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>'; }
}

/* ê³µí†µ UI/ë¼ìš°í„°/ì˜¤ë²„ë ˆì´ */
const ui={
  toggleNav(close){
    const ov=document.getElementById('navOverlay');
    if(close===true) ov.classList.remove('active');
    else if(close===false) ov.classList.add('active');
    else ov.classList.toggle('active');
    const expanded=ov.classList.contains('active');
    const ctrl=document.querySelector('[aria-controls="navOverlay"]');
    if(ctrl) ctrl.setAttribute('aria-expanded', expanded);
    ov.setAttribute('aria-hidden', !expanded);
    document.body.style.overflow = expanded ? 'hidden' : '';
  },
  closeSearch(){ smoothHide(document.getElementById('searchOverlay')); }
};

const router={
  goHome(){
    closeAllOverlays();
    loadHome(1);
    window.scrollTo({top:0, behavior:'smooth'});
    history.pushState({page:'home'}, '', location.pathname.split('#')[0]);
  },
  openCategory(slug){ closeAllOverlays(); loadCategory(slug,1); },
  closeCategory(){ smoothHide(document.getElementById('categoryOverlay'), ()=>router.goHome()); },
  closePost(){ smoothHide(document.getElementById('postOverlay'), ()=>router.goHome()); },
  openAbout(){ closeAllOverlays(); openOverlay(document.getElementById('aboutPageSection')); history.pushState({page:'about'}, '', '#about'); },
  closeAbout(){ smoothHide(document.getElementById('aboutPageSection'), ()=>router.goHome()); },
  openEditors(){ closeAllOverlays(); openOverlay(document.getElementById('editorsOverlay')); loadEditors(); history.pushState({page:'editors'}, '', '#editors'); },
  closeEditors(){ smoothHide(document.getElementById('editorsOverlay'), ()=>router.goHome()); }
};

function openOverlay(el){ el.classList.remove('closing'); el.classList.add('active'); el.setAttribute('aria-hidden','false'); }
function smoothHide(el, after){ if(!el) return; el.classList.add('closing'); setTimeout(()=>{ el.classList.remove('active','closing'); el.setAttribute('aria-hidden','true'); if(typeof after==='function') after(); }, 180); }
function closeAllOverlays(){ ['categoryOverlay','postOverlay','searchOverlay','aboutPageSection','editorsOverlay'].forEach(id=>{ const el=document.getElementById(id); if(el){ el.classList.remove('active','closing'); el.setAttribute('aria-hidden','true'); } }); }

function openNavlessSearch(){ closeAllOverlays(); openOverlay(document.getElementById('searchOverlay')); const input=document.getElementById('searchInputTop'); if(input) input.focus(); history.pushState({page:'search'}, '', '#search'); }

/* URL ì§ì ‘ ì§„ì… ë¼ìš°íŒ… */
function routeFromURL(){
  const h=location.hash;
  if(!h || h==='#' || h.startsWith('#home')) return;
  if(h.startsWith('#post-')){ const id=parseInt(h.replace('#post-','')); if(id) openPostOverlayById(id); }
  else if(h.startsWith('#category-')){ const slug=h.replace('#category-','').split('?')[0]; const qs=new URLSearchParams(h.split('?')[1]||''); const p=parseInt(qs.get('p')||'1',10); loadCategory(slug, p); }
  else if(h.startsWith('#search')){ const q=new URLSearchParams(h.split('?')[1]).get('q'); q ? doSearch(q) : openNavlessSearch(); }
  else if(h==='#editors'){ router.openEditors(); }
  else if(h==='#about'){ router.openAbout(); }
}

/* ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸: í™ˆ to-top / í¬ìŠ¤íŠ¸ ì§„í–‰ë¥  */
window.addEventListener('scroll', ()=>{
  const toTop=document.getElementById('toTopBtn');
  if(window.scrollY>200) toTop.classList.add('show'); else toTop.classList.remove('show');
});
document.getElementById('toTopBtn').addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));

/* í¬ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ë‚´ë¶€ ìŠ¤í¬ë¡¤ì— ë°˜ì‘ */
document.getElementById('postOverlay').addEventListener('scroll', updatePostProgress);

/* ì´ˆê¸°í™” */
document.addEventListener('DOMContentLoaded', ()=>{
  // í…Œë§ˆ ì´ˆê¸°í™”
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', savedTheme);
  if(savedTheme === 'dark') {
    document.getElementById('themeIcon').textContent = 'â˜€ï¸';
    document.getElementById('themeText').textContent = 'ë¼ì´íŠ¸ëª¨ë“œ';
  }

  renderNavList();
  loadHome(1);
  routeFromURL();

  const topInput=document.getElementById('searchInputTop');
  if(topInput){
    topInput.addEventListener('keydown', e=>{
      if(e.key==='Enter') doSearch(e.target.value);
      else if(e.key==='Escape') ui.closeSearch();
    });
  }

  const gns=document.getElementById('globalNavSearch');
  if(gns){
    gns.addEventListener('keydown', e=>{
      if(e.key==='Enter'){
        const q=e.target.value; ui.toggleNav(true); openNavlessSearch();
        setTimeout(()=>{ const top=document.getElementById('searchInputTop'); if(top){ top.value=q; if(q) doSearch(q); } }, 120);
      }
    });
  }

  window.addEventListener('popstate', ()=>{ closeAllOverlays(); routeFromURL(); });
});
  </script>
</body>
</html>
