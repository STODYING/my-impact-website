<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IMPACT — MAKE A IMPACT</title>
  <meta name="description" content="IMPACT — 카테고리 퀵내비, 진행률 바, 관련글, 페이지네이션, 다크모드 지원">

  <link rel="icon" href="logo.png" type="image/png">
  <link rel="apple-touch-icon" href="logo.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="IMPACT">

  <style>
  /* ===========================
     색상 토큰 & 다크 모드
     =========================== */
  :root{
    --bg: #f6f7f9;
    --text: #111;
    --muted: #666;
    --card: #fff;
    --border: rgba(0,0,0,0.08);
    --shadow: rgba(0,0,0,0.06);
    --accent: #2e8b57;
    --overlay: #fff;
    --progress: #ff7a1a;
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg: #0f1115;
      --text: #f1f3f5;
      --muted: #a6adbb;
      --card: #171a21;
      --border: rgba(255,255,255,0.08);
      --shadow: rgba(0,0,0,0.35);
      --accent: #39c07c;
      --overlay: #12151b;
      --progress: #ff9f45;
    }
    img, video { filter: none !important; } /* 이미지 색 반전 방지 */
  }

  /* ===========================
     기본/리셋
     =========================== */
  *, *::before, *::after { box-sizing: border-box; }
  html, body { height: 100%; }
  body{
    margin:0; background:var(--bg); color:var(--text); line-height:1.6;
    font-family:"Noto Sans KR","Apple SD Gothic Neo","Segoe UI",Roboto,Arial,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    scroll-behavior:smooth; overscroll-behavior-y:contain; -webkit-tap-highlight-color:transparent;
  }
  a{ color:inherit; text-decoration:none; }
  img{ display:block; max-width:100%; height:auto; }
  input[type="search"]::-webkit-search-cancel-button{ cursor:pointer; }

  .wrap{ max-width:1400px; margin:0 auto; padding:0 20px; }
  .hidden{ display:none !important; }
  .visually-hidden{
    position:absolute !important; height:1px; width:1px; overflow:hidden;
    clip:rect(1px,1px,1px,1px); white-space:nowrap;
  }

  /* ===========================
     HEADER
     =========================== */
  header.header{
    position:sticky; top:0; z-index:1200; background:var(--card);
    border-bottom:1px solid var(--border); backdrop-filter: blur(6px);
    transition: box-shadow .25s ease, transform .18s ease;
  }
  .header-inner{
    height:72px; display:flex; align-items:center; gap:16px;
    max-width:1400px; margin:0 auto; padding:0 20px;
  }
  .brand{ display:flex; align-items:center; gap:12px; min-width:180px; }
  .brand .logo{
    display:flex; gap:8px; align-items:center; font-weight:900; font-size:26px; letter-spacing:1px; cursor:pointer;
  }
  .brand .logo small{ font-size:11px; color:var(--muted); font-weight:800; display:block; line-height:1; }

  /* 로고 옆 퀵 카테고리 */
  .quick-cats{ display:flex; align-items:center; gap:8px; flex:1 1 auto; }
  .quick-cat-btn{
    display:inline-flex; align-items:center; justify-content:center;
    padding:8px 12px; border-radius:999px; font-weight:800; font-size:13px;
    border:1px solid var(--border); background:var(--card); cursor:pointer;
    transition: transform .12s ease, box-shadow .12s ease, background .12s ease, color .12s ease;
    user-select:none;
  }
  .quick-cat-btn:hover{ transform:translateY(-1px); box-shadow:0 6px 16px var(--shadow); }
  .quick-cat-btn:active{ transform:translateY(0); }
  .quick-cat-btn[data-slug="tech"]{ color:#0b63ff; }
  .quick-cat-btn[data-slug="style"]{ color:#199e1d; }
  .quick-cat-btn[data-slug="culture"]{ color:#7b41e6; }
  .quick-cat-btn[data-slug="life"]{ color:#c96f00; }
  .quick-cat-btn[data-slug="eat"]{ color:#e23e2b; }

  .header-actions{ display:flex; gap:8px; align-items:center; }
  .btn{
    border-radius:10px; background:var(--card); padding:8px 12px; border:1px solid var(--border);
    font-weight:700; font-size:14px; cursor:pointer; transition: transform .12s ease, box-shadow .12s ease;
    color:var(--text);
  }
  .btn:hover{ box-shadow:0 6px 16px var(--shadow); }
  .btn:active{ transform:translateY(1px); }
  .btn.primary{ background:linear-gradient(135deg,var(--accent),#1f7a6f); color:#fff; border:none; }

  @media (max-width:980px){ .quick-cats{ display:none; } }

  /* ===========================
     NAV OVERLAY
     =========================== */
  .nav-overlay{
    position:fixed; top:0; right:-50%; width:50%; height:100vh;
    background:var(--overlay); z-index:2200; transition:right .32s cubic-bezier(.2,.9,.2,1), visibility 0s .32s, opacity .32s;
    display:flex; flex-direction:column; padding:64px 40px; box-shadow:-6px 0 40px var(--shadow);
    visibility:hidden; opacity:0; color:var(--text);
  }
  .nav-overlay.active{ right:0; visibility:visible; opacity:1; transition:right .32s cubic-bezier(.2,.9,.2,1), visibility 0s, opacity .32s; }
  .nav-close{ position:absolute; top:28px; right:28px; background:none; border:none; font-size:30px; cursor:pointer; color:var(--text); z-index:2300; }
  .nav-search{ display:flex; align-items:center; gap:10px; margin-bottom:36px; }
  .nav-search input[type="search"]{ flex:1; border:none; border-bottom:2px solid var(--text); padding:10px 8px; outline:none; font-weight:700; font-size:16px; background:transparent; color:var(--text); }
  .nav-list{ list-style:none; padding:0; margin:0 0 24px; display:flex; flex-direction:column; gap:18px; }
  .nav-list li{ font-size:28px; font-weight:900; cursor:pointer; color:var(--text); transition: color .16s ease; }
  .nav-list li:hover{ color:var(--accent); }
  .nav-footer-links{ margin-top:auto; display:flex; gap:12px; align-items:center; font-weight:800; }
  .nav-footer-links a{ color:var(--text); font-size:13px; cursor:pointer; }

  @media (max-width:680px){
    .nav-overlay{ left:0; right:-100%; width:100%; padding:36px 20px; box-shadow:none; }
    .nav-overlay.active{ right:0; left:0; }
    .nav-list li{ font-size:22px; }
    .nav-close{ top:20px; right:20px; }
  }

  /* ===========================
     HOME
     =========================== */
  .home{ max-width:1400px; margin:28px auto; display:flex; flex-direction:column; gap:28px; padding:0 20px 40px; }
  .row{ display:grid; grid-template-columns:2fr 1fr; gap:20px; align-items:start; }
  .col-left{ position:relative; border-radius:12px; overflow:hidden; min-height:360px; background:#222; cursor:pointer; }
  .col-left .hero{ width:100%; height:100%; object-fit:cover; display:block; min-height:360px; }
  .col-left .hero-overlay{
    position:absolute; inset:auto 0 0 0; padding:22px; display:flex; flex-direction:column; gap:12px;
    background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,0.55)); color:#fff;
  }
  .col-left .hero-title{ margin:0; font-size:28px; font-weight:900; line-height:1.05; max-width:92%; }
  .col-right{ display:flex; flex-direction:column; gap:12px; }

  .card{ background:var(--card); border-radius:10px; overflow:hidden; border:1px solid var(--border);
         transition: box-shadow .16s ease, transform .12s ease; cursor:pointer; position:relative; z-index:1; color:var(--text); }
  .card:hover{ transform:translateY(-6px); box-shadow:0 12px 30px var(--shadow); }
  .card .thumb{ width:100%; height:120px; overflow:hidden; background:#2b2f36; }
  .card .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
  .card .card-body{ padding:12px; }
  .card h3{ font-size:16px; font-weight:800; margin:0 0 8px; color:var(--text); }
  .cat-badge{ display:inline-block; padding:6px 10px; border-radius:6px; font-weight:800; font-size:12px; color:#fff; }
  .hero-cats{ position:absolute; right:16px; bottom:16px; display:flex; gap:6px; }
  .cat-tech{ background:#1e90ff; } .cat-eat{ background:#ff6347; }
  .cat-style{ background:#32cd32; } .cat-culture{ background:#8a2be2; }
  .cat-life{ background:#ffa500; color:#000; } .cat-editors-pick{ background:#ff1493; }

  /* 페이지네이션 */
  .pager{ display:flex; justify-content:center; align-items:center; gap:8px; padding:18px 0 8px; flex-wrap:wrap; color:var(--text);}
  .pager a, .pager button{
    background:var(--card); border:1px solid var(--border); color:var(--text);
    padding:6px 10px; border-radius:8px; cursor:pointer; font-weight:800; font-size:13px;
  }
  .pager .current{ background:transparent; border:none; color:#ff7a1a; font-weight:900; }
  .pager .ellipsis{ opacity:.6; border:none; background:transparent; }

  @media (max-width:1100px){
    .row{ grid-template-columns:1fr; }
    .col-right{ grid-auto-rows:unset; grid-template-columns:1fr; display:grid; gap:12px; }
  }

  /* ===========================
     공통 오버레이 (부드러운 열고/닫기 180ms)
     =========================== */
  .category-overlay, .post-overlay, .search-overlay, .about-page, .editors-overlay{
    position:fixed; inset:0; z-index:1800; overflow:auto; padding:28px; background:var(--overlay);
    opacity:0; visibility:hidden; transform:translateY(8px);
    transition:opacity .18s ease-out, transform .18s ease-out, visibility 0s .18s; color:var(--text);
  }
  .post-overlay{ z-index:1900; }
  .category-overlay.active, .post-overlay.active, .search-overlay.active, .about-page.active, .editors-overlay.active{
    opacity:1; visibility:visible; transform:translateY(0); transition:opacity .18s ease-out, transform .18s ease-out, visibility 0s;
  }
  .category-overlay.closing, .post-overlay.closing, .search-overlay.closing, .about-page.closing, .editors-overlay.closing{
    opacity:0; transform:translateY(8px); visibility:visible;
  }

  /* ===========================
     POST 화면(진행바/툴바/히어로)
     =========================== */
  .post-article{ margin:0 auto; max-width:900px; }
  .post-article h1{ font-size:34px; font-weight:900; margin:0 0 12px; color:var(--text); }
  .post-content{ color:var(--text); line-height:1.9; }
  /* 화면 비율에 맞춰 크게: 기본 66vh, 모바일 72vh */
  .post-hero{ width:100%; height:66vh; max-height:90vh; overflow:hidden; border-radius:12px; margin:0 0 16px 0; background:#000; }
  .post-hero img{ width:100%; height:100%; object-fit:cover; display:block; }

  @media (max-width:700px){ .post-hero{ height:72vh; } }

  /* 읽기 진행률 바 */
  .progress-wrap{
    position:sticky; top:0; z-index:2100; background:transparent; height:4px; margin:-28px -28px 24px; /* 오버레이 좌우 패딩 보정 */
  }
  .progress-bar{
    width:0%; height:4px; background:var(--progress);
    transition:width .08s linear; border-top-right-radius:2px; border-bottom-right-radius:2px;
  }

  /* 스크롤 방향에 따라 나타나는 포스트 상단 툴바 */
  .post-toolbar{
    position:fixed; top:8px; left:50%; transform:translateX(-50%);
    width:min(1200px, calc(100% - 24px)); height:48px; display:flex; justify-content:space-between; align-items:center;
    padding:0 12px; border-radius:12px; background:color-mix(in oklab, var(--overlay) 88%, transparent);
    border:1px solid var(--border); box-shadow:0 6px 20px var(--shadow);
    backdrop-filter: blur(8px);
    transition:opacity .18s ease, transform .18s ease; opacity:0; pointer-events:none;
    color:var(--text);
  }
  .post-toolbar.show{ opacity:1; pointer-events:auto; transform:translateX(-50%) translateY(0); }
  .post-toolbar .tool-left{ display:flex; align-items:center; gap:10px; font-weight:900; cursor:pointer; }
  .post-toolbar .tool-right .hamburger{ width:36px; height:28px; border-radius:8px; border:1px solid var(--border); background:var(--card); cursor:pointer; display:flex; align-items:center; justify-content:center; }
  .post-toolbar .hamburger span{ display:block; width:18px; height:2px; background:var(--text); position:relative; }
  .post-toolbar .hamburger span::before, .post-toolbar .hamburger span::after{
    content:""; position:absolute; left:0; width:18px; height:2px; background:var(--text);
  }
  .post-toolbar .hamburger span::before{ top:-6px; }
  .post-toolbar .hamburger span::after{ top:6px; }

  /* 검색바 */
  .search-bar{ display:flex; align-items:center; background:var(--card); border-radius:50px; box-shadow:0 6px 20px var(--shadow); padding:6px 10px; gap:8px; border:1px solid var(--border); }
  .search-bar input[type="search"]{ flex:1; border:none; outline:none; font-size:16px; padding:12px 14px; border-radius:50px; background:transparent; color:var(--text); }
  .search-bar .close-btn{ background:none; border:none; font-size:20px; cursor:pointer; color:var(--muted); }

  /* TO TOP */
  .to-top{
    position:fixed; right:22px; bottom:22px; width:52px; height:52px; border-radius:12px; background:var(--card); color:var(--text);
    display:flex; align-items:center; justify-content:center; font-size:22px; z-index:2500; box-shadow:0 12px 30px var(--shadow);
    opacity:0; transform:translateY(20px); border:1px solid var(--border); transition:all .28s cubic-bezier(.2,.9,.2,1); cursor:pointer;
  }
  .to-top.show{ opacity:1; transform:translateY(0); }

  /* FOOTER */
  footer.site-footer{ background:#111; color:#eee; padding:40px 20px; margin-top:20px; }
  @media (prefers-color-scheme: dark){ footer.site-footer{ background:#0b0c10; color:#cfd3dc; } }
  .footer-inner{ max-width:1400px; margin:0 auto; display:flex; justify-content:space-between; gap:20px; align-items:flex-start; flex-wrap:wrap; }
  .footer-brand{ font-size:40px; font-weight:900; color:#fff; font-style:italic; }
  .footer-links a{ color:#ddd; cursor:pointer; display:block; font-weight:800; margin-bottom:8px; }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header" id="siteHeader" role="banner" aria-label="사이트 헤더">
    <div class="header-inner wrap">
      <div class="brand" aria-label="IMPACT brand">
        <div class="logo" id="logoBtn" onclick="router.goHome()" tabindex="0" title="IMPACT — go home">
          <img src="logo.png" alt="IMPACT logo" style="width:36px;height:36px;border-radius:8px;object-fit:cover;">
          <div>
            <div style="line-height:1">IMPACT</div>
            <small>MAKE A IMPACT</small>
          </div>
        </div>
      </div>

      <!-- 로고 옆 퀵 카테고리 -->
      <nav class="quick-cats" aria-label="빠른 카테고리">
        <button class="quick-cat-btn" data-slug="tech"    onclick="router.openCategory('tech')"    title="TECH">tech</button>
        <button class="quick-cat-btn" data-slug="style"   onclick="router.openCategory('style')"   title="STYLE">style</button>
        <button class="quick-cat-btn" data-slug="culture" onclick="router.openCategory('culture')" title="CULTURE">culture</button>
        <button class="quick-cat-btn" data-slug="life"    onclick="router.openCategory('life')"    title="LIFE">life</button>
        <button class="quick-cat-btn" data-slug="eat"     onclick="router.openCategory('eat')"     title="EAT">eat</button>
      </nav>

      <div class="header-actions" role="navigation" aria-label="상단 메뉴">
        <button class="btn" id="topSearchBtn" onclick="openNavlessSearch()">검색</button>
        <button class="btn" aria-controls="navOverlay" aria-expanded="false" onclick="ui.toggleNav()">더보기</button>
      </div>
    </div>
  </header>

  <!-- NAV OVERLAY -->
  <aside class="nav-overlay" id="navOverlay" aria-hidden="true" aria-label="카테고리 네비게이션">
    <button class="nav-close" aria-label="네비 닫기" onclick="ui.toggleNav(true)">×</button>
    <div style="display:flex;flex-direction:column;gap:12px;">
      <div class="nav-search" role="search" aria-label="네비 검색">
        <span style="font-size:18px">🔍</span>
        <input type="search" id="globalNavSearch" placeholder="검색어 입력" aria-label="네비 검색어">
      </div>
      <ul class="nav-list" id="navList" role="menu" aria-label="카테고리 목록"></ul>
      <div class="nav-footer-links">
        <a href="javascript:void(0)" onclick="ui.toggleNav(true); router.openAbout()">ABOUT</a>
        <a href="javascript:void(0)" onclick="ui.toggleNav(true); router.openEditors()">EDITORS</a>
        <a href="javascript:void(0)" onclick="alert('NEWSLETTER 페이지는 추후 구현됩니다')">NEWSLETTER</a>
        <a href="https://www.instagram.com/ceo_impact_official" target="_blank" rel="noopener">INSTAGRAM</a>
      </div>
    </div>
  </aside>

  <!-- HOME -->
  <main class="home" id="home" role="main" aria-live="polite" tabindex="-1">
    <div id="rowsContainer" aria-live="polite"></div>
    <div id="homeLoading" style="text-align:center;color:var(--muted);padding:18px 0"></div>
    <nav id="homePager" class="pager" aria-label="페이지 이동"></nav>
  </main>

  <!-- CATEGORY OVERLAY -->
  <section class="category-overlay" id="categoryOverlay" aria-hidden="true" role="region">
    <div class="wrap">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;border-bottom:1px solid var(--border);padding-bottom:12px;">
        <div>
          <div id="categoryOverlayTitle" style="font-size:24px;font-weight:900;">CATEGORY</div>
          <div id="categoryOverlaySubtitle" style="font-size:13px;color:var(--muted);margin-top:4px;">카테고리 설명</div>
        </div>
        <div><button class="btn" onclick="router.closeCategory()">닫기</button></div>
      </div>
      <div id="categoryGrid" class="category-grid" style="margin-top:18px; display:grid; gap:18px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); padding:20px 0 10px;"></div>
      <nav id="categoryPager" class="pager" aria-label="카테고리 페이지 이동"></nav>
      <div id="categoryLoading" style="text-align:center;color:var(--muted);padding:14px 0"></div>
    </div>
  </section>

  <!-- EDITORS OVERLAY -->
  <section class="editors-overlay" id="editorsOverlay" aria-hidden="true" role="region">
    <div class="wrap">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;border-bottom:1px solid var(--border);padding-bottom:14px;">
        <div>
          <h2 style="font-size:24px;margin:0">EDITORS</h2>
          <div style="color:var(--muted);font-size:13px">참여 에디터와 글을 확인하세요.</div>
        </div>
        <div><button class="btn" onclick="router.closeEditors()">닫기</button></div>
      </div>
      <div id="editorsGridWrapper" style="margin-top:18px;">
        <div id="editorsGrid" class="editors-grid" style="display:grid; grid-template-columns: repeat(auto-fill,minmax(160px,1fr)); gap:16px;"></div>
        <div id="editorsLoading" style="text-align:center;color:var(--muted);padding:18px 0"></div>
      </div>
      <div id="editorProfileSection" style="display:none;margin-top:18px;">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;">
          <div>
            <div id="editorProfileName" style="font-weight:900;font-size:20px"></div>
            <div id="editorProfileBio" style="color:var(--muted);font-size:13px"></div>
          </div>
          <div><button class="btn" onclick="showEditorsList()">목록으로</button></div>
        </div>
        <div id="editorPostsGrid" class="category-grid" style="display:grid; gap:18px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));"></div>
        <div id="editorPostsLoading" style="text-align:center;color:var(--muted);padding:18px 0"></div>
      </div>
    </div>
  </section>

  <!-- POST OVERLAY -->
  <article class="post-overlay" id="postOverlay" aria-hidden="true" role="article">
    <!-- 상단 진행률/툴바 -->
    <div class="progress-wrap"><div class="progress-bar" id="progressBar"></div></div>
    <div class="post-toolbar" id="postToolbar" aria-hidden="true">
      <div class="tool-left" onclick="router.goHome()">
        <img src="logo.png" alt="IMPACT" style="width:24px;height:24px;border-radius:6px;object-fit:cover;">
        <span>IMPACT</span>
      </div>
      <div class="tool-right">
        <button class="hamburger" aria-label="메뉴" onclick="ui.toggleNav(false)"><span></span></button>
      </div>
    </div>

    <div style="width:100%;max-width:1200px;margin:0 auto;">
      <div style="display:flex;justify-content:flex-end;gap:12px;margin-bottom:18px">
        <button class="btn" onclick="router.closePost()">닫기</button>
      </div>
      <div class="post-article" id="postArticle"></div>

      <!-- 관련 글(같은 카테고리 최신 4개) -->
      <section id="relatedSection" style="max-width:1200px;margin:28px auto 0;display:none;">
        <h3 style="font-size:20px;font-weight:900;margin:0 0 12px;">관련 글</h3>
        <div id="relatedGrid" style="display:grid; gap:16px; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"></div>
      </section>
    </div>
  </article>

  <!-- SEARCH OVERLAY -->
  <section class="search-overlay" id="searchOverlay" aria-hidden="true" role="search">
    <div class="wrap" style="max-width:1100px;margin:0 auto;">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px">
        <div style="flex:1">
          <div class="search-bar" role="search" aria-label="사이트 검색">
            <input type="search" class="search-input" id="searchInputTop" placeholder="검색어 입력 (Enter)" aria-label="검색어">
            <button type="button" class="close-btn" onclick="ui.closeSearch()">×</button>
          </div>
        </div>
      </div>
      <div id="searchResults" class="category-grid" style="display:grid; gap:18px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));"></div>
    </div>
  </section>

  <!-- ABOUT PAGE -->
  <section class="about-page" id="aboutPageSection" aria-hidden="true" role="region">
    <div class="wrap">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:18px">
        <div>
          <h2 style="font-size:32px;margin-bottom:10px">ABOUT</h2>
          <div style="color:var(--text);font-size:15px;line-height:1.8">
            <p><strong>IMPACT</strong> 는 現·前 KAIST IP-CEO 및 POSTECH CEO 학생들이 함께 만드는 심층 콘텐츠 플랫폼입니다.</p>
            <p>기술·경영·창의성의 교차점에서 데이터를 바탕으로 통찰을 전달합니다.</p>
          </div>
          <div style="margin-top:20px"><button class="btn" onclick="router.closeAbout()">닫기</button></div>
        </div>
      </div>
    </div>
  </section>

  <!-- TO TOP -->
  <button class="to-top" id="toTopBtn" title="맨 위로" aria-label="맨 위로">↑</button>

  <!-- FOOTER -->
  <footer class="site-footer" role="contentinfo" aria-label="사이트 푸터">
    <div class="wrap footer-inner">
      <div>
        <div class="footer-brand">IMPACT</div>
        <div style="margin-top:10px;color:#ddd;font-size:13px">광고 제휴 | <a href="mailto:ceo.impact.official@gmail.com">ceo.impact.official@gmail.com</a></div>
        <div style="color:#ddd;font-size:13px;margin-top:6px">보도자료 | <a href="mailto:ceo.impact.official@gmail.com">ceo.impact.official@gmail.com</a></div>
      </div>
      <div class="footer-links">
        <a href="javascript:void(0)" onclick="router.openAbout()">ABOUT</a>
        <a href="javascript:void(0)" onclick="router.openEditors()">EDITORS</a>
        <a href="javascript:void(0)" onclick="alert('NEWSLETTER 페이지는 추후 구현됩니다')">NEWSLETTER</a>
        <a href="https://www.instagram.com/ceo_impact_official" target="_blank" rel="noopener">INSTAGRAM</a>
      </div>
      <div class="footer-right"><div style="font-weight:800;color:#fff">IMPACT CEO. ALL RIGHTS RESERVED.</div></div>
    </div>
  </footer>

  <!-- 카드 템플릿 -->
  <template id="cardTpl">
    <article class="card" role="article">
      <div class="thumb"><img src="" alt=""></div>
      <div class="card-body">
        <div class="cat-row"></div>
        <h3 class="title"></h3>
        <div class="meta" style="display:flex;align-items:center;gap:8px;color:var(--muted);font-size:13px;">
          <img class="author-avatar" src="" alt="" style="width:36px;height:36px;border-radius:50%;object-fit:cover;">
          <div>
            <div class="author-name" style="color:var(--text);font-weight:800;"></div>
            <div class="date" style="font-size:12px;"></div>
          </div>
        </div>
      </div>
    </article>
  </template>

  <!-- 에디터 카드 템플릿 -->
  <template id="editorTpl">
    <div class="editor-card" role="button" tabindex="0" style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center;display:flex;flex-direction:column;align-items:center;gap:10px;cursor:pointer;">
      <img class="editor-avatar" src="" alt="" style="width:84px;height:84px;border-radius:50%;object-fit:cover;">
      <div class="editor-name" style="font-weight:800;font-size:15px;color:var(--text)"></div>
      <div class="editor-bio" style="font-size:12px;color:var(--muted)"></div>
    </div>
  </template>

  <script>
/* ==========================================================
   상수/상태
   ========================================================== */
const HOME_PER_PAGE = 20;               // (요청) 한 페이지 최대 20개
const CATEGORIES = { tech:318, eat:123073, style:2286, culture:1098, life:124, "editors-pick":259543 };
const NAV_ORDER = ["TECH","EAT","STYLE","CULTURE","LIFE","EDITORS' PICK"];

const state = {
  homePage: 1,
  homeTotalPages: 1,
  postsCache: {},
  editorsList: [],
  editorsLoaded: false,
  currentScrollPos: 0,
  lastScrollY: 0,
  category: { slug:null, page:1, totalPages:1 }
};

function api(path){
  const p = path.includes('_embed') ? path : (path + (path.includes('?') ? '&' : '?') + '_embed');
  return `/.netlify/functions/wpProxy?path=${encodeURIComponent(p)}`;
}
function headers(){ return {}; }

/* 유틸 */
function formatDate(dstr){ try{ const d=new Date(dstr); return `${d.getFullYear()}. ${String(d.getMonth()+1).padStart(2,'0')}. ${String(d.getDate()).padStart(2,'0')}.`; }catch(e){ return ''; } }
function placeholderDataURI(w=600,h=400,txt='No Image'){ const svg=`<svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}'><rect width='100%' height='100%' fill='#2b2f36'/><text x='50%' y='50%' fill='#9aa3af' font-size='20' text-anchor='middle' dominant-baseline='middle'>${txt}</text></svg>`; return 'data:image/svg+xml;charset=UTF-8,'+encodeURIComponent(svg); }
function pickCategoryClass(s){ if(!s) return ''; s=String(s).toLowerCase(); if(s.includes('tech'))return'cat-tech'; if(s.includes('eat'))return'cat-eat'; if(s.includes('style'))return'cat-style'; if(s.includes('culture'))return'cat-culture'; if(s.includes('life'))return'cat-life'; if(s.includes('editor'))return'cat-editors-pick'; return ''; }
function stripTags(str=''){ return str.replace(/<\/?[^>]+(>|$)/g,""); }

/* NAV 목록 */
function renderNavList(){
  const navList=document.getElementById('navList');
  navList.innerHTML='';
  NAV_ORDER.forEach(item=>{
    const li=document.createElement('li');
    li.textContent=item; li.tabIndex=0; li.setAttribute('role','menuitem');
    li.addEventListener('click', ()=>{
      ui.toggleNav(true);
      const slug=item.toLowerCase().replace(/'/g,'').replace(/\s/g,'-');
      if(CATEGORIES[slug]||slug==='editors-pick') router.openCategory(slug);
    });
    li.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' ') li.click(); });
    navList.appendChild(li);
  });
}

/* 카드 */
function createCardNode(post){
  const tpl=document.getElementById('cardTpl');
  const node=tpl.content.firstElementChild.cloneNode(true);
  const imgEl=node.querySelector('.thumb img');
  const thumbUrl=post._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';
  imgEl.src = thumbUrl || placeholderDataURI(1200,800,'No Image');
  imgEl.alt = (post.title?.rendered)?stripTags(post.title.rendered):'thumb';
  node.querySelector('.title').innerHTML = post.title?.rendered ?? '제목 없음';

  const avatarImg=node.querySelector('.author-avatar');
  const authorNameEl=node.querySelector('.author-name');
  const dateEl=node.querySelector('.date');
  if(post._embedded?.author?.[0]){
    const a=post._embedded.author[0];
    const av=a.avatar_urls ? (a.avatar_urls['48']||a.avatar_urls['24']) : '';
    avatarImg.src = av || placeholderDataURI(96,96,'U');
    avatarImg.alt = a.name || 'author';
    authorNameEl.textContent = a.name || '익명';
  }else{
    avatarImg.src = placeholderDataURI(96,96,'U'); authorNameEl.textContent='익명';
  }
  dateEl.textContent = formatDate(post.date);

  const catRow=document.createElement('div'); catRow.style.marginBottom='8px';
  const cats=post._embedded?.['wp:term']?.[0] || [];
  cats.forEach(c=>{
    if(c?.name){
      const span=document.createElement('span');
      span.className='cat-badge '+(pickCategoryClass(c.slug||c.name)||'');
      if(!pickCategoryClass(c.slug||c.name)) span.style.background='#666';
      span.textContent=c.name;
      catRow.appendChild(span);
    }
  });
  node.querySelector('.card-body').insertBefore(catRow, node.querySelector('.title'));

  node.addEventListener('click', ()=> openPostOverlayById(post.id));
  node.addEventListener('keydown', e=>{ if(e.key==='Enter') openPostOverlayById(post.id); });
  return node;
}

/* 홈: 페이지 단위 로드 + 페이지네이션 */
async function loadHome(page=1){
  const rows=document.getElementById('rowsContainer');
  const loading=document.getElementById('homeLoading');
  const pager=document.getElementById('homePager');
  rows.innerHTML=''; loading.textContent='로딩 중...'; pager.innerHTML='';
  try{
    const res=await fetch(api(`posts?per_page=${HOME_PER_PAGE}&page=${page}`),{headers:headers()});
    if(!res.ok){ loading.textContent='글을 불러오지 못했습니다.'; return; }
    const posts=await res.json();
    const totalPages = parseInt(res.headers.get('X-WP-TotalPages')||'1',10);
    state.homePage=page; state.homeTotalPages=totalPages;

    // 캐시
    posts.forEach(p=> state.postsCache[p.id]=p);

    // 1 큰 카드 + 4 카드 패턴 반복
    for(let i=0;i<posts.length;i+=5){
      const group=posts.slice(i,i+5);
      const row=document.createElement('div'); row.className='row';

      // left hero
      const leftPost=group[0];
      const leftDiv=document.createElement('div'); leftDiv.className='col-left';
      const heroUrl=leftPost? (leftPost._embedded?.['wp:featuredmedia']?.[0]?.source_url || '') : '';
      leftDiv.innerHTML=`
        <img class="hero" src="${heroUrl || placeholderDataURI(1200,800,'No Image')}" alt="hero">
        <div class="hero-overlay">
          <h2 class="hero-title">${leftPost?.title?.rendered ?? '제목 없음'}</h2>
          <div style="display:flex;align-items:center;gap:10px">
            <img class="hero-avatar" src="" alt="" style="width:36px;height:36px;border-radius:50%;object-fit:cover;">
            <div class="hero-author" style="font-weight:800;color:#fff"></div>
            <div class="hero-date" style="margin-left:8px;color:#eee;opacity:.9"></div>
          </div>
        </div>
      `;
      // author info
      const ha=leftPost?leftPost._embedded?.author?.[0]:null;
      const heroAvatar=leftDiv.querySelector('.hero-avatar');
      heroAvatar.src = (ha?.avatar_urls?.['48']||ha?.avatar_urls?.['24']) || placeholderDataURI(48,48,'U');
      leftDiv.querySelector('.hero-author').textContent = ha?.name || '익명';
      leftDiv.querySelector('.hero-date').textContent = leftPost?formatDate(leftPost.date):'';
      leftDiv.addEventListener('click', ()=> openPostOverlayById(leftPost.id));

      const catWrap=document.createElement('div'); catWrap.className='hero-cats';
      const firstCat=leftPost? leftPost._embedded?.['wp:term']?.[0]?.[0] : null;
      if(firstCat){
        const span=document.createElement('span');
        span.className='cat-badge '+pickCategoryClass(firstCat.slug||firstCat.name);
        span.textContent=firstCat.name; catWrap.appendChild(span);
      }
      leftDiv.appendChild(catWrap);
      row.appendChild(leftDiv);

      // right 4
      const rightDiv=document.createElement('div'); rightDiv.className='col-right';
      group.slice(1,5).forEach(p=>{ if(p){ state.postsCache[p.id]=p; rightDiv.appendChild(createCardNode(p)); } });
      row.appendChild(rightDiv);
      rows.appendChild(row);
    }

    loading.textContent = posts.length ? '' : '아직 게시된 글이 없습니다.';
    renderPager(pager, page, totalPages, (to)=> loadHome(to));
  }catch(e){
    console.error(e); loading.textContent='메인 글 불러오기 실패';
  }
}

/* 공통 페이지네이션 렌더 */
function renderPager(container, current, total, onChange){
  container.innerHTML='';
  if(total<=1) return;
  const mkBtn=(label, page, isCurrent=false, disabled=false)=>{
    const el=document.createElement('button');
    el.textContent=label;
    if(isCurrent){ el.className='current'; el.disabled=true; }
    else if(disabled){ el.disabled=true; }
    else{ el.addEventListener('click', ()=> onChange(page)); }
    container.appendChild(el);
  };
  const mkEll=()=>{ const s=document.createElement('span'); s.className='ellipsis'; s.textContent='…'; container.appendChild(s); };

  mkBtn('«', 1, false, current===1);
  if(total<=9){
    for(let p=1;p<=total;p++) mkBtn(p, p, p===current);
  }else{
    if(current<=4){
      for(let p=1;p<=5;p++) mkBtn(p,p,p===current);
      mkEll(); mkBtn(total, total);
    }else if(current>=total-3){
      mkBtn(1,1); mkEll();
      for(let p=total-4;p<=total;p++) mkBtn(p,p,p===current);
    }else{
      mkBtn(1,1); mkEll();
      for(let p=current-1;p<=current+1;p++) mkBtn(p,p,p===current);
      mkEll(); mkBtn(total,total);
    }
  }
  mkBtn('»', total, false, current===total);
}

/* 카테고리 페이지(페이지네이션 포함) */
async function loadCategory(slug, page=1){
  if(!slug) return;
  state.category.slug=slug; state.category.page=page;

  const overlay=document.getElementById('categoryOverlay');
  openOverlay(overlay);

  const title=document.getElementById('categoryOverlayTitle');
  const sub=document.getElementById('categoryOverlaySubtitle');
  const desc={ tech:'기술과 혁신 심층 분석', eat:'음식과 외식 문화', style:'패션·라이프스타일', culture:'문화와 예술', life:'일상과 삶', 'editors-pick':'에디터 추천' };
  title.textContent=slug.toUpperCase(); sub.textContent=desc[slug] || '카테고리';

  const grid=document.getElementById('categoryGrid'); grid.innerHTML='';
  document.getElementById('categoryLoading').textContent='로딩 중...';
  const pager=document.getElementById('categoryPager'); pager.innerHTML='';

  try{
    const catId=CATEGORIES[slug]; if(!catId){ document.getElementById('categoryLoading').textContent='알 수 없는 카테고리입니다.'; return; }
    const res=await fetch(api(`posts?categories=${catId}&per_page=${HOME_PER_PAGE}&page=${page}`),{headers:headers()});
    const posts=await res.json();
    const totalPages=parseInt(res.headers.get('X-WP-TotalPages')||'1',10);
    state.category.totalPages=totalPages;

    if(Array.isArray(posts)){
      posts.forEach(p=>{ state.postsCache[p.id]=p; grid.appendChild(createCardNode(p)); });
    }
    document.getElementById('categoryLoading').textContent='';
    renderPager(pager, page, totalPages, (to)=> loadCategory(slug, to));
    history.pushState({page:'category',slug,catPage:page}, '', `#category-${slug}?p=${page}`);
  }catch(e){ console.error(e); document.getElementById('categoryLoading').textContent='불러오기 실패'; }
}

/* 에디터 */
async function loadEditors(){
  if(state.editorsLoaded) return;
  document.getElementById('editorsLoading').textContent='로딩 중...';
  try{
    const res=await fetch(api(`users?per_page=100`),{headers:headers()});
    if(!res.ok) throw new Error('editors api fail '+res.status);
    const users=await res.json();
    state.editorsList=Array.isArray(users)?users:[];
    renderEditorsGrid();
    state.editorsLoaded=true;
    document.getElementById('editorsLoading').textContent='';
  }catch(e){ console.error(e); document.getElementById('editorsLoading').textContent='에디터 목록을 불러오지 못했습니다.'; }
}
function renderEditorsGrid(){
  const wrap=document.getElementById('editorsGrid'); wrap.innerHTML='';
  const tpl=document.getElementById('editorTpl');
  state.editorsList.forEach(u=>{
    const node=tpl.content.firstElementChild.cloneNode(true);
    const img=node.querySelector('.editor-avatar');
    img.src=(u.avatar_urls && (u.avatar_urls['96']||u.avatar_urls['48']||u.avatar_urls['24'])) || placeholderDataURI(96,96,'U');
    img.alt=u.name||u.slug||'editor';
    node.querySelector('.editor-name').textContent=u.name||u.slug||'unknown';
    node.querySelector('.editor-bio').textContent=u.description||'';
    node.addEventListener('click', ()=> openEditorProfile(u));
    node.addEventListener('keydown', e=>{ if(e.key==='Enter') openEditorProfile(u); });
    wrap.appendChild(node);
  });
}
async function openEditorProfile(user){
  if(!user?.id) return;
  document.getElementById('editorsGridWrapper').style.display='none';
  const section=document.getElementById('editorProfileSection'); section.style.display='block';
  document.getElementById('editorProfileName').textContent=user.name||user.slug||'';
  document.getElementById('editorProfileBio').textContent=user.description||'';
  const grid=document.getElementById('editorPostsGrid'); grid.innerHTML='';
  document.getElementById('editorPostsLoading').textContent='로딩 중...';

  try{
    const res=await fetch(api(`posts?author=${user.id}&per_page=50`),{headers:headers()});
    const posts=await res.json();
    if(Array.isArray(posts)){ posts.forEach(p=>{ state.postsCache[p.id]=p; grid.appendChild(createCardNode(p)); }); }
    document.getElementById('editorPostsLoading').textContent='';
    history.pushState({page:'editor', id:user.id}, '', `#editor-${user.id}`);
  }catch(e){ console.error(e); document.getElementById('editorPostsLoading').textContent='불러오기 실패'; }
}
function showEditorsList(){
  document.getElementById('editorProfileSection').style.display='none';
  document.getElementById('editorsGridWrapper').style.display='block';
  history.pushState({page:'editors'}, '', '#editors');
}

/* POST 오버레이 + 관련 글 + 진행률/툴바 */
async function openPostOverlayById(id){
  if(!id) return;
  state.currentScrollPos=window.scrollY;

  const cached=state.postsCache[id];
  if(cached?.content?.rendered){ renderPostOverlay(cached); return; }
  try{
    const res=await fetch(api(`posts/${id}`),{headers:headers()});
    if(!res.ok) throw new Error('post fetch failed '+res.status);
    const post=await res.json();
    if(!(post._embedded?.author)){
      const res2=await fetch(api(`posts/${id}?_embed`),{headers:headers()});
      if(res2.ok){ const p2=await res2.json(); state.postsCache[id]=p2; renderPostOverlay(p2); return; }
    }
    state.postsCache[id]=post; renderPostOverlay(post);
  }catch(e){ console.error(e); alert('포스트 로드 실패'); }
}

function renderPostOverlay(post){
  const overlay=document.getElementById('postOverlay');
  const article=document.getElementById('postArticle');
  const title=post.title?.rendered ?? '제목 없음';
  const authorName=post._embedded?.author?.[0]?.name ?? '익명';
  const avatar=post._embedded?.author?.[0]?.avatar_urls?.['96'] || post._embedded?.author?.[0]?.avatar_urls?.['48'] || '';
  const cats=(post._embedded?.['wp:term']?.[0]||[]).map(t=>t.name).join(', ') || '-';
  const dateStr=formatDate(post.date);
  const contentHTML=post.content?.rendered ?? post.excerpt?.rendered ?? '';
  const featuredUrl=post._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';

  article.innerHTML=`
    ${featuredUrl?`<figure class="post-hero"><img src="${featuredUrl}" alt="featured image"></figure>`:``}
    <h1>${title}</h1>
    <div class="post-meta" style="margin-bottom:14px;display:flex;gap:12px;align-items:center;">
      <img src="${avatar || placeholderDataURI(96,96,'U')}" alt="author" style="width:52px;height:52px;border-radius:50%;object-fit:cover;">
      <div><div style="font-weight:800;">${authorName}</div><div style="color:var(--muted);font-size:13px">${dateStr} · ${cats}</div></div>
    </div>
    <div class="post-content">${contentHTML}</div>
  `;
  article.querySelectorAll('.post-content img').forEach(img=>{ img.style.maxWidth='100%'; img.style.height='auto'; img.style.display='block'; img.style.margin='12px 0'; });
  // “이 글 공유하기”/수정일 제거
  try{ Array.from(article.querySelectorAll('.post-content *')).forEach(el=>{ if(el.textContent?.trim().includes('이 글 공유하기')) el.remove(); }); }catch(e){}
  try{ article.querySelectorAll('.updated, time[itemprop="dateModified"], [data-modified], .post-modified, .modified-date').forEach(el=>el.remove()); }catch(e){}

  // 관련 글 불러오기 (같은 카테고리 최신 4개, 현재글 제외)
  loadRelatedPosts(post);

  // 진행률 바 초기화
  updatePostProgress();
  overlay.classList.remove('closing'); overlay.classList.add('active'); overlay.setAttribute('aria-hidden','false');
  overlay.scrollTop = 0;

  // 주소 기록
  history.pushState({page:'post',id:post.id}, '', `#post-${post.id}`);
}

/* 관련 글 */
async function loadRelatedPosts(post){
  const cats = post.categories || [];
  const catId = Array.isArray(cats) && cats.length ? cats[0] : null;
  const section=document.getElementById('relatedSection');
  const grid=document.getElementById('relatedGrid');
  grid.innerHTML=''; section.style.display='none';
  if(!catId){ return; }
  try{
    const res=await fetch(api(`posts?categories=${catId}&per_page=5&orderby=date&order=desc&exclude=${post.id}`),{headers:headers()});
    if(!res.ok) return;
    const arr=await res.json();
    const pick=Array.isArray(arr) ? arr.slice(0,4) : [];
    pick.forEach(p=>{ state.postsCache[p.id]=p; grid.appendChild(createCardNode(p)); });
    if(pick.length){ section.style.display='block'; }
  }catch(e){ console.error(e); }
}

/* 진행률 바 & 툴바 표시 */
function updatePostProgress(){
  const ov = document.getElementById('postOverlay');
  const bar = document.getElementById('progressBar');
  const toolbar = document.getElementById('postToolbar');
  if(!ov.classList.contains('active')) return;
  const max = ov.scrollHeight - ov.clientHeight;
  const pct = max>0 ? (ov.scrollTop / max) * 100 : 0;
  bar.style.width = Math.min(100, Math.max(0, pct)) + '%';

  // 스크롤 방향에 따라 툴바 보이기/숨기기
  const y = ov.scrollTop;
  if(y < state.lastScrollY - 6){ // 위로 스크롤
    toolbar.classList.add('show');
  }else if(y > state.lastScrollY + 6){ // 아래로 스크롤
    toolbar.classList.remove('show');
  }
  state.lastScrollY = y;
}

/* 검색 */
async function doSearch(q){
  if(!q||!q.trim()) return;
  const overlay=document.getElementById('searchOverlay');
  openOverlay(overlay);
  history.pushState({page:'search',query:q}, '', `#search?q=${encodeURIComponent(q)}`);

  const results=document.getElementById('searchResults'); results.innerHTML='';
  try{
    const res=await fetch(api(`posts?search=${encodeURIComponent(q)}&per_page=${HOME_PER_PAGE}&page=1`),{headers:headers()});
    if(!res.ok) throw new Error('search failed '+res.status);
    const posts=await res.json();
    if(!Array.isArray(posts) || posts.length===0){ results.innerHTML='<div style="padding:20px;color:var(--muted)">검색 결과가 없습니다.</div>'; return; }
    posts.forEach(p=>{ state.postsCache[p.id]=p; results.appendChild(createCardNode(p)); });
  }catch(e){ console.error(e); results.innerHTML='<div style="padding:20px;color:#d33">검색 중 오류가 발생했습니다.</div>'; }
}

/* 공통 UI/라우터/오버레이 */
const ui={
  toggleNav(close){
    const ov=document.getElementById('navOverlay');
    if(close===true) ov.classList.remove('active');
    else if(close===false) ov.classList.add('active');
    else ov.classList.toggle('active');
    const expanded=ov.classList.contains('active');
    const ctrl=document.querySelector('[aria-controls="navOverlay"]');
    if(ctrl) ctrl.setAttribute('aria-expanded', expanded);
    ov.setAttribute('aria-hidden', !expanded);
    document.body.style.overflow = expanded ? 'hidden' : '';
  },
  closeSearch(){ smoothHide(document.getElementById('searchOverlay')); }
};

const router={
  goHome(){
    closeAllOverlays();
    loadHome(1);
    window.scrollTo({top:0, behavior:'smooth'});
    history.pushState({page:'home'}, '', location.pathname.split('#')[0]);
  },
  openCategory(slug){ closeAllOverlays(); loadCategory(slug,1); },
  closeCategory(){ smoothHide(document.getElementById('categoryOverlay'), ()=>router.goHome()); },
  closePost(){ smoothHide(document.getElementById('postOverlay'), ()=>router.goHome()); },
  openAbout(){ closeAllOverlays(); openOverlay(document.getElementById('aboutPageSection')); history.pushState({page:'about'}, '', '#about'); },
  closeAbout(){ smoothHide(document.getElementById('aboutPageSection'), ()=>router.goHome()); },
  openEditors(){ closeAllOverlays(); openOverlay(document.getElementById('editorsOverlay')); loadEditors(); history.pushState({page:'editors'}, '', '#editors'); },
  closeEditors(){ smoothHide(document.getElementById('editorsOverlay'), ()=>router.goHome()); }
};

function openOverlay(el){ el.classList.remove('closing'); el.classList.add('active'); el.setAttribute('aria-hidden','false'); }
function smoothHide(el, after){ if(!el) return; el.classList.add('closing'); setTimeout(()=>{ el.classList.remove('active','closing'); el.setAttribute('aria-hidden','true'); if(typeof after==='function') after(); }, 180); }
function closeAllOverlays(){ ['categoryOverlay','postOverlay','searchOverlay','aboutPageSection','editorsOverlay'].forEach(id=>{ const el=document.getElementById(id); if(el){ el.classList.remove('active','closing'); el.setAttribute('aria-hidden','true'); } }); }

function openNavlessSearch(){ closeAllOverlays(); openOverlay(document.getElementById('searchOverlay')); const input=document.getElementById('searchInputTop'); if(input) input.focus(); history.pushState({page:'search'}, '', '#search'); }

/* URL 직접 진입 라우팅 */
function routeFromURL(){
  const h=location.hash;
  if(!h || h==='#' || h.startsWith('#home')) return;
  if(h.startsWith('#post-')){ const id=parseInt(h.replace('#post-','')); if(id) openPostOverlayById(id); }
  else if(h.startsWith('#category-')){ const slug=h.replace('#category-','').split('?')[0]; const qs=new URLSearchParams(h.split('?')[1]||''); const p=parseInt(qs.get('p')||'1',10); loadCategory(slug, p); }
  else if(h.startsWith('#search')){ const q=new URLSearchParams(h.split('?')[1]).get('q'); q ? doSearch(q) : openNavlessSearch(); }
  else if(h==='#editors'){ router.openEditors(); }
  else if(h==='#about'){ router.openAbout(); }
}

/* 스크롤 이벤트: 홈 to-top / 포스트 진행률 */
window.addEventListener('scroll', ()=>{
  const toTop=document.getElementById('toTopBtn');
  if(window.scrollY>200) toTop.classList.add('show'); else toTop.classList.remove('show');
});
document.getElementById('toTopBtn').addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));

/* 포스트 오버레이 내부 스크롤에 반응 */
document.getElementById('postOverlay').addEventListener('scroll', updatePostProgress);

/* 초기화 */
document.addEventListener('DOMContentLoaded', ()=>{
  renderNavList();
  loadHome(1);
  routeFromURL();

  const topInput=document.getElementById('searchInputTop');
  if(topInput){
    topInput.addEventListener('keydown', e=>{
      if(e.key==='Enter') doSearch(e.target.value);
      else if(e.key==='Escape') ui.closeSearch();
    });
  }

  const gns=document.getElementById('globalNavSearch');
  if(gns){
    gns.addEventListener('keydown', e=>{
      if(e.key==='Enter'){
        const q=e.target.value; ui.toggleNav(true); openNavlessSearch();
        setTimeout(()=>{ const top=document.getElementById('searchInputTop'); if(top){ top.value=q; if(q) doSearch(q); } }, 120);
      }
    });
  }

  window.addEventListener('popstate', ()=>{ closeAllOverlays(); routeFromURL(); });
});
  </script>
</body>
</html>
