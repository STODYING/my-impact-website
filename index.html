<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IMPACT â€” MAKE A IMPACT</title>
  <meta name="description" content="IMPACT â€” í•™ìƒ ì €ì ì½˜í…ì¸  í”Œë«í¼ (Netlify Functions ê²½ìœ  WordPress ë°ì´í„°)">

  <!-- favicon: í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— logo.png -->
  <link rel="icon" href="logo.png" type="image/png">

  <style>
  /* ======================================================================
     IMPACT â€” í†µí•© ì™„ì „íŒ ìŠ¤íƒ€ì¼ (ë°˜ì‘í˜• + ëª¨ë°”ì¼ ë„¤ë¹„ ì „ë©´ ì ìš©)
     ====================================================================== */

  /* RESET */
  *,*::before,*::after{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: "Noto Sans KR", "Apple SD Gothic Neo", "Segoe UI", Roboto, system-ui, Arial, sans-serif;
    background:#f6f7f9;
    color:#111;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    line-height:1.6;
    scroll-behavior:smooth;
  }
  a{color:inherit;text-decoration:none}
  img{display:block;max-width:100%;height:auto}

  .wrap{max-width:1400px;margin:0 auto;padding:0 20px}
  .hidden{display:none!important}
  .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}

  /* HEADER */
  header.header{
    position:sticky;top:0;z-index:1200;
    background:#fff;border-bottom:1px solid rgba(0,0,0,0.06);
    backdrop-filter: blur(6px);
  }
  .header-inner{height:72px;display:flex;align-items:center;justify-content:space-between;gap:12px;max-width:1400px;margin:0 auto;padding:0 20px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{display:flex;gap:10px;align-items:center;font-weight:900;font-size:22px;cursor:pointer}
  .logo small{font-size:11px;color:#777;font-weight:800}
  .header-actions{display:flex;gap:8px;align-items:center}

  .btn{border-radius:10px;background:#fff;padding:8px 12px;border:1px solid rgba(0,0,0,0.08);font-weight:700;font-size:14px;cursor:pointer;transition:transform .12s ease}
  .btn:active{transform:translateY(1px)}
  .btn.primary{background:linear-gradient(135deg,#2e8b57,#1f7a6f);color:#fff;border:none}

  /* NAV OVERLAY (ë”ë³´ê¸°) */
  .nav-overlay{
    position:fixed;top:0;right:0;height:100vh;width:420px;
    background:rgba(255,255,255,0.98);z-index:2200;padding:64px 40px;
    box-shadow:-6px 0 40px rgba(0,0,0,0.08);transform:translateX(110%);transition:transform .32s cubic-bezier(.2,.9,.2,1);
    display:flex;flex-direction:column;
  }
  .nav-overlay.active{transform:translateX(0)}
  .nav-close{position:absolute;top:20px;right:20px;background:none;border:none;font-size:28px;cursor:pointer}
  .nav-search{display:flex;align-items:center;gap:10px;margin-bottom:24px}
  .nav-search input[type="search"]{flex:1;border:none;border-bottom:2px solid #111;padding:10px 8px;font-weight:700;font-size:16px;background:transparent;outline:none}
  .nav-list{list-style:none;padding:0;margin:0 0 24px;display:flex;flex-direction:column;gap:18px}
  .nav-list li{font-size:24px;font-weight:900;cursor:pointer;color:#111}
  .nav-list li:hover{color:#2e8b57}
  .nav-footer-links{margin-top:auto;display:flex;gap:12px;align-items:center;font-weight:800}
  .nav-footer-links a{color:#111;font-size:13px}

  /* MOBILE: nav-overlay fullscreen under 680px */
  @media (max-width:680px){
    .nav-overlay{right:0;left:0;width:100%;height:100vh;padding:28px}
  }

  /* MAIN / HOME */
  .home{max-width:1400px;margin:28px auto;display:flex;flex-direction:column;gap:28px;padding:0 20px 100px}
  .row{display:grid;grid-template-columns:2fr 1fr;gap:20px;align-items:start}
  .col-left{position:relative;border-radius:12px;overflow:hidden;min-height:360px;background:#eee;cursor:pointer}
  .col-left .hero{width:100%;height:100%;object-fit:cover;display:block;min-height:360px}
  .col-left .hero-overlay{position:absolute;inset:auto 0 0 0;padding:22px;display:flex;flex-direction:column;gap:12px;background:linear-gradient(180deg,rgba(0,0,0,0),rgba(0,0,0,0.55));color:#fff}
  .col-left .hero-title{margin:0;font-size:28px;font-weight:900;line-height:1.05;max-width:92%}
  .col-right{display:flex;flex-direction:column;gap:12px}

  .card{background:#fff;border-radius:10px;overflow:hidden;border:1px solid rgba(0,0,0,0.06);transition:box-shadow .16s ease,transform .12s ease;cursor:pointer}
  .card:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(0,0,0,0.06)}
  .card .thumb{width:100%;height:140px;overflow:hidden;background:#efefef}
  .card .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .card .card-body{padding:12px}
  .card h3{font-size:16px;font-weight:800;margin:0 0 8px;color:#111}
  .card .meta{display:flex;align-items:center;gap:8px;color:#666;font-size:13px}
  .cat-badge{display:inline-block;padding:6px 10px;border-radius:6px;font-weight:800;font-size:12px;color:#fff}

  /* ì¹´í…Œê³ ë¦¬ ì»¬ëŸ¬ */
  .cat-tech{background:#1e90ff}
  .cat-eat{background:#ff6347}
  .cat-style{background:#32cd32}
  .cat-culture{background:#8a2be2}
  .cat-life{background:#ffa500;color:#000}
  .cat-editors-pick{background:#ff1493}

  /* OVERLAYS (category, post, search, about) */
  .overlay{
    display:none;position:fixed;inset:0;background:#fff;z-index:2000;overflow:auto;padding:28px;
  }
  .overlay.active{display:block;animation:overlayIn .28s ease}
  @keyframes overlayIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

  .category-top{display:flex;justify-content:space-between;align-items:center;gap:12px;border-bottom:1px solid rgba(0,0,0,0.06);padding-bottom:12px}
  .category-title{font-size:24px;font-weight:900;color:#111}
  .category-grid{margin-top:18px;display:grid;gap:18px;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));padding:20px 0 80px}

  .post-article{margin:0 auto;max-width:900px}
  .post-article h1{font-size:34px;font-weight:900;margin-bottom:12px;color:#111}
  .post-content{color:#222;line-height:1.9}

  .search-bar{display:flex;align-items:center;background:#fff;border-radius:50px;box-shadow:0 6px 20px rgba(0,0,0,0.06);padding:6px 10px;gap:8px}
  .search-bar input[type="search"]{flex:1;border:none;outline:none;font-size:16px;padding:12px 14px;border-radius:50px}
  .search-bar .search-btn{background:#111;color:#fff;border:none;padding:10px 18px;border-radius:50px;font-weight:800;cursor:pointer}
  .search-bar .close-btn{background:none;border:none;font-size:20px;cursor:pointer;color:#666}

  /* ê²€ìƒ‰ ë²„íŠ¼(text ë³´ì¥) ëª¨ë°”ì¼ì—ì„œë„ ë³´ì´ë„ë¡ padding ìœ ì§€ */
  @media (max-width:680px){
    .search-bar .search-btn{padding:10px 18px;font-size:16px}
  }

  .to-top{position:fixed;right:22px;bottom:22px;width:52px;height:52px;border-radius:12px;background:#fff;color:#000;display:flex;align-items:center;justify-content:center;font-size:22px;z-index:2500;box-shadow:0 12px 30px rgba(0,0,0,0.08);opacity:0;transform:translateY(20px);transition:all .28s cubic-bezier(.2,.9,.2,1);border:1px solid rgba(0,0,0,0.06)}
  .to-top.show{opacity:1;transform:translateY(0)}

  footer.site-footer{background:#111;color:#eee;padding:40px 20px;margin-top:20px}
  .footer-inner{max-width:1400px;margin:0 auto;display:flex;justify-content:space-between;gap:20px;align-items:flex-start;flex-wrap:wrap}
  .footer-brand{font-size:40px;font-weight:900;color:#fff;font-style:italic}
  .footer-links a{color:#ddd}

  /* ë°˜ì‘í˜•: ëª¨ë°”ì¼ ë©”ì¸ ë ˆì´ì•„ì›ƒ ë³€ê²½ ìš”ì²­ ë°˜ì˜ */
  @media (max-width:1100px){
    .row{grid-template-columns:1fr}
    .col-right{display:grid;gap:12px}
  }

  /* ìœ í‹¸ / ê¸´ ì£¼ì„ì€ íŒŒì¼ ëë¶€ë¶„ì— ì¶”ê°€ */
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header" id="siteHeader" role="banner" aria-label="ì‚¬ì´íŠ¸ í—¤ë”">
    <div class="header-inner wrap">
      <div class="brand" role="img" aria-label="IMPACT brand">
        <div class="logo" id="logoBtn" onclick="router.goHome()" tabindex="0" title="IMPACT â€” go home">
          <img src="logo.png" alt="IMPACT logo" style="width:36px;height:36px;border-radius:8px;object-fit:cover;">
          <div>
            <div style="line-height:1">IMPACT</div>
            <small>MAKE A IMPACT</small>
          </div>
        </div>
      </div>

      <div class="header-actions" role="navigation" aria-label="ìƒë‹¨ ë©”ë‰´">
        <!-- ê²€ìƒ‰ ë²„íŠ¼: ëª¨ë°”ì¼ì—ì„œë„ 'ê²€ìƒ‰' í…ìŠ¤íŠ¸ ë³´ì¥ -->
        <button class="btn" id="topSearchBtn" onclick="openNavlessSearch()">ê²€ìƒ‰</button>
        <button class="btn" aria-controls="navOverlay" aria-expanded="false" onclick="ui.toggleNav()">ë”ë³´ê¸°</button>
      </div>
    </div>
  </header>

  <!-- NAV OVERLAY -->
  <aside class="nav-overlay" id="navOverlay" aria-hidden="true" aria-label="ì¹´í…Œê³ ë¦¬ ë„¤ë¹„ê²Œì´ì…˜">
    <button class="nav-close" aria-label="ë„¤ë¹„ ë‹«ê¸°" onclick="ui.toggleNav()">Ã—</button>
    <div style="display:flex;flex-direction:column;gap:12px;">
      <div class="nav-search" role="search" aria-label="ë„¤ë¹„ ê²€ìƒ‰">
        <span style="font-size:18px">ğŸ”</span>
        <input type="search" id="globalNavSearch" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" aria-label="ë„¤ë¹„ ê²€ìƒ‰ì–´">
      </div>

      <ul class="nav-list" id="navList" role="menu" aria-label="ì¹´í…Œê³ ë¦¬ ëª©ë¡">
        <!-- JSì—ì„œ ë™ì  ìƒì„± -->
      </ul>

      <div class="nav-footer-links" aria-hidden="false">
        <a href="javascript:void(0)" onclick="ui.toggleNav(); router.openAbout()">ABOUT</a>
        <a href="javascript:void(0)" onclick="alert('EDITORS í˜ì´ì§€ëŠ” ì¶”í›„ êµ¬í˜„ë©ë‹ˆë‹¤')">EDITORS</a>
        <a href="javascript:void(0)" onclick="alert('NEWSLETTER í˜ì´ì§€ëŠ” ì¶”í›„ êµ¬í˜„ë©ë‹ˆë‹¤')">NEWSLETTER</a>
        <a href="https://www.instagram.com/ceo_impact_official" target="_blank" rel="noopener">INSTAGRAM</a>
      </div>

      <div class="nav-extra" style="margin-top:18px;color:#777;font-size:13px">
        IMPACTëŠ” WordPress APIë¡œë¶€í„° ì½˜í…ì¸ ë¥¼ ë°›ì•„ì™€ ì‚¬ì´íŠ¸ ë‚´ì—ì„œ ìì²´ í¬ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
      </div>
    </div>
  </aside>

  <!-- MAIN HOME -->
  <main class="home" id="home" role="main" aria-live="polite" tabindex="-1">
    <div id="rowsContainer" aria-live="polite"></div>
    <div id="homeLoading" style="text-align:center;color:#666;padding:36px 0">ë¡œë”© ì¤‘...</div>
  </main>

  <!-- CATEGORY OVERLAY -->
  <section class="overlay category-overlay" id="categoryOverlay" aria-hidden="true" role="region">
    <div class="wrap">
      <div class="category-top">
        <div>
          <div class="category-title" id="categoryOverlayTitle">CATEGORY</div>
          <div class="category-sub" id="categoryOverlaySubtitle">ì¹´í…Œê³ ë¦¬ ì„¤ëª…</div>
        </div>
        <div>
          <button class="btn" onclick="router.closeCategory()">ë‹«ê¸°</button>
        </div>
      </div>

      <div class="category-grid" id="categoryGrid" aria-live="polite"></div>
      <div id="categoryLoading" style="text-align:center;color:#666;padding:28px 0"></div>
    </div>
  </section>

  <!-- POST OVERLAY -->
  <article class="overlay post-overlay" id="postOverlay" aria-hidden="true" role="article">
    <div style="width:100%;max-width:1200px;margin:0 auto;">
      <div style="display:flex;justify-content:flex-end;gap:12px;margin-bottom:18px">
        <button class="btn" onclick="router.closePost()">ë‹«ê¸°</button>
      </div>
      <div class="post-article" id="postArticle"></div>

      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:18px">
        <button class="btn" id="sharePostBtn">ğŸ”— ê³µìœ </button>
        <button class="btn" id="openOriginalBtn">ì›ë¬¸ ë³´ê¸°</button>
      </div>
    </div>
  </article>

  <!-- SEARCH OVERLAY -->
  <section class="overlay search-overlay" id="searchOverlay" aria-hidden="true" role="search">
    <div class="wrap" style="max-width:1100px;margin:0 auto;">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px">
        <div style="flex:1">
          <div class="search-bar" role="search" aria-label="ì‚¬ì´íŠ¸ ê²€ìƒ‰">
            <input type="search" class="search-input" id="searchInputTop" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥ (Enterë¡œ ê²€ìƒ‰)" aria-label="ê²€ìƒ‰ì–´">
            <button type="button" class="search-btn" id="globalSearchBtn">ê²€ìƒ‰</button>
            <button type="button" class="close-btn" onclick="ui.closeSearch()">Ã—</button>
          </div>
        </div>
      </div>

      <div id="searchResults" class="category-grid" aria-live="polite"></div>
    </div>
  </section>

  <!-- ABOUT PAGE -->
  <section class="overlay about-page" id="aboutPageSection" aria-hidden="true" role="region">
    <div class="wrap about-content">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:18px">
        <div style="max-width:900px">
          <h2 style="font-size:32px;margin-bottom:10px">ABOUT</h2>
          <div style="color:#333;font-size:15px;line-height:1.8">
            <p><strong>IMPACT</strong> ì€ ç¾ & å‰ KAIST IP-CEO í•™ìƒë“¤ê³¼ POSTECH CEO í•™ìƒë“¤ì´ í•¨ê»˜ ì‘ì„±í•˜ëŠ” ì‹¬ì¸µ ì½˜í…ì¸  í”Œë«í¼ì…ë‹ˆë‹¤.</p>
            <p>í•™ìƒ ì €ìë“¤ì˜ ê²½í—˜ê³¼ ë¶„ì„ì„ ë°”íƒ•ìœ¼ë¡œ ê¸°ìˆ Â·ê²½ì˜Â·ì°½ì˜ì„±ì„ ê²°í•©í•œ ê¸€ì„ ì œê³µí•©ë‹ˆë‹¤. í˜„ì¥ì˜ ì‚¬ë¡€, ë°ì´í„° ì¸í…”ë¦¬ì „ìŠ¤, ê¹Šì´ ìˆëŠ” ë¶„ì„ì„ í†µí•´ ë…ìì—ê²Œ í†µì°°ì„ ì „ë‹¬í•©ë‹ˆë‹¤.</p>
          </div>

          <ul style="list-style:none;padding:0;margin:20px 0;line-height:1.8">
            <li><strong>Innovation (í˜ì‹ )</strong> â€” ìƒˆë¡œìš´ ì•„ì´ë””ì–´ì™€ ëª¨ë¸ì„ í†µí•´ ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤.</li>
            <li><strong>Management (ê´€ë¦¬)</strong> â€” ì§€ì† ê°€ëŠ¥í•œ ì‹¤í–‰ê³¼ íŒ€/í”„ë¡œì íŠ¸ ê´€ë¦¬ë¥¼ ì¤‘ì‹œí•©ë‹ˆë‹¤.</li>
            <li><strong>Passion (ì—´ì •)</strong> â€” í˜¸ê¸°ì‹¬ê³¼ ëª°ì…ìœ¼ë¡œ ê¹Šì´ë¥¼ ë§Œë“­ë‹ˆë‹¤.</li>
            <li><strong>Acceleration (í˜ì‹  ê°€ì†í™”)</strong> â€” í•™ìŠµê³¼ ì‹¤í—˜ì„ ë¹ ë¥´ê²Œ ìˆœí™˜ì‹œì¼œ ì„±ê³¼ë¥¼ ì•ë‹¹ê¹ë‹ˆë‹¤.</li>
            <li><strong>Creativity (ì°½ì˜ì„±)</strong> â€” ë¬¸ì œë¥¼ ì¬ì •ì˜í•˜ê³  ìƒˆë¡œìš´ í•´ë²•ì„ ì œì‹œí•©ë‹ˆë‹¤.</li>
            <li><strong>Technology (ê¸°ìˆ )</strong> â€” ë„ë©”ì¸ ì§€ì‹ê³¼ ê¸°ìˆ ì„ ê²°í•©í•´ ì„íŒ©íŠ¸ë¥¼ ë§Œë“­ë‹ˆë‹¤.</li>
          </ul>

          <p style="font-size:20px;font-weight:900;margin-top:10px">MAKE A IMPACT</p>
          <p style="color:#333">ìš°ë¦¬ëŠ” ê¸°ìˆ ê³¼ ê²½ì˜, ì°½ì˜ì„±ê³¼ ì—´ì •ì„ ìœµí•©í•˜ì—¬ í˜ì‹ ì„ ê°€ì†í™”í•©ë‹ˆë‹¤. í•™ìƒ ì €ìì˜ ì‹œì„ ì—ì„œ ì‚¬íšŒì™€ ì‚°ì—…, ê·¸ë¦¬ê³  ì‚¬ëŒë“¤ì—ê²Œ ì˜ë¯¸ ìˆëŠ” ì„íŒ©íŠ¸ë¥¼ ë§Œë“¤ì–´ ë‚˜ê°‘ë‹ˆë‹¤.</p>

          <div style="margin-top:20px"><button class="btn" onclick="router.closeAbout()">ë‹«ê¸°</button></div>
        </div>
      </div>
    </div>
  </section>

  <!-- TO TOP -->
  <button class="to-top" id="toTopBtn" title="ë§¨ ìœ„ë¡œ" aria-label="ë§¨ ìœ„ë¡œ">â†‘</button>

  <!-- FOOTER -->
  <footer class="site-footer" role="contentinfo" aria-label="ì‚¬ì´íŠ¸ í‘¸í„°">
    <div class="wrap footer-inner">
      <div>
        <div class="footer-brand">IMPACT</div>
        <div style="margin-top:10px;color:#ddd;font-size:13px">ê´‘ê³  ì œíœ´ ë¬¸ì˜ | <a href="mailto:ceo.impact.official@gmail.com">ceo.impact.official@gmail.com</a></div>
        <div style="color:#ddd;font-size:13px;margin-top:6px">ë³´ë„ìë£Œ | <a href="mailto:ceo.impact.official@gmail.com">ceo.impact.official@gmail.com</a></div>
      </div>

      <div class="footer-links">
        <a href="javascript:void(0)" onclick="router.openAbout()">ABOUT</a>
        <a href="javascript:void(0)" onclick="alert('EDITORS í˜ì´ì§€ëŠ” ì¶”í›„ êµ¬í˜„ë©ë‹ˆë‹¤')">EDITORS</a>
        <a href="javascript:void(0)" onclick="alert('NEWSLETTER í˜ì´ì§€ëŠ” ì¶”í›„ êµ¬í˜„ë©ë‹ˆë‹¤')">NEWSLETTER</a>
        <a href="https://www.instagram.com/ceo_impact_official" target="_blank" rel="noopener">INSTAGRAM</a>
      </div>

      <div class="footer-right">
        <div style="font-weight:800;color:#fff">IMPACT CEO. ALL RIGHTS RESERVED.</div>
        <div style="color:#999;font-size:13px;margin-top:10px">ì‚¬ì´íŠ¸ëŠ” WordPress.com APIë¡œë¶€í„° ì½˜í…ì¸ ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤ (Netlify Functions ì‚¬ìš© ê¶Œì¥).</div>
      </div>
    </div>
  </footer>

  <!-- CARD TEMPLATE -->
  <template id="cardTpl">
    <article class="card" role="article">
      <div class="thumb"><img src="" alt=""></div>
      <div class="card-body">
        <div class="cat-row"></div>
        <h3 class="title"></h3>
        <div class="meta" style="margin-top:8px">
          <img class="author-avatar" src="" alt="" style="width:36px;height:36px;border-radius:50%;object-fit:cover;">
          <div style="margin-left:8px">
            <div class="author-name" style="font-weight:800"></div>
            <div class="date" style="font-size:12px;color:#777"></div>
          </div>
        </div>
      </div>
    </article>
  </template>

  <script>
  /***********************************************************************
   * IMPACT â€” í†µí•© ìë°”ìŠ¤í¬ë¦½íŠ¸
   * - Netlify Functions í”„ë¡ì‹œ ê²½ìœ  (í† í° ì—†ìŒ)
   * - ëª¨ë°”ì¼: navigator.share ì‚¬ìš© ê°€ëŠ¥ ì‹œ ì‚¬ìš©, ì—†ìœ¼ë©´ í´ë¦½ë³´ë“œ ë³µì‚¬
   * - ê³µìœ ìš© í•´ì‹œ: #post-{id}, #about
   ***********************************************************************/

  /* =============
     ì„¤ì •ê°’
     ============= */
  const WP_SITE = "impactceo0.wordpress.com"; // ì°¸ê³ ìš© (í”„ë¡ì‹œ ë‚´ë¶€ì—ì„œ ì‚¬ìš©)
  const HOME_PER_PAGE = 5;
  const HOME_MAX = 40;

  const CATEGORIES = {
    "tech": 318,
    "eat": 123073,
    "style": 2286,
    "culture": 1098,
    "life": 124,
    "editors-pick": 259543
  };
  const NAV_ORDER = ["TECH","EAT","STYLE","CULTURE","LIFE","EDITORS' PICK"];

  /* ìƒíƒœ */
  const state = {
    homePage: 1,
    homeLoaded: 0,
    homeFinished: false,
    loadingHome: false,
    postsCache: {},
    categoryPages: {},
    categoryFinished: {}
  };

  /* =========
     ìœ í‹¸
     ========= */
  function api(path){
    // ì ‘ì† ê²½ë¡œì— _embed ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ë¶™ì—¬ì„œ ìš”ì²­
    const p = path.includes('_embed') ? path : (path + (path.includes('?') ? '&' : '?') + '_embed');
    return '/.netlify/functions/wpProxy?path=' + encodeURIComponent(p);
  }

  function formatDate(dstr){
    try {
      const d = new Date(dstr);
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      return `${y}. ${m}. ${dd}.`;
    } catch(e){ return ''; }
  }

  function placeholderDataURI(w=600,h=400,txt='No Image'){
    const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}'><rect width='100%' height='100%' fill='#efefef'/><text x='50%' y='50%' fill='#aaa' font-size='20' text-anchor='middle' dominant-baseline='middle'>${txt}</text></svg>`;
    return 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(svg);
  }

  function pickCategoryClass(nameOrSlug){
    if(!nameOrSlug) return '';
    const s = String(nameOrSlug).toLowerCase();
    if(s.includes('tech')||s.includes('technology')) return 'cat-tech';
    if(s.includes('eat')) return 'cat-eat';
    if(s.includes('style')) return 'cat-style';
    if(s.includes('culture')) return 'cat-culture';
    if(s.includes('life')) return 'cat-life';
    if(s.includes('editor')||s.includes('editors')) return 'cat-editors-pick';
    return '';
  }

  /* =========
     NAV ë Œë”
     ========= */
  function renderNavList(){
    const navList = document.getElementById('navList');
    navList.innerHTML = '';
    NAV_ORDER.forEach(item=>{
      const li = document.createElement('li');
      li.textContent = item;
      li.tabIndex = 0;
      li.setAttribute('role','menuitem');
      li.addEventListener('click', ()=>{
        ui.toggleNav();
        let slug = item.toLowerCase().replace(/'/g,'').replace(/\s/g,'-');
        if(slug === "editors-pick") slug = 'editors-pick';
        if(CATEGORIES[slug]) router.openCategory(slug);
        else alert('í•´ë‹¹ ì¹´í…Œê³ ë¦¬ëŠ” í˜„ì¬ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      });
      li.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' ') li.click(); });
      navList.appendChild(li);
    });
  }

  /* =========
     ì¹´ë“œ ìƒì„±
     ========= */
  function createCardNode(post){
    const tpl = document.getElementById('cardTpl');
    const node = tpl.content.firstElementChild.cloneNode(true);

    const imgEl = node.querySelector('.thumb img');
    let thumbUrl = '';
    try {
      if(post._embedded && post._embedded['wp:featuredmedia'] && post._embedded['wp:featuredmedia'][0] && post._embedded['wp:featuredmedia'][0].source_url){
        thumbUrl = post._embedded['wp:featuredmedia'][0].source_url;
      }
    } catch(e){}
    imgEl.src = thumbUrl || placeholderDataURI(1200,800,'No Image');

    node.querySelector('.title').innerHTML = post.title && post.title.rendered ? post.title.rendered : 'ì œëª© ì—†ìŒ';

    const avatarImg = node.querySelector('.author-avatar');
    const authorNameEl = node.querySelector('.author-name');
    const dateEl = node.querySelector('.date');

    if(post._embedded && post._embedded.author && post._embedded.author[0]){
      const a = post._embedded.author[0];
      const avatarUrl = (a.avatar_urls && (a.avatar_urls['96']||a.avatar_urls['48']||a.avatar_urls['24'])) ? (a.avatar_urls['48']||a.avatar_urls['24']) : '';
      avatarImg.src = avatarUrl || placeholderDataURI(96,96,'U');
      avatarImg.alt = a.name || 'author';
      authorNameEl.textContent = a.name || 'ìµëª…';
    } else {
      avatarImg.src = placeholderDataURI(96,96,'U');
      authorNameEl.textContent = 'ìµëª…';
    }
    dateEl.textContent = formatDate(post.date);

    // categories
    const catRow = node.querySelector('.cat-row');
    catRow.innerHTML = '';
    if(post._embedded && post._embedded['wp:term'] && post._embedded['wp:term'][0]){
      const cats = post._embedded['wp:term'][0];
      cats.forEach(c=>{
        if(c && c.name){
          const span = document.createElement('span');
          span.className = 'cat-badge';
          span.textContent = c.name;
          const cls = pickCategoryClass(c.slug || c.name);
          if(cls) span.classList.add(cls);
          else span.style.background = '#666';
          catRow.appendChild(span);
        }
      });
    }

    node.addEventListener('click', ()=> openPostOverlayById(post.id));
    return node;
  }

  /* =========
     HOME ë¡œë“œ (ë¬´í•œìŠ¤í¬ë¡¤)
     ========= */
  async function loadHomeChunk(){
    if(state.loadingHome || state.homeFinished) return;
    state.loadingHome = true;
    document.getElementById('homeLoading').textContent = 'ë¡œë”© ì¤‘...';

    try {
      const res = await fetch(api(`posts?per_page=${HOME_PER_PAGE}&page=${state.homePage}`));
      if(!res.ok){
        if(res.status === 400){
          state.homeFinished = true;
          document.getElementById('homeLoading').textContent = 'ë” ì´ìƒ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.';
        } else {
          throw new Error('Home fetch failed: ' + res.status);
        }
        state.loadingHome = false;
        return;
      }
      const posts = await res.json();
      if(!Array.isArray(posts) || posts.length === 0){
        state.homeFinished = true;
        document.getElementById('homeLoading').textContent = 'ì•„ì§ ê²Œì‹œëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.';
        state.loadingHome = false;
        return;
      }

      posts.forEach(p => state.postsCache[p.id] = p);

      const container = document.getElementById('rowsContainer');

      // ê·¸ë£¹: 1 left hero + up to 4 right
      for(let i=0;i<posts.length;i+=5){
        const group = posts.slice(i,i+5);
        if(state.homeLoaded >= HOME_MAX){ state.homeFinished = true; break; }
        const row = document.createElement('div'); row.className = 'row';

        // left hero
        const leftPost = group[0];
        const leftDiv = document.createElement('div'); leftDiv.className = 'col-left';
        let heroUrl = '';
        try{ if(leftPost._embedded && leftPost._embedded['wp:featuredmedia'] && leftPost._embedded['wp:featuredmedia'][0]) heroUrl = leftPost._embedded['wp:featuredmedia'][0].source_url || ''; }catch(e){}
        leftDiv.innerHTML = `
          <img class="hero" src="${heroUrl || placeholderDataURI(1200,800,'No Image')}" alt="hero">
          <div class="hero-overlay">
            <h2 class="hero-title"></h2>
            <div style="display:flex;align-items:center;gap:10px">
              <img class="hero-avatar" src="" alt="" style="width:36px;height:36px;border-radius:50%;object-fit:cover;">
              <div class="hero-author" style="font-weight:800;color:#fff"></div>
              <div class="hero-date" style="margin-left:8px;color:#eee;opacity:.9"></div>
            </div>
          </div>
        `;
        const catWrap = document.createElement('div'); catWrap.className = 'hero-cats';
        if(leftPost._embedded && leftPost._embedded['wp:term'] && leftPost._embedded['wp:term'][0] && leftPost._embedded['wp:term'][0].length>0){
          const c = leftPost._embedded['wp:term'][0][0];
          const span = document.createElement('span');
          span.className = 'cat-badge ' + pickCategoryClass(c.slug || c.name);
          span.textContent = c.name;
          catWrap.appendChild(span);
        }
        leftDiv.appendChild(catWrap);

        const heroTitle = leftDiv.querySelector('.hero-title');
        heroTitle.innerHTML = leftPost.title && leftPost.title.rendered ? leftPost.title.rendered : 'ì œëª© ì—†ìŒ';
        const heroAvatar = leftDiv.querySelector('.hero-avatar');
        const heroAuthor = leftDiv.querySelector('.hero-author');
        const heroDate = leftDiv.querySelector('.hero-date');
        if(leftPost._embedded && leftPost._embedded.author && leftPost._embedded.author[0]){
          const a = leftPost._embedded.author[0];
          const av = (a.avatar_urls && (a.avatar_urls['96']||a.avatar_urls['48']||a.avatar_urls['24'])) ? (a.avatar_urls['48']||a.avatar_urls['24']) : '';
          heroAvatar.src = av || placeholderDataURI(48,48,'U');
          heroAuthor.textContent = (a.name || 'ìµëª…');
        } else {
          heroAvatar.src = placeholderDataURI(48,48,'U');
          heroAuthor.textContent = 'ìµëª…';
        }
        heroDate.textContent = formatDate(leftPost.date);

        leftDiv.addEventListener('click', ()=> openPostOverlayById(leftPost.id));
        row.appendChild(leftDiv);

        // right small cards
        const rightDiv = document.createElement('div'); rightDiv.className = 'col-right';
        const smalls = group.slice(1,5);
        smalls.forEach(s=>{
          const cardNode = createCardNode(s);
          rightDiv.appendChild(cardNode);
        });
        row.appendChild(rightDiv);
        container.appendChild(row);

        state.homeLoaded += group.length;
        if(state.homeLoaded >= HOME_MAX){ state.homeFinished = true; break; }
      }

      state.homePage += 1;
      document.getElementById('homeLoading').textContent = '';
    } catch(err){
      console.error(err);
      document.getElementById('homeLoading').textContent = 'ë©”ì¸ ê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨';
    } finally {
      state.loadingHome = false;
    }
  }

  /* =========
     ì¹´í…Œê³ ë¦¬ ë¡œë“œ
     ========= */
  async function loadCategoryPage(slug){
    if(!slug) return;
    if(state.categoryFinished[slug]) return;
    const nextPage = state.categoryPages[slug] || 1;
    document.getElementById('categoryLoading').textContent = 'ë¡œë”© ì¤‘...';
    try{
      const catId = CATEGORIES[slug];
      if(!catId){ document.getElementById('categoryLoading').textContent = 'ì•Œ ìˆ˜ ì—†ëŠ” ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤.'; return; }
      const res = await fetch(api(`posts?categories=${catId}&per_page=10&page=${nextPage}`));
      if(!res.ok){
        if(res.status === 400){ state.categoryFinished[slug] = true; document.getElementById('categoryLoading').textContent = 'ë” ì´ìƒ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.'; return; }
        throw new Error('category fetch failed: ' + res.status);
      }
      const posts = await res.json();
      if(!Array.isArray(posts) || posts.length === 0){ state.categoryFinished[slug] = true; document.getElementById('categoryLoading').textContent = 'ì•„ì§ ê²Œì‹œëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.'; return; }

      const grid = document.getElementById('categoryGrid');
      posts.forEach(p=>{
        state.postsCache[p.id] = p;
        const card = createCardNode(p);
        grid.appendChild(card);
      });
      state.categoryPages[slug] = nextPage + 1;
      document.getElementById('categoryLoading').textContent = '';
    } catch(err){ console.error(err); document.getElementById('categoryLoading').textContent = 'ì¹´í…Œê³ ë¦¬ ê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨'; }
  }

  /* =========
     ë‹¨ì¼ í¬ìŠ¤íŠ¸ ë¡œë“œ(ì˜¤ë²„ë ˆì´)
     - í•´ì‹œ #post-{id} ì‚¬ìš©
     ========= */
  async function openPostOverlayById(id){
    if(!id) return;
    const cached = state.postsCache[id];
    // If cached and content present -> render
    if(cached && (cached.content && cached.content.rendered)){
      renderPostOverlay(cached);
      return;
    }
    try{
      const res = await fetch(api(`posts/${id}`));
      if(!res.ok) throw new Error('post fetch failed ' + res.status);
      const post = await res.json();

      // ensure embed for author & media
      if(!(post._embedded && post._embedded.author)){
        const res2 = await fetch(api(`posts/${id}?_embed`));
        if(res2.ok){
          const post2 = await res2.json();
          state.postsCache[id] = post2;
          renderPostOverlay(post2);
          return;
        }
      }
      state.postsCache[id] = post;
      renderPostOverlay(post);
    } catch(err){
      console.error(err);
      alert('í¬ìŠ¤íŠ¸ ë¡œë“œ ì‹¤íŒ¨ â€” ì›ë¬¸ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
      if(cached && cached.link) window.open(cached.link,'_blank');
    }
  }

  function renderPostOverlay(post){
    const overlay = document.getElementById('postOverlay');
    const article = document.getElementById('postArticle');
    const title = post.title && post.title.rendered ? post.title.rendered : 'ì œëª© ì—†ìŒ';
    const authorName = (post._embedded && post._embedded.author && post._embedded.author[0] && post._embedded.author[0].name) ? post._embedded.author[0].name : 'ìµëª…';
    const avatar = (post._embedded && post._embedded.author && post._embedded.author[0] && post._embedded.author[0].avatar_urls) ? (post._embedded.author[0].avatar_urls['96'] || post._embedded.author[0].avatar_urls['48']) : '';
    const categories = (post._embedded && post._embedded['wp:term'] && post._embedded['wp:term'][0]) ? post._embedded['wp:term'][0].map(t=>t.name).join(', ') : '-';
    const dateStr = formatDate(post.date);
    const contentHTML = post.content && post.content.rendered ? post.content.rendered : (post.excerpt && post.excerpt.rendered ? post.excerpt.rendered : '');

    article.innerHTML = `
      <h1>${title}</h1>
      <div class="post-meta" style="display:flex;gap:12px;align-items:center;margin-bottom:14px;">
        <img src="${avatar || placeholderDataURI(96,96,'U')}" alt="author" style="width:52px;height:52px;border-radius:50%;object-fit:cover;">
        <div style="display:flex;flex-direction:column">
          <div style="font-weight:800;color:#111">${authorName}</div>
          <div style="color:#666;font-size:13px">${dateStr} Â· ${categories}</div>
        </div>
      </div>
      <div class="post-content">${contentHTML}</div>
      <div style="margin-top:18px;color:#888;font-size:13px">ì›ë¬¸ ë§í¬: <a href="${post.link}" target="_blank" rel="noopener">${post.link}</a></div>
    `;

    // make images responsive
    article.querySelectorAll('.post-content img').forEach(img=>{
      img.style.maxWidth = '100%';
      img.style.height = 'auto';
      img.style.display = 'block';
      img.style.margin = '12px 0';
    });

    overlay.classList.add('active');
    overlay.scrollTop = 0;

    // set hash for sharing (format: #post-{id})
    location.hash = `post-${post.id}`;

    // configure share button
    const shareBtn = document.getElementById('sharePostBtn');
    shareBtn.onclick = () => shareCurrentPost(post);

    // open original button
    const openOrig = document.getElementById('openOriginalBtn');
    openOrig.onclick = () => window.open(post.link, '_blank', 'noopener');
  }

  /* =========
     ê³µìœ  í•¨ìˆ˜: navigator.share (ëª¨ë°”ì¼) ë˜ëŠ” í´ë¦½ë³´ë“œ ë³µì‚¬
     ========= */
  async function shareCurrentPost(post){
    const shareUrl = location.origin + location.pathname + `#post-${post.id}`;
    const title = (post.title && post.title.rendered) ? stripHtml(post.title.rendered) : 'IMPACT';
    const text = (post.excerpt && post.excerpt.rendered) ? stripHtml(post.excerpt.rendered).slice(0,200) : '';

    // navigator.share ìš°ì„ , ì§€ì›í•˜ì§€ ì•Šìœ¼ë©´ í´ë¦½ë³´ë“œ ë³µì‚¬
    if(navigator.share){
      try {
        await navigator.share({ title, text, url: shareUrl });
      } catch (err) {
        // ê³µìœ  ì·¨ì†Œ í˜¹ì€ ì—ëŸ¬ ë°œìƒ ì‹œ í´ë¦½ë³´ë“œë¡œ fallback
        copyToClipboard(shareUrl);
        alert('ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    } else {
      copyToClipboard(shareUrl);
      alert('ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  }

  function copyToClipboard(text){
    if(navigator.clipboard && navigator.clipboard.writeText){
      return navigator.clipboard.writeText(text);
    } else {
      // fallback
      const ta = document.createElement('textarea');
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      try { document.execCommand('copy'); } catch(e){}
      document.body.removeChild(ta);
    }
  }

  function stripHtml(html){
    const tmp = document.createElement('div');
    tmp.innerHTML = html;
    return tmp.textContent || tmp.innerText || '';
  }

  /* =========
     ê²€ìƒ‰
     ========= */
  async function doSearch(q){
    if(!q) return;
    ui.openSearch();
    const resultsGrid = document.getElementById('searchResults');
    resultsGrid.innerHTML = '';
    try{
      const res = await fetch(api(`posts?search=${encodeURIComponent(q)}&per_page=20`));
      if(!res.ok) throw new Error('search failed ' + res.status);
      const posts = await res.json();
      if(!Array.isArray(posts) || posts.length === 0){
        resultsGrid.innerHTML = '<div style="padding:20px;color:#666">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      posts.forEach(p=>{
        state.postsCache[p.id] = p;
        const card = createCardNode(p);
        resultsGrid.appendChild(card);
      });
    } catch(err){
      console.error(err);
      resultsGrid.innerHTML = '<div style="padding:20px;color:#d00">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
    }
  }

  /* =========
     ìŠ¤í¬ë¡¤/ì´ë²¤íŠ¸ ë°”ì¸ë”©
     ========= */
  function onScrollHandler(){
    const toTop = document.getElementById('toTopBtn');
    if(window.scrollY > 300) toTop.classList.add('show'); else toTop.classList.remove('show');

    const categoryOverlay = document.getElementById('categoryOverlay');
    if(categoryOverlay.classList.contains('active')){
      const scroller = categoryOverlay;
      if(scroller.scrollHeight - (scroller.scrollTop + scroller.clientHeight) < 300){
        const slug = categoryOverlay.dataset.slug;
        if(slug) loadCategoryPage(slug);
      }
      return;
    }

    const postOverlay = document.getElementById('postOverlay');
    if(postOverlay.classList.contains('active')) return;

    const searchOverlay = document.getElementById('searchOverlay');
    if(searchOverlay.classList.contains('active')) return;

    if(!state.loadingHome && !state.homeFinished){
      const bottomThreshold = 1200;
      if(window.innerHeight + window.scrollY >= document.body.offsetHeight - bottomThreshold){
        loadHomeChunk();
      }
    }
  }

  /* =========
     UI & Router
     ========= */
  const ui = {
    toggleNav(){
      const nav = document.getElementById('navOverlay');
      nav.classList.toggle('active');
      const expanded = nav.classList.contains('active');
      document.querySelector('.header-actions button[aria-controls="navOverlay"]').setAttribute('aria-expanded', expanded ? 'true' : 'false');
    },
    openSearch(){
      const overlay = document.getElementById('searchOverlay');
      overlay.classList.add('active');
      const input = document.getElementById('searchInputTop');
      if(input) input.focus();
      // close nav
      document.getElementById('navOverlay').classList.remove('active');
      // update hash
      location.hash = 'search';
    },
    closeSearch(){
      document.getElementById('searchOverlay').classList.remove('active');
      // remove hash if currently search
      if(location.hash === '#search') history.back();
    },
    closeAll(){
      document.querySelectorAll('.overlay, .nav-overlay').forEach(el => el.classList.remove('active'));
    }
  };

  const CATEGORY_DESCRIPTIONS = {
    tech: "ìµœì‹  ê¸°ìˆ ê³¼ í˜ì‹  íŠ¸ë Œë“œë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.",
    eat: "ë‹¤ì–‘í•œ ìŒì‹ ë¬¸í™”ì™€ ë§›ì§‘ì„ ì†Œê°œí•©ë‹ˆë‹¤.",
    style: "íŒ¨ì…˜, ë·°í‹°, ë¼ì´í”„ìŠ¤íƒ€ì¼ì„ íƒêµ¬í•©ë‹ˆë‹¤.",
    culture: "ë¬¸í™”, ì˜ˆìˆ , ì‚¬íšŒ í˜„ìƒì„ ë¶„ì„í•©ë‹ˆë‹¤.",
    life: "ì¼ìƒê³¼ ê²½í—˜ì—ì„œ ì–»ì€ í†µì°°ì„ ë‚˜ëˆ•ë‹ˆë‹¤.",
    "editors-pick": "ì—ë””í„°ê°€ ì§ì ‘ ì—„ì„ í•œ ê¸€ ëª¨ìŒì…ë‹ˆë‹¤."
  };

  const router = {
    goHome(){
      document.querySelectorAll('.overlay, .nav-overlay').forEach(el => el.classList.remove('active'));
      window.scrollTo({ top: 0, behavior: 'smooth' });
      // clear hash to home
      if(location.hash && (location.hash.startsWith('#post-') || location.hash === '#about' || location.hash === '#search')) {
        history.replaceState(null, '', location.pathname);
      } else {
        history.replaceState({page:'home'}, '', location.pathname);
      }
    },
    openCategory(slug){
      const overlay = document.getElementById('categoryOverlay');
      overlay.dataset.slug = slug;
      overlay.classList.add('active');
      overlay.scrollTop = 0;
      document.getElementById('categoryOverlayTitle').textContent = slug.toUpperCase();
      document.getElementById('categoryOverlaySubtitle').textContent = CATEGORY_DESCRIPTIONS[slug] || "ì¹´í…Œê³ ë¦¬ ì½˜í…ì¸ ";
      state.categoryPages[slug] = 1;
      state.categoryFinished[slug] = false;
      document.getElementById('categoryGrid').innerHTML = '';
      loadCategoryPage(slug);
      history.pushState({ page: 'category', slug }, '', `#category-${slug}`);
      document.getElementById('navOverlay').classList.remove('active');
    },
    closeCategory(){
      const overlay = document.getElementById('categoryOverlay');
      overlay.classList.remove('active');
      delete overlay.dataset.slug;
      history.back();
    },
    openPost(post){
      if(post && post.id){
        state.postsCache[post.id] = post;
        renderPostOverlay(post);
        // hash will be set in renderPostOverlay
        document.getElementById('navOverlay').classList.remove('active');
      }
    },
    closePost(){
      document.getElementById('postOverlay').classList.remove('active');
      // if hash is post-..., remove it by going back or replace
      if(location.hash && location.hash.startsWith('#post-')) history.back();
    },
    openAbout(){
      document.getElementById('aboutPageSection').classList.add('active');
      location.hash = 'about';
      document.getElementById('navOverlay').classList.remove('active');
    },
    closeAbout(){
      document.getElementById('aboutPageSection').classList.remove('active');
      if(location.hash === '#about') history.back();
    }
  };

  /* =========
     ì „ì—­ ë‹¨ì¶• í•¨ìˆ˜
     ========= */
  window.openAbout = function(){ router.openAbout(); };
  window.openCategory = function(catSlug){ router.openCategory(catSlug); };
  window.openSearch = function(){ ui.openSearch(); };
  window.openPost = function(postIdOrObj){
    if(!postIdOrObj) return;
    if(typeof postIdOrObj === 'number') openPostOverlayById(postIdOrObj);
    else if(postIdOrObj.id) router.openPost(postIdOrObj);
  };

  function openNavlessSearch(){
    document.getElementById('navOverlay').classList.remove('active');
    ui.openSearch();
    const input = document.getElementById('searchInputTop');
    if(input) input.focus();
  }

  /* =========
     popstate ë° hashchange ì²˜ë¦¬
     - í•´ì‹œ ê¸°ë°˜ ê³µìœ : #post-123, #about, #category-slug, #search
     ========= */
  function handleHashOnLoadOrChange(){
    const h = location.hash ? location.hash.replace('#','') : '';
    if(!h){ // no hash => home
      ui.closeAll();
      return;
    }
    if(h.startsWith('post-')){
      const id = h.replace('post-','');
      openPostOverlayById(id);
      return;
    }
    if(h === 'about'){
      document.getElementById('aboutPageSection').classList.add('active');
      return;
    }
    if(h === 'search'){
      document.getElementById('searchOverlay').classList.add('active');
      return;
    }
    if(h.startsWith('category-')){
      const slug = h.replace('category-','');
      router.openCategory(slug);
      return;
    }
  }

  window.addEventListener('hashchange', handleHashOnLoadOrChange, false);

  (function setupHistoryHandlers(){
    window.addEventListener('popstate', function(event){
      // popstate: ë‹«ê¸° ë™ì‘ ì²˜ë¦¬(overlay ë‹«ê¸° ë“±)
      const h = location.hash ? location.hash.replace('#','') : '';
      // close all overlays then open by hash
      document.querySelectorAll('.overlay').forEach(el => el.classList.remove('active'));
      if(h) handleHashOnLoadOrChange();
      else ui.closeAll();
    }, false);
  })();

  /* =========
     ì´ë²¤íŠ¸ ë°”ì¸ë”©
     ========= */
  function bindEvents(){
    renderNavList();

    const searchBtn = document.getElementById('globalSearchBtn');
    if(searchBtn) searchBtn.addEventListener('click', (e)=>{ e.preventDefault(); ui.searchNow && ui.searchNow(); const q = document.getElementById('searchInputTop').value.trim(); if(q) doSearch(q); });

    const navSearch = document.getElementById('globalNavSearch');
    if(navSearch){
      navSearch.addEventListener('keydown',(e)=>{
        if(e.key === 'Enter'){
          e.preventDefault();
          const q = e.target.value.trim();
          if(!q){ alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
          document.getElementById('navOverlay').classList.remove('active');
          doSearch(q);
        }
      });
    }

    const searchOverlayInput = document.getElementById('searchInputTop');
    if(searchOverlayInput){
      searchOverlayInput.addEventListener('keydown',(e)=>{
        if(e.key === 'Enter'){
          e.preventDefault();
          const q = e.target.value.trim();
          if(!q){ alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
          doSearch(q);
        }
      });
    }

    const toTopBtn = document.getElementById('toTopBtn');
    if(toTopBtn) toTopBtn.addEventListener('click', ()=> window.scrollTo({ top:0, behavior:'smooth' }));

    window.addEventListener('scroll', onScrollHandler, { passive:true });

    window.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){
        document.getElementById('navOverlay').classList.remove('active');
        document.getElementById('searchOverlay').classList.remove('active');
        document.getElementById('categoryOverlay').classList.remove('active');
        document.getElementById('postOverlay').classList.remove('active');
        document.getElementById('aboutPageSection').classList.remove('active');
      }
    });

    // share copy default (if user clicks share without open post)
    const shareBtn = document.getElementById('sharePostBtn');
    if(shareBtn) shareBtn.addEventListener('click', ()=>{
      // if overlay active and hash present, copy hash link
      if(location.hash && location.hash.startsWith('#post-')){
        copyToClipboard(location.origin + location.pathname + location.hash);
        alert('ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } else {
        alert('ê³µìœ í•  í¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
      }
    });

    // nav toggle button aria binding
    const navToggle = document.querySelector('.header-actions button[aria-controls="navOverlay"]');
    if(navToggle){
      navToggle.addEventListener('click', ()=>{
        const nav = document.getElementById('navOverlay');
        navToggle.setAttribute('aria-expanded', nav.classList.contains('active') ? 'true' : 'false');
      });
    }
  }

  /* =========
     ì´ˆê¸° ë¡œë“œ
     ========= */
  (function init(){
    bindEvents();
    loadHomeChunk();
    renderNavList();
    // ì´ˆê¸° íˆìŠ¤í† ë¦¬ ìƒíƒœ
    history.replaceState({ page: 'home' }, '', location.pathname);

    // handle existing hash (direct link)
    handleHashOnLoadOrChange();

    // infinite-scroll: load more if near bottom on initial render
    setTimeout(()=>{ onScrollHandler(); }, 400);
  })();

  /* =========
     ë³´ì¡° ìœ í‹¸: UIì—ì„œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë”ë¯¸ í•¨ìˆ˜ë“¤(ë¬¸ì„œí™”ìš©)
     ========= */

  /* End of script */
  </script>

  <!--
    ===================================================================
    ë°°í¬ ì•ˆë‚´ (ë¬¸ì„œí™”)
    - ì´ íŒŒì¼ì€ ì •ì  HTMLë¡œ ë™ì‘í•˜ë©°, WordPress API í˜¸ì¶œì€ Netlify Functions
      (í”„ë¡œì íŠ¸: netlify/functions/wpProxy.js) ë¥¼ í†µí•´ ëŒ€ë¦¬ í˜¸ì¶œí•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.
    - netlify/functions/wpProxy.js ì˜ˆì‹œ:
      export async function handler(event, context) {
        const WP_SITE = "impactceo0.wordpress.com";
        const ACCESS_TOKEN = process.env.WP_TOKEN;
        const path = event.queryStringParameters.path;
        if (!path) return { statusCode:400, body: JSON.stringify({ error: "Missing path" }) };
        const url = `https://public-api.wordpress.com/wp/v2/sites/${WP_SITE}/${path}`;
        try {
          const res = await fetch(url, { headers: { "Authorization": `Bearer ${ACCESS_TOKEN}` }});
          const data = await res.text();
          return { statusCode: res.status, headers: { "Content-Type": "application/json" }, body: data };
        } catch (err) { return { statusCode:500, body: JSON.stringify({ error: err.message }) }; }
      }
    - Netlify Dashboard > Site settings > Environment variablesì— WP_TOKEN ì¶”ê°€ í•„ìš”
    - logo.png íŒŒì¼ì„ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ë°°ì¹˜
    ===================================================================
  -->
</body>
</html>
