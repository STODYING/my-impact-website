<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IMPACT â€“ MAKE A IMPACT</title>
  <meta name="description" content="Innovation Management Passion Acceleration Creativity Technology">

  <link rel="icon" href="logo.png" type="image/png">
  
  <link rel="apple-touch-icon" href="logo.png">
  <link rel="apple-touch-icon" sizes="152x152" href="logo.png">
  <link rel="apple-touch-icon" sizes="180x180" href="logo.png">
  <link rel="apple-touch-icon" sizes="167x167" href="logo.png">
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="IMPACT">

  <style>
  *, *::before, *::after { box-sizing: border-box; }
  html, body { height: 100%; }
  body {
    margin: 0;
    font-family: "Noto Sans KR", "Apple SD Gothic Neo", "Segoe UI", Roboto, Arial, sans-serif;
    background: #f6f7f9;
    color: #111;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    scroll-behavior: smooth;
    overscroll-behavior-y: contain;
    -webkit-tap-highlight-color: transparent;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  
  body.dark-mode {
    background: #1a1a1a;
    color: #e0e0e0;
  }
  
  body.dark-mode .header {
    background: #2a2a2a;
    border-bottom-color: rgba(255,255,255,0.1);
  }
  
  body.dark-mode .card,
  body.dark-mode .btn {
    background: #2a2a2a;
    border-color: rgba(255,255,255,0.1);
    color: #e0e0e0;
  }
  
  body.dark-mode .card h3,
  body.dark-mode .category-title {
    color: #fff;
  }
  
  body.dark-mode .nav-overlay {
    background: rgba(42,42,42,0.98);
  }
  
  body.dark-mode .nav-list li {
    color: #e0e0e0;
  }
  
  body.dark-mode .category-overlay,
  body.dark-mode .post-overlay,
  body.dark-mode .search-overlay,
  body.dark-mode .about-page,
  body.dark-mode .editors-overlay,
  body.dark-mode .newsletter-overlay,
  body.dark-mode .terms-overlay,
  body.dark-mode .privacy-overlay {
    background: #1a1a1a;
    color: #e0e0e0;
  }
  
  body.dark-mode .to-top {
    background: #2a2a2a;
    color: #fff;
  }
  
  body.dark-mode .post-content {
    color: #e0e0e0;
  }
  
  body.dark-mode .meta,
  body.dark-mode .category-sub,
  body.dark-mode .editor-bio,
  body.dark-mode .post-meta-info {
    color: #aaa !important;
  }
  
  body.dark-mode .newsletter-page p {
    color: #aaa;
  }
  
  body.dark-mode .newsletter-form {
    background: #2a2a2a;
  }
  
  body.dark-mode input,
  body.dark-mode select {
    background: #333;
    color: #e0e0e0;
    border-color: rgba(255,255,255,0.2);
  }
  
  a { color: inherit; text-decoration: none; }
  img { display: block; max-width: 100%; height: auto; }

  input[type="search"]::-webkit-search-cancel-button { cursor: pointer; }

  .wrap { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
  .hidden { display:none !important; }
  
  .progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    width: 0%;
    height: 3px;
    background: linear-gradient(90deg, #2e8b57, #1f7a6f);
    z-index: 9999;
    transition: width 0.1s ease;
    display: none;
  }
  
  .progress-bar.active {
    display: block;
  }

  header.header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1200;
    background: #fff;
    border-bottom: 1px solid rgba(0,0,0,0.06);
    backdrop-filter: blur(6px);
    transition: transform 0.3s ease, opacity 0.3s ease;
  }
  
  header.header.hide {
    transform: translateY(-100%);
    opacity: 0;
  }
  
  .header-inner {
    height: 72px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    max-width:1400px;
    margin:0 auto;
    padding: 0 20px;
  }
  .brand { display:flex; gap:12px; align-items:center; }
  .brand .logo {
    display:flex;
    gap:8px;
    align-items:center;
    font-weight:900;
    font-size:26px;
    letter-spacing:1px;
    color:#111;
    cursor:pointer;
    transition: opacity 0.2s ease;
  }
  .brand .logo:hover {
    opacity: 0.7;
  }
  .brand .logo small { font-size:11px; color:#777; font-weight:800; display:block; line-height:1; }
  .header-actions { display:flex; gap:8px; align-items:center; }

  .btn {
    border-radius:10px;
    background:#fff;
    padding:8px 12px;
    border:1px solid rgba(0,0,0,0.08);
    font-weight:700;
    font-size:14px;
    cursor:pointer;
    transition: all 0.3s ease;
  }
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  .btn:active { transform: translateY(1px); }
  .btn.primary {
    background: linear-gradient(135deg,#2e8b57,#1f7a6f);
    color:#fff;
    border:none;
  }
  
  .icon-btn {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    padding: 0;
  }

  .nav-overlay {
    position: fixed;
    top: 0;
    right: -50%;
    width: 50%;
    height: 100vh;
    background: rgba(255,255,255,0.98);
    z-index: 2200;
    transition: right 0.4s cubic-bezier(.2,.9,.2,1), visibility 0s 0.4s, opacity 0.4s;
    display: flex;
    flex-direction: column;
    padding: 64px 40px;
    box-shadow: -6px 0 40px rgba(0,0,0,0.08);
    visibility: hidden;
    opacity: 0;
  }
  .nav-overlay.active { 
    right: 0; 
    visibility: visible;
    opacity: 1;
    transition: right 0.4s cubic-bezier(.2,.9,.2,1), visibility 0s, opacity 0.4s;
  }
  .nav-close {
    position:absolute; 
    top:28px; 
    right:28px;
    background:none; 
    border:none; 
    font-size:32px; 
    cursor:pointer;
    color: #111;
    z-index: 2300;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    border-radius: 50%;
  }
  .nav-close:hover {
    background: rgba(0,0,0,0.05);
    transform: rotate(90deg);
  }
  .nav-search { display:flex; align-items:center; gap:10px; margin-bottom:36px; }
  .nav-search input[type="search"] {
    flex:1; border:none; border-bottom:2px solid #111; padding:10px 8px; outline:none; font-weight:700; font-size:16px;
    background:transparent;
  }
  .nav-list { list-style:none; padding:0; margin:0 0 24px; display:flex; flex-direction:column; gap:18px; }
  .nav-list li { font-size:28px; font-weight:900; cursor:pointer; color:#111; transition: color .16s ease; }
  .nav-list li:hover { color:#2e8b57; }

  .nav-footer-links { margin-top:auto; display:flex; gap:12px; align-items:center; font-weight:800; }
  .nav-footer-links a { color:#111; font-size:13px; cursor:pointer; }

  @media (max-width: 680px) {
    .nav-overlay { 
      left:0; 
      right:-100%; 
      width:100%; 
      padding:36px 20px; 
      box-shadow:none; 
    }
    .nav-overlay.active { right:0; left:0; }
    .nav-list li { font-size:22px; }
    .nav-close {
      top: 20px;
      right: 20px;
    }
  }

  .home {
    max-width:1400px;
    margin: 100px auto 28px;
    display:flex;
    flex-direction:column;
    gap:40px;
    padding: 0 20px 60px;
  }

  .magazine-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }
  
  .magazine-row.reverse {
    grid-template-columns: 1fr 1fr;
  }
  
  .magazine-large {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    min-height: 500px;
    background: #eee;
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  .magazine-large:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
  }
  
  .magazine-large .hero {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  
  .magazine-large .hero-overlay {
    position: absolute;
    inset: auto 0 0 0;
    padding: 32px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,0.75));
    color: #fff;
  }
  
  .magazine-large .hero-title {
    margin: 0;
    font-size: 32px;
    font-weight: 900;
    line-height: 1.2;
  }
  
  .magazine-small-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }
  
  .card {
    background: #fff;
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid rgba(0,0,0,0.06);
    transition: box-shadow 0.3s ease, transform 0.3s ease;
    cursor: pointer;
    position: relative;
    z-index: 1;
  }
  
  .card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.1);
  }
  
  .card .thumb {
    width: 100%;
    height: 220px;
    overflow: hidden;
    background: #efefef;
  }
  
  .card .thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  
  .card .card-body {
    padding: 20px;
  }
  
  .card h3 {
    font-size: 18px;
    font-weight: 900;
    margin: 0 0 12px;
    color: #111;
    line-height: 1.4;
  }
  
  .card .meta {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #666;
    font-size: 13px;
  }

  .cat-badge { 
    display: inline-block; 
    padding: 6px 10px; 
    border-radius: 6px; 
    font-weight: 800; 
    font-size: 12px; 
    color: #fff; 
    margin-bottom: 8px;
  }

  .hero-cats { 
    position: absolute; 
    right: 16px; 
    bottom: 16px; 
    display: flex; 
    gap: 6px; 
  }

  .cat-tech{ background:#1e90ff; }
  .cat-eat{ background:#ff6347; }
  .cat-style{ background:#32cd32; }
  .cat-culture{ background:#8a2be2; }
  .cat-life{ background:#ffa500; color:#000; }
  .cat-editors-pick{ background:#ff1493; }

  .category-overlay, .post-overlay, .search-overlay, .about-page, .editors-overlay, .newsletter-overlay, .terms-overlay, .privacy-overlay {
    display:none;
    position:fixed;
    inset:0;
    background:#fff;
    z-index:1800;
    overflow:auto;
    padding:28px;
    animation: overlayIn .3s ease;
  }
  .post-overlay {
    z-index:1900;
  }
  .category-overlay.active, .post-overlay.active, .search-overlay.active, .about-page.active, .editors-overlay.active, .newsletter-overlay.active, .terms-overlay.active, .privacy-overlay.active { display:block; }
  @keyframes overlayIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }

  .category-top { 
    display:flex; 
    justify-content:space-between; 
    align-items:center; 
    gap:12px; 
    border-bottom:1px solid rgba(0,0,0,0.06); 
    padding-bottom:12px; 
  }
  .category-title { font-size:24px; font-weight:900; color:#111; }
  .category-sub { font-size:13px; color:#666; margin-top:4px; }
  .category-grid { 
    margin-top:18px; 
    display:grid; 
    gap:18px; 
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); 
    padding:20px 0 80px; 
  }

  .post-article { 
    margin:0 auto; 
    max-width:900px; 
  }
  
  .post-header {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 32px;
    margin-bottom: 32px;
    align-items: start;
  }
  
  .post-thumbnail {
    width: 100%;
    border-radius: 12px;
    overflow: hidden;
  }
  
  .post-thumbnail img {
    width: 100%;
    height: auto;
    display: block;
  }
  
  .post-info h1 {
    font-size: 32px;
    font-weight: 900;
    margin: 0 0 16px;
    color: #111;
    line-height: 1.3;
  }
  
  .post-meta-info {
    display: flex;
    flex-direction: column;
    gap: 8px;
    color: #666;
    font-size: 14px;
  }
  
  .post-meta-info .meta-row {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .post-meta-info .author-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: cover;
  }
  
  @media (max-width: 768px) {
    .post-header {
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    .post-thumbnail {
      max-width: 400px;
      margin: 0 auto;
    }
  }
  
  .post-content { 
    color: #222; 
    line-height: 1.9; 
    font-size: 16px;
  }
  
  .post-content p {
    margin: 1.5em 0;
  }
  
  .post-content img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 24px 0;
    border-radius: 8px;
  }
  
  .related-posts {
    margin-top: 60px;
    padding-top: 40px;
    border-top: 2px solid rgba(0,0,0,0.1);
  }
  
  .related-posts h3 {
    font-size: 24px;
    font-weight: 900;
    margin-bottom: 24px;
  }
  
  .related-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
  }

  .search-bar { 
    display:flex; 
    align-items:center; 
    background:#fff; 
    border-radius:50px; 
    box-shadow:0 6px 20px rgba(0,0,0,0.06); 
    padding:6px 10px; 
    gap:8px; 
  }
  .search-bar input[type="search"] { 
    flex:1; 
    border:none; 
    outline:none; 
    font-size:16px; 
    padding:12px 14px; 
    border-radius:50px; 
  }
  .search-bar .close-btn { 
    background:none; 
    border:none; 
    font-size:28px; 
    cursor:pointer; 
    color:#666; 
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s ease;
  }
  .search-bar .close-btn:hover {
    background: rgba(0,0,0,0.05);
    transform: rotate(90deg);
  }

  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    margin: 40px 0;
    flex-wrap: wrap;
  }
  
  .pagination button {
    min-width: 40px;
    height: 40px;
    border: 1px solid rgba(0,0,0,0.1);
    background: #fff;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    transition: all 0.3s ease;
  }
  
  .pagination button:hover {
    background: #f0f0f0;
    transform: translateY(-2px);
  }
  
  .pagination button.active {
    background: linear-gradient(135deg,#2e8b57,#1f7a6f);
    color: #fff;
    border: none;
  }
  
  .pagination button:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .to-top {
    position: fixed; 
    right:22px; 
    bottom:22px; 
    width:52px; 
    height:52px; 
    border-radius:50%; 
    background:#fff; 
    color:#000;
    display:flex; 
    align-items:center; 
    justify-content:center; 
    font-size:22px; 
    z-index:2500; 
    box-shadow:0 12px 30px rgba(0,0,0,0.08); 
    opacity:0; 
    transform:translateY(20px); 
    transition:all .3s cubic-bezier(.2,.9,.2,1);
    border:1px solid rgba(0,0,0,0.06);
    cursor: pointer;
  }
  .to-top.show { opacity:1; transform:translateY(0); }
  .to-top:hover {
    transform: translateY(-4px);
    box-shadow: 0 16px 40px rgba(0,0,0,0.12);
  }

  footer.site-footer { 
    background:#111; 
    color:#eee; 
    padding:40px 20px; 
    margin-top:60px; 
  }
  .footer-inner { 
    max-width:1400px; 
    margin:0 auto; 
    display:flex; 
    justify-content:space-between; 
    gap:20px; 
    align-items:flex-start; 
    flex-wrap:wrap; 
  }
  .footer-brand { 
    font-size:40px; 
    font-weight:900; 
    color:#fff; 
    font-style:italic; 
  }
  .footer-links a { 
    color:#ddd; 
    cursor:pointer;
    display: block;
    font-weight: 800;
    margin-bottom: 8px;
    transition: color 0.3s ease;
  }
  .footer-links a:hover {
    color: #2e8b57;
  }
  
  .theme-toggle {
    margin-top: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .theme-toggle button {
    background: #2a2a2a;
    border: 1px solid rgba(255,255,255,0.2);
    color: #fff;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    font-size: 13px;
    transition: all 0.3s ease;
  }
  
  .theme-toggle button:hover {
    background: #3a3a3a;
    transform: translateY(-2px);
  }

  .editors-grid { 
    display:grid; 
    grid-template-columns: repeat(auto-fill, minmax(160px,1fr)); 
    gap:16px; 
    padding:18px 0; 
  }
  .editor-card { 
    background:#fff; 
    border-radius:12px; 
    padding:12px; 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    gap:10px; 
    text-align:center; 
    border:1px solid rgba(0,0,0,0.06); 
    cursor:pointer; 
    transition: all 0.3s ease;
  }
  .editor-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.1);
  }
  .editor-avatar { 
    width:84px; 
    height:84px; 
    border-radius:50%; 
    object-fit:cover; 
  }
  .editor-name { 
    font-weight:800; 
    font-size:15px; 
  }
  .editor-bio { 
    font-size:12px; 
    color:#666; 
  }
  
  .newsletter-page {
    max-width: 800px;
    margin: 0 auto;
    padding: 40px 20px;
  }
  
  .newsletter-page h2 {
    font-size: 36px;
    font-weight: 900;
    margin-bottom: 20px;
  }
  
  .newsletter-page p {
    font-size: 16px;
    line-height: 1.8;
    color: #555;
    margin-bottom: 30px;
  }
  
  .newsletter-form {
    background: #f9f9f9;
    padding: 32px;
    border-radius: 12px;
    margin-bottom: 40px;
  }
  
  .form-group {
    margin-bottom: 20px;
  }
  
  .form-group label {
    display: block;
    font-weight: 700;
    margin-bottom: 8px;
    font-size: 14px;
  }
  
  .form-group input,
  .form-group select {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 8px;
    font-size: 15px;
    outline: none;
    transition: border-color 0.3s ease;
  }
  
  .form-group input:focus,
  .form-group select:focus {
    border-color: #2e8b57;
  }
  
  .checkbox-group {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
  }
  
  .checkbox-group input[type="checkbox"] {
    width: auto;
    cursor: pointer;
  }
  
  .checkbox-group label {
    margin: 0;
    font-weight: 400;
    cursor: pointer;
  }
  
  .terms-link {
    color: #2e8b57;
    text-decoration: underline;
    cursor: pointer;
    transition: opacity 0.3s ease;
  }
  
  .terms-link:hover {
    opacity: 0.7;
  }
  
  .submit-btn {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg,#2e8b57,#1f7a6f);
    color: #fff;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(46,139,87,0.3);
  }
  
  .submit-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }
  
  .terms-content {
    max-height: 600px;
    overflow-y: auto;
    line-height: 1.8;
    color: #333;
  }
  
  .terms-content h3 {
    margin-top: 24px;
    margin-bottom: 12px;
    font-weight: 800;
  }
  
  .terms-content ul {
    margin: 12px 0;
    padding-left: 24px;
  }

  @media (max-width: 1100px) {
    .magazine-row {
      grid-template-columns: 1fr;
    }
    
    .magazine-small-grid {
      grid-template-columns: 1fr;
    }
  }
  
  @media (max-width: 680px) {
    .home {
      margin-top: 80px;
    }
    
    .magazine-large {
      min-height: 400px;
    }
    
    .magazine-large .hero-title {
      font-size: 24px;
    }
    
    .card .thumb {
      height: 200px;
    }
    
    .magazine-small-grid {
      grid-template-columns: 1fr;
    }
  }
  
  @media (min-width: 1400px) {
    .magazine-row {
      gap: 24px;
    }
    
    .magazine-small-grid {
      gap: 24px;
    }
  }
  </style>
</head>
<body>

  <div class="progress-bar" id="progressBar"></div>

  <header class="header" id="siteHeader">
    <div class="header-inner wrap">
      <div class="brand">
        <div class="logo" id="logoBtn" onclick="scrollToTop()">
          <img src="logo.png" alt="IMPACT logo" style="width:36px;height:36px;border-radius:8px;object-fit:cover;">
          <div>
            <div style="line-height:1">IMPACT</div>
            <small>MAKE A IMPACT</small>
          </div>
        </div>
      </div>

      <div class="header-actions">
        <button class="btn icon-btn" id="topSearchBtn" onclick="openNavlessSearch()">ğŸ”</button>
        <button class="btn icon-btn" onclick="ui.toggleNav()">â˜°</button>
      </div>
    </div>
  </header>

  <aside class="nav-overlay" id="navOverlay">
    <button class="nav-close" onclick="ui.toggleNav(true)">âœ•</button>
    <div style="display:flex;flex-direction:column;gap:12px;">
      <div class="nav-search">
        <span style="font-size:18px">ğŸ”</span>
        <input type="search" id="globalNavSearch" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">
      </div>

      <ul class="nav-list" id="navList"></ul>

      <div class="nav-footer-links">
        <a href="javascript:void(0)" onclick="ui.toggleNav(true); router.openAbout()">ABOUT</a>
        <a href="javascript:void(0)" onclick="ui.toggleNav(true); router.openEditors()">EDITORS</a>
        <a href="javascript:void(0)" onclick="ui.toggleNav(true); router.openNewsletter()">NEWSLETTER</a>
        <a href="https://www.instagram.com/ceo_impact_official" target="_blank" rel="noopener">INSTAGRAM</a>
      </div>
    </div>
  </aside>

  <main class="home" id="home">
    <div id="rowsContainer"></div>
    <div id="homeLoading" style="text-align:center;color:#666;padding:36px 0">ë¡œë”© ì¤‘...</div>
    <div class="pagination" id="homePagination"></div>
  </main>

  <section class="category-overlay" id="categoryOverlay">
    <div class="wrap">
      <div class="category-top">
        <div>
          <div class="category-title" id="categoryOverlayTitle">CATEGORY</div>
          <div class="category-sub" id="categoryOverlaySubtitle">ì¹´í…Œê³ ë¦¬ ì„¤ëª…</div>
        </div>
        <div>
          <button class="btn" onclick="router.closeCategory()">âœ•</button>
        </div>
      </div>

      <div class="category-grid" id="categoryGrid"></div>
      <div id="categoryLoading" style="text-align:center;color:#666;padding:28px 0"></div>
      <div class="pagination" id="categoryPagination"></div>
    </div>
  </section>

  <section class="editors-overlay" id="editorsOverlay">
    <div class="wrap">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;border-bottom:1px solid rgba(0,0,0,0.06);padding-bottom:14px;">
        <div>
          <h2 style="font-size:24px;margin:0">EDITORS</h2>
          <div style="color:#666;font-size:13px">IMPACTì— ì°¸ì—¬í•˜ëŠ” ì—ë””í„° ëª©ë¡ê³¼ ê° ì—ë””í„°ì˜ ì‘ì„± ê¸€ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
        </div>
        <div>
          <button class="btn" onclick="router.closeEditors()">âœ•</button>
        </div>
      </div>

      <div id="editorsGridWrapper" style="margin-top:18px;">
        <div id="editorsGrid" class="editors-grid"></div>
        <div id="editorsLoading" style="text-align:center;color:#666;padding:18px 0"></div>
      </div>

      <div id="editorProfileSection" style="display:none;margin-top:18px;">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;">
          <div>
            <div id="editorProfileName" style="font-weight:900;font-size:20px"></div>
            <div id="editorProfileBio" style="color:#666;font-size:13px"></div>
          </div>
          <div>
            <button class="btn" onclick="showEditorsList()">ëª©ë¡ìœ¼ë¡œ</button>
          </div>
        </div>
        <div id="editorPostsGrid" class="category-grid"></div>
        <div id="editorPostsLoading" style="text-align:center;color:#666;padding:18px 0"></div>
      </div>
    </div>
  </section>

  <article class="post-overlay" id="postOverlay">
    <div style="width:100%;max-width:1200px;margin:0 auto;">
      <div style="display:flex;justify-content:flex-end;gap:12px;margin-bottom:18px">
        <button class="btn" onclick="router.closePost()">âœ•</button>
      </div>
      <div class="post-article" id="postArticle"></div>
    </div>
  </article>

  <section class="search-overlay" id="searchOverlay">
    <div class="wrap" style="max-width:1100px;margin:0 auto;">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px">
        <div style="flex:1">
          <div class="search-bar">
            <input type="search" class="search-input" id="searchInputTop" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥ (Enterë¡œ ê²€ìƒ‰)">
            <button type="button" class="close-btn" onclick="ui.closeSearch()">âœ•</button>
          </div>
        </div>
      </div>

      <div id="searchResults" class="category-grid"></div>
    </div>
  </section>

  <section class="about-page" id="aboutPageSection">
    <div class="wrap about-content">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:18px">
        <div>
          <h2 style="font-size:32px;margin-bottom:10px">ABOUT</h2>
          <div style="color:#333;font-size:15px;line-height:1.8">
            <p><strong>IMPACT</strong>ëŠ” í˜„ & ì „ KAIST IP-CEO í•™ìƒë“¤ê³¼ POSTECH CEO í•™ìƒë“¤ì´ í•¨ê»˜ ì‘ì„±í•˜ëŠ” ì‹¬ì¸µ ì½˜í…ì¸  í”Œë«í¼ì…ë‹ˆë‹¤.</p>
            <p>í•™ìƒ ì €ìë“¤ì˜ ê²½í—˜ê³¼ ë¶„ì„ì„ ë°”íƒ•ìœ¼ë¡œ ê¸°ìˆ Â·ê²½ì˜Â·ì°½ì˜ì„±ì„ ê²°í•©í•œ ê¸€ì„ ì œê³µí•©ë‹ˆë‹¤. í˜„ì¥ì˜ ì‚¬ë¡€, ë°ì´í„° ì¸í…”ë¦¬ì „ìŠ¤, ê¹Šì´ ìˆëŠ” ë¶„ì„ì„ í†µí•´ ë…ìì—ê²Œ í†µì°°ì„ ì „ë‹¬í•©ë‹ˆë‹¤.</p>
          </div>
          <div style="margin-top:20px"><button class="btn" onclick="router.closeAbout()">âœ•</button></div>
        </div>
      </div>
    </div>
  </section>

  <section class="newsletter-overlay" id="newsletterOverlay">
    <div class="wrap">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
        <h2 style="font-size:28px;margin:0">NEWSLETTER</h2>
        <button class="btn" onclick="router.closeNewsletter()">âœ•</button>
      </div>
      
      <div class="newsletter-page">
        <p>IMPACTì˜ ìµœì‹  ì½˜í…ì¸ ì™€ ë…ì  ì¸ì‚¬ì´íŠ¸ë¥¼ ì´ë©”ì¼ë¡œ ë°›ì•„ë³´ì„¸ìš”. ë§¤ì£¼ ì—„ì„ ëœ ê¸°ì‚¬ì™€ ë¶„ì„ì„ ì „ë‹¬í•´ë“œë¦½ë‹ˆë‹¤.</p>
        
        <form class="newsletter-form" id="newsletterForm" onsubmit="handleNewsletterSubmit(event)">
          <div class="form-group">
            <label for="email">ì´ë©”ì¼ ì£¼ì†Œ *</label>
            <input type="email" id="email" name="email" required placeholder="your@email.com">
          </div>
          
          <div class="form-group">
            <label for="name">ì´ë¦„</label>
            <input type="text" id="name" name="name" placeholder="í™ê¸¸ë™">
          </div>
          
          <div class="form-group">
            <label for="interests">ê´€ì‹¬ ì¹´í…Œê³ ë¦¬</label>
            <select id="interests" name="interests">
              <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
              <option value="tech">TECH</option>
              <option value="eat">EAT</option>
              <option value="style">STYLE</option>
              <option value="culture">CULTURE</option>
              <option value="life">LIFE</option>
              <option value="all">ì „ì²´</option>
            </select>
          </div>
          
          <div class="checkbox-group">
            <input type="checkbox" id="terms" name="terms" required>
            <label for="terms">
              <span class="terms-link" onclick="showTerms(event)">ì´ìš© ì•½ê´€</span> ë° 
              <span class="terms-link" onclick="showPrivacy(event)">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</span>ì— ë™ì˜í•©ë‹ˆë‹¤ *
            </label>
          </div>
          
          <div class="checkbox-group">
            <input type="checkbox" id="marketing" name="marketing">
            <label for="marketing">ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹ ì— ë™ì˜í•©ë‹ˆë‹¤ (ì„ íƒ)</label>
          </div>
          
          <button type="submit" class="submit-btn">ë‰´ìŠ¤ë ˆí„° êµ¬ë…í•˜ê¸°</button>
        </form>
      </div>
    </div>
  </section>

  <section class="terms-overlay" id="termsOverlay">
    <div class="wrap" style="max-width:900px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
        <h2 style="font-size:28px;margin:0">ì´ìš© ì•½ê´€</h2>
        <button class="btn" onclick="closeTerms()">âœ•</button>
      </div>
      
      <div class="terms-content">
        <h3>ì œ1ì¡° (ëª©ì )</h3>
        <p>ë³¸ ì•½ê´€ì€ IMPACT(ì´í•˜ "ì‚¬ì´íŠ¸")ê°€ ì œê³µí•˜ëŠ” ë‰´ìŠ¤ë ˆí„° ì„œë¹„ìŠ¤ì˜ ì´ìš©ê³¼ ê´€ë ¨í•˜ì—¬ ì‚¬ì´íŠ¸ì™€ ì´ìš©ì ê°„ì˜ ê¶Œë¦¬, ì˜ë¬´ ë° ì±…ì„ì‚¬í•­ì„ ê·œì •í•¨ì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.</p>
        
        <h3>ì œ2ì¡° (ì„œë¹„ìŠ¤ì˜ ë‚´ìš©)</h3>
        <p>ì‚¬ì´íŠ¸ëŠ” ì´ìš©ìì—ê²Œ ê¸°ìˆ , ê²½ì˜, ë¬¸í™” ë“± ë‹¤ì–‘í•œ ë¶„ì•¼ì˜ ì½˜í…ì¸ ë¥¼ ì´ë©”ì¼ì„ í†µí•´ ì œê³µí•©ë‹ˆë‹¤.</p>
        
        <h3>ì œ3ì¡° (ì´ìš©ìì˜ ì˜ë¬´)</h3>
        <p>ì´ìš©ìëŠ” ì •í™•í•œ ì •ë³´ë¥¼ ì œê³µí•´ì•¼ í•˜ë©°, íƒ€ì¸ì˜ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ë¬´ë‹¨ìœ¼ë¡œ ì‚¬ìš©í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.</p>
        
        <h3>ì œ4ì¡° (ì„œë¹„ìŠ¤ì˜ ì¤‘ë‹¨)</h3>
        <p>ì‚¬ì´íŠ¸ëŠ” ì‹œìŠ¤í…œ ì ê²€, ê¸°ìˆ ì  ë¬¸ì œ ë“±ìœ¼ë¡œ ì¸í•´ ì„œë¹„ìŠ¤ë¥¼ ì¼ì‹œì ìœ¼ë¡œ ì¤‘ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        
        <h3>ì œ5ì¡° (êµ¬ë… í•´ì§€)</h3>
        <p>ì´ìš©ìëŠ” ì–¸ì œë“ ì§€ ë‰´ìŠ¤ë ˆí„° êµ¬ë…ì„ í•´ì§€í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë©”ì¼ í•˜ë‹¨ì˜ êµ¬ë… ì·¨ì†Œ ë§í¬ë¥¼ í†µí•´ ê°„í¸í•˜ê²Œ í•´ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        
        <h3>ì œ6ì¡° (ê°œì¸ì •ë³´ ë³´í˜¸)</h3>
        <p>ì‚¬ì´íŠ¸ëŠ” ì´ìš©ìì˜ ê°œì¸ì •ë³´ë¥¼ ê´€ê³„ ë²•ë ¹ì— ë”°ë¼ ì•ˆì „í•˜ê²Œ ë³´í˜¸í•˜ë©°, ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì— ëª…ì‹œëœ ëª©ì  ì™¸ì˜ ìš©ë„ë¡œ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
        
        <h3>ì œ7ì¡° (ì €ì‘ê¶Œ)</h3>
        <p>ì‚¬ì´íŠ¸ê°€ ì œê³µí•˜ëŠ” ëª¨ë“  ì½˜í…ì¸ ì˜ ì €ì‘ê¶Œì€ IMPACTì— ìˆìœ¼ë©°, ë¬´ë‹¨ ë³µì œ ë° ë°°í¬ë¥¼ ê¸ˆì§€í•©ë‹ˆë‹¤.</p>
        
        <h3>ì œ8ì¡° (ë©´ì±…ì‚¬í•­)</h3>
        <p>ì‚¬ì´íŠ¸ëŠ” ì²œì¬ì§€ë³€, ë¶ˆê°€í•­ë ¥ì  ì‚¬ìœ ë¡œ ì¸í•œ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ì— ëŒ€í•´ ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
        
        <h3>ì œ9ì¡° (ì•½ê´€ì˜ ë³€ê²½)</h3>
        <p>ì‚¬ì´íŠ¸ëŠ” í•„ìš”í•œ ê²½ìš° ë³¸ ì•½ê´€ì„ ë³€ê²½í•  ìˆ˜ ìˆìœ¼ë©°, ë³€ê²½ëœ ì•½ê´€ì€ ê³µì§€ í›„ 7ì¼ ì´í›„ë¶€í„° íš¨ë ¥ì´ ë°œìƒí•©ë‹ˆë‹¤.</p>
        
        <h3>ì œ10ì¡° (ë¶„ìŸ í•´ê²°)</h3>
        <p>ë³¸ ì•½ê´€ê³¼ ê´€ë ¨ëœ ë¶„ìŸì€ ëŒ€í•œë¯¼êµ­ ë²•ë¥ ì— ë”°ë¼ í•´ê²°í•˜ë©°, ê´€í•  ë²•ì›ì€ ì‚¬ì´íŠ¸ ì†Œì¬ì§€ ë²•ì›ìœ¼ë¡œ í•©ë‹ˆë‹¤.</p>
      </div>
    </div>
  </section>

  <section class="privacy-overlay" id="privacyOverlay">
    <div class="wrap" style="max-width:900px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
        <h2 style="font-size:28px;margin:0">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</h2>
        <button class="btn" onclick="closePrivacy()">âœ•</button>
      </div>
      
      <div class="terms-content">
        <h3>1. ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´ í•­ëª©</h3>
        <p>IMPACTëŠ” ë‰´ìŠ¤ë ˆí„° ì„œë¹„ìŠ¤ ì œê³µì„ ìœ„í•´ ë‹¤ìŒì˜ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤:</p>
        <ul>
          <li>í•„ìˆ˜í•­ëª©: ì´ë©”ì¼ ì£¼ì†Œ</li>
          <li>ì„ íƒí•­ëª©: ì´ë¦„, ê´€ì‹¬ ì¹´í…Œê³ ë¦¬</li>
        </ul>
        
        <h3>2. ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš© ëª©ì </h3>
        <p>ìˆ˜ì§‘ëœ ê°œì¸ì •ë³´ëŠ” ë‹¤ìŒì˜ ëª©ì ìœ¼ë¡œë§Œ ì´ìš©ë©ë‹ˆë‹¤:</p>
        <ul>
          <li>ë‰´ìŠ¤ë ˆí„° ë°œì†¡</li>
          <li>ì„œë¹„ìŠ¤ ê°œì„  ë° ë§ì¶¤í˜• ì½˜í…ì¸  ì œê³µ</li>
          <li>ì´ìš©ì ë¬¸ì˜ ì‘ëŒ€</li>
        </ul>
        
        <h3>3. ê°œì¸ì •ë³´ì˜ ë³´ìœ  ë° ì´ìš© ê¸°ê°„</h3>
        <p>ì´ìš©ìì˜ ê°œì¸ì •ë³´ëŠ” êµ¬ë… í•´ì§€ ì‹œê¹Œì§€ ë³´ìœ ë˜ë©°, í•´ì§€ ì¦‰ì‹œ íŒŒê¸°ë©ë‹ˆë‹¤.</p>
        
        <h3>4. ê°œì¸ì •ë³´ì˜ ì œ3ì ì œê³µ</h3>
        <p>IMPACTëŠ” ì´ìš©ìì˜ ë™ì˜ ì—†ì´ ê°œì¸ì •ë³´ë¥¼ ì œ3ìì—ê²Œ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ë‹¤ìŒì˜ ê²½ìš°ëŠ” ì˜ˆì™¸ë¡œ í•©ë‹ˆë‹¤:</p>
        <ul>
          <li>ë²•ë ¹ì— ì˜í•´ ìš”êµ¬ë˜ëŠ” ê²½ìš°</li>
          <li>ìˆ˜ì‚¬ ëª©ì ìœ¼ë¡œ ë²•ë ¹ì— ì •í•´ì§„ ì ˆì°¨ì™€ ë°©ë²•ì— ë”°ë¼ ìš”ì²­ì´ ìˆëŠ” ê²½ìš°</li>
        </ul>
        
        <h3>5. ê°œì¸ì •ë³´ì˜ íŒŒê¸° ì ˆì°¨ ë° ë°©ë²•</h3>
        <p>ì´ìš©ìê°€ êµ¬ë…ì„ í•´ì§€í•˜ë©´ ê°œì¸ì •ë³´ëŠ” ì¦‰ì‹œ íŒŒê¸°ë©ë‹ˆë‹¤. ì „ìì  íŒŒì¼ í˜•íƒœëŠ” ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ë°©ë²•ìœ¼ë¡œ ì‚­ì œí•˜ë©°, ì¢…ì´ ë¬¸ì„œëŠ” ë¶„ì‡„ ë˜ëŠ” ì†Œê°í•©ë‹ˆë‹¤.</p>
        
        <h3>6. ì´ìš©ìì˜ ê¶Œë¦¬</h3>
        <p>ì´ìš©ìëŠ” ì–¸ì œë“ ì§€ ìì‹ ì˜ ê°œì¸ì •ë³´ë¥¼ ì¡°íšŒí•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìœ¼ë©°, êµ¬ë… í•´ì§€ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°œì¸ì •ë³´ ì¡°íšŒ ë° ìˆ˜ì •ì€ ì´ë©”ì¼(ceo.impact.official@gmail.com)ë¡œ ìš”ì²­ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
        
        <h3>7. ê°œì¸ì •ë³´ ë³´í˜¸ì±…ì„ì</h3>
        <p>ê°œì¸ì •ë³´ ë³´í˜¸ì±…ì„ì: IMPACT ìš´ì˜íŒ€<br>
        ì´ë©”ì¼: ceo.impact.official@gmail.com</p>
        
        <h3>8. ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ë³€ê²½</h3>
        <p>ë³¸ ë°©ì¹¨ì€ ë²•ë ¹ ë° ì„œë¹„ìŠ¤ ë³€ê²½ì‚¬í•­ì„ ë°˜ì˜í•˜ê¸° ìœ„í•´ ìˆ˜ì •ë  ìˆ˜ ìˆìœ¼ë©°, ë³€ê²½ ì‹œ ì›¹ì‚¬ì´íŠ¸ë¥¼ í†µí•´ ê³µì§€í•©ë‹ˆë‹¤.</p>
        
        <h3>9. ì¿ í‚¤ì˜ ìš´ìš©</h3>
        <p>IMPACTëŠ” ì‚¬ìš©ì ê²½í—˜ ê°œì„ ì„ ìœ„í•´ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ìš©ìëŠ” ë¸Œë¼ìš°ì € ì„¤ì •ì„ í†µí•´ ì¿ í‚¤ ì‚¬ìš©ì„ ê±°ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        
        <p style="margin-top:24px;"><strong>ì‹œí–‰ì¼ì: 2025ë…„ 1ì›” 1ì¼</strong></p>
      </div>
    </div>
  </section>

  <button class="to-top" id="toTopBtn" onclick="scrollToTop()">â†‘</button>

  <footer class="site-footer">
    <div class="wrap footer-inner">
      <div>
        <div class="footer-brand">IMPACT</div>
        <div style="margin-top:10px;color:#ddd;font-size:13px">ê´‘ê³  ì œíœ´ ë¬¸ì˜ | <a href="mailto:ceo.impact.official@gmail.com">ceo.impact.official@gmail.com</a></div>
        <div style="color:#ddd;font-size:13px;margin-top:6px">ë³´ë„ìë£Œ | <a href="mailto:ceo.impact.official@gmail.com">ceo.impact.official@gmail.com</a></div>
      </div>

      <div class="footer-links">
        <a href="javascript:void(0)" onclick="router.openAbout()">ABOUT</a>
        <a href="javascript:void(0)" onclick="router.openEditors()">EDITORS</a>
        <a href="javascript:void(0)" onclick="router.openNewsletter()">NEWSLETTER</a>
        <a href="https://www.instagram.com/ceo_impact_official" target="_blank" rel="noopener">INSTAGRAM</a>
      </div>

      <div class="footer-right">
        <div style="font-weight:800;color:#fff">IMPACT CEO. ALL RIGHTS RESERVED.</div>
        <div class="theme-toggle">
          <button onclick="toggleTheme()">ğŸŒ“ í…Œë§ˆ ë³€ê²½</button>
        </div>
      </div>
    </div>
  </footer>

  <template id="cardTpl">
    <article class="card">
      <div class="thumb"><img src="" alt=""></div>
      <div class="card-body">
        <div class="cat-row"></div>
        <h3 class="title"></h3>
        <div class="meta">
          <img class="author-avatar" src="" alt="" style="width:36px;height:36px;border-radius:50%;object-fit:cover;">
          <div>
            <div class="author-name"></div>
            <div class="date" style="font-size:12px;color:#777"></div>
          </div>
        </div>
      </div>
    </article>
  </template>

  <template id="editorTpl">
    <div class="editor-card">
      <img class="editor-avatar" src="" alt="">
      <div class="editor-name"></div>
      <div class="editor-bio"></div>
    </div>
  </template>

<script>
const WP_SITE = "impactceo0.wordpress.com";
const HOME_PER_PAGE = 20;
const CATEGORIES = {
  "tech": 318,
  "eat": 123073,
  "style": 2286,
  "culture": 1098,
  "life": 124,
  "editors-pick": 259543
};
const NAV_ORDER = ["TECH","EAT","STYLE","CULTURE","LIFE","EDITORS' PICK"];

const state = {
  homePage: 1,
  homeTotal: 0,
  categoryPage: 1,
  categoryTotal: 0,
  currentCategory: '',
  postsCache: {},
  editorsList: [],
  editorsLoaded: false,
  lastScrollY: 0,
  scrollingDown: false,
  currentPostId: null
};

function api(path) {
  const p = path.includes('_embed') ? path : (path + (path.includes('?') ? '&' : '?') + '_embed');
  return `/.netlify/functions/wpProxy?path=${encodeURIComponent(p)}`;
}

function formatDate(dstr) {
  try {
    const d = new Date(dstr);
    return `${d.getFullYear()}. ${String(d.getMonth()+1).padStart(2,'0')}. ${String(d.getDate()).padStart(2,'0')}.`;
  } catch(e) { return ''; }
}

function placeholderDataURI(w=600,h=400,txt='No Image') {
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}'><rect width='100%' height='100%' fill='#efefef'/><text x='50%' y='50%' fill='#aaa' font-size='20' text-anchor='middle' dominant-baseline='middle'>${txt}</text></svg>`;
  return 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(svg);
}

function pickCategoryClass(nameOrSlug) {
  if(!nameOrSlug) return '';
  const s = String(nameOrSlug).toLowerCase();
  if(s.includes('tech') || s.includes('technology')) return 'cat-tech';
  if(s.includes('eat')) return 'cat-eat';
  if(s.includes('style')) return 'cat-style';
  if(s.includes('culture')) return 'cat-culture';
  if(s.includes('life')) return 'cat-life';
  if(s.includes('editor') || s.includes('editors')) return 'cat-editors-pick';
  return '';
}

function stripTags(str='') {
  return str.replace(/<\/?[^>]+(>|$)/g, "");
}

function scrollToTop() {
  window.scrollTo({top: 0, behavior: 'smooth'});
}

function toggleTheme() {
  document.body.classList.toggle('dark-mode');
  const isDark = document.body.classList.contains('dark-mode');
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
}

if(localStorage.getItem('theme') === 'dark') {
  document.body.classList.add('dark-mode');
}

let ticking = false;
window.addEventListener('scroll', () => {
  if(!ticking) {
    window.requestAnimationFrame(() => {
      const toTop = document.getElementById('toTopBtn');
      if(window.scrollY > 300) toTop.classList.add('show'); 
      else toTop.classList.remove('show');
      
      const header = document.getElementById('siteHeader');
      const currentScrollY = window.scrollY;
      
      if(currentScrollY > state.lastScrollY && currentScrollY > 100) {
        header.classList.add('hide');
      } else {
        header.classList.remove('hide');
      }
      
      state.lastScrollY = currentScrollY;
      
      const progressBar = document.getElementById('progressBar');
      if(document.getElementById('postOverlay').classList.contains('active')) {
        const postOverlay = document.getElementById('postOverlay');
        const winScroll = postOverlay.scrollTop;
        const height = postOverlay.scrollHeight - postOverlay.clientHeight;
        const scrolled = height > 0 ? (winScroll / height) * 100 : 0;
        progressBar.style.width = scrolled + '%';
        progressBar.classList.add('active');
      } else {
        progressBar.classList.remove('active');
      }
      
      ticking = false;
    });
    ticking = true;
  }
});

document.getElementById('postOverlay').addEventListener('scroll', () => {
  if(!ticking) {
    window.requestAnimationFrame(() => {
      const progressBar = document.getElementById('progressBar');
      const postOverlay = document.getElementById('postOverlay');
      const winScroll = postOverlay.scrollTop;
      const height = postOverlay.scrollHeight - postOverlay.clientHeight;
      const scrolled = height > 0 ? (winScroll / height) * 100 : 0;
      progressBar.style.width = scrolled + '%';
      ticking = false;
    });
    ticking = true;
  }
});

function renderNavList() {
  const navList = document.getElementById('navList');
  navList.innerHTML = '';
  NAV_ORDER.forEach(item => {
    const li = document.createElement('li');
    li.textContent = item;
    li.addEventListener('click', () => {
      ui.toggleNav(true);
      const slug = item.toLowerCase().replace(/'/g,'').replace(/\s/g,'-');
      if(CATEGORIES[slug]) {
        router.openCategory(slug);
      }
    });
    navList.appendChild(li);
  });
}

function createCardNode(post) {
  const tpl = document.getElementById('cardTpl');
  const node = tpl.content.firstElementChild.cloneNode(true);

  const imgEl = node.querySelector('.thumb img');
  let thumbUrl = '';
  try {
    thumbUrl = post._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';
  } catch(e) { thumbUrl = ''; }
  imgEl.src = thumbUrl || placeholderDataURI(1200,800,'No Image');
  imgEl.alt = (post.title && post.title.rendered) ? stripTags(post.title.rendered) : 'thumb';

  node.querySelector('.title').innerHTML = post.title && post.title.rendered ? post.title.rendered : 'ì œëª© ì—†ìŒ';

  const avatarImg = node.querySelector('.author-avatar');
  const authorNameEl = node.querySelector('.author-name');
  const dateEl = node.querySelector('.date');

  if(post._embedded && post._embedded.author && post._embedded.author[0]) {
    const a = post._embedded.author[0];
    const avatarUrl = a.avatar_urls ? (a.avatar_urls['48']||a.avatar_urls['24']||'') : '';
    avatarImg.src = avatarUrl || placeholderDataURI(96,96,'U');
    avatarImg.alt = a.name || 'author';
    authorNameEl.textContent = a.name || 'ìµëª…';
  } else {
    avatarImg.src = placeholderDataURI(96,96,'U');
    authorNameEl.textContent = 'ìµëª…';
  }
  dateEl.textContent = formatDate(post.date);

  const catRow = node.querySelector('.cat-row');
  catRow.innerHTML = '';
  if(post._embedded && post._embedded['wp:term'] && post._embedded['wp:term'][0]) {
    const cats = post._embedded['wp:term'][0];
    cats.forEach(c => {
      if(c && c.name) {
        const span = document.createElement('span');
        span.className = 'cat-badge';
        span.textContent = c.name;
        const cls = pickCategoryClass(c.slug || c.name);
        if(cls) span.classList.add(cls);
        else span.style.background = '#666';
        catRow.appendChild(span);
      }
    });
  }

  node.addEventListener('click', ()=> openPostOverlayById(post.id));
  return node;
}

async function loadHomeChunk(page = 1) {
  const loadingEl = document.getElementById('homeLoading');
  loadingEl.textContent = 'ë¡œë”© ì¤‘...';

  try {
    const res = await fetch(api(`posts?per_page=${HOME_PER_PAGE}&page=${page}`));
    if(!res.ok) throw new Error('Failed to load');
    
    const totalPages = parseInt(res.headers.get('X-WP-TotalPages') || '1');
    state.homeTotal = totalPages;
    
    const posts = await res.json();
    if(!Array.isArray(posts) || posts.length === 0) {
      loadingEl.textContent = 'ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.';
      return;
    }

    posts.forEach(p => state.postsCache[p.id] = p);

    const container = document.getElementById('rowsContainer');
    container.innerHTML = '';

    for(let i = 0; i < posts.length; i += 5) {
      const group = posts.slice(i, i + 5);
      const row = document.createElement('div');
      row.className = 'magazine-row';
      
      const isEven = Math.floor(i / 5) % 2 === 0;
      if(!isEven) {
        row.classList.add('reverse');
      }

      if(group[0]) {
        const largePost = group[0];
        const largeDiv = document.createElement('div');
        largeDiv.className = 'magazine-large';
        
        let heroUrl = largePost._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';
        largeDiv.innerHTML = `
          <img class="hero" src="${heroUrl || placeholderDataURI(1200,800,'No Image')}" alt="hero">
          <div class="hero-overlay">
            <h2 class="hero-title">${largePost.title?.rendered || 'ì œëª© ì—†ìŒ'}</h2>
            <div style="display:flex;align-items:center;gap:10px">
              <div class="hero-author" style="font-weight:800;color:#fff">${largePost._embedded?.author?.[0]?.name || 'ìµëª…'}</div>
              <div class="hero-date" style="color:#eee;opacity:.9">${formatDate(largePost.date)}</div>
            </div>
          </div>
        `;
        
        const catWrap = document.createElement('div');
        catWrap.className = 'hero-cats';
        const firstCat = largePost._embedded?.['wp:term']?.[0]?.[0];
        if(firstCat) {
          const span = document.createElement('span');
          span.className = 'cat-badge ' + pickCategoryClass(firstCat.slug || firstCat.name);
          span.textContent = firstCat.name;
          catWrap.appendChild(span);
        }
        largeDiv.appendChild(catWrap);
        
        largeDiv.addEventListener('click', () => openPostOverlayById(largePost.id));
        
        if(isEven) {
          row.appendChild(largeDiv);
        }
      }

      const smallGrid = document.createElement('div');
      smallGrid.className = 'magazine-small-grid';
      group.slice(1, 5).forEach(post => {
        if(post) {
          const card = createCardNode(post);
          smallGrid.appendChild(card);
        }
      });
      
      if(isEven) {
        row.appendChild(smallGrid);
      } else {
        row.appendChild(smallGrid);
        if(group[0]) {
          const largePost = group[0];
          const largeDiv = document.createElement('div');
          largeDiv.className = 'magazine-large';
          
          let heroUrl = largePost._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';
          largeDiv.innerHTML = `
            <img class="hero" src="${heroUrl || placeholderDataURI(1200,800,'No Image')}" alt="hero">
            <div class="hero-overlay">
              <h2 class="hero-title">${largePost.title?.rendered || 'ì œëª© ì—†ìŒ'}</h2>
              <div style="display:flex;align-items:center;gap:10px">
                <div class="hero-author" style="font-weight:800;color:#fff">${largePost._embedded?.author?.[0]?.name || 'ìµëª…'}</div>
                <div class="hero-date" style="color:#eee;opacity:.9">${formatDate(largePost.date)}</div>
              </div>
            </div>
          `;
          
          const catWrap = document.createElement('div');
          catWrap.className = 'hero-cats';
          const firstCat = largePost._embedded?.['wp:term']?.[0]?.[0];
          if(firstCat) {
            const span = document.createElement('span');
            span.className = 'cat-badge ' + pickCategoryClass(firstCat.slug || firstCat.name);
            span.textContent = firstCat.name;
            catWrap.appendChild(span);
          }
          largeDiv.appendChild(catWrap);
          
          largeDiv.addEventListener('click', () => openPostOverlayById(largePost.id));
          row.appendChild(largeDiv);
        }
      }

      container.appendChild(row);
    }

    renderPagination('homePagination', page, totalPages, (p) => {
      state.homePage = p;
      loadHomeChunk(p);
      scrollToTop();
    });

    loadingEl.textContent = '';
  } catch(err) {
    console.error(err);
    loadingEl.textContent = 'ë¡œë”© ì‹¤íŒ¨';
  }
}

function renderPagination(containerId, currentPage, totalPages, onPageClick) {
  const container = document.getElementById(containerId);
  if(!container) return;
  
  container.innerHTML = '';
  
  if(totalPages <= 1) return;
  
  const prevBtn = document.createElement('button');
  prevBtn.textContent = 'â€¹';
  prevBtn.disabled = currentPage === 1;
  prevBtn.onclick = () => onPageClick(currentPage - 1);
  container.appendChild(prevBtn);
  
  const startPage = Math.max(1, currentPage - 2);
  const endPage = Math.min(totalPages, currentPage + 2);
  
  if(startPage > 1) {
    const firstBtn = document.createElement('button');
    firstBtn.textContent = '1';
    firstBtn.onclick = () => onPageClick(1);
    container.appendChild(firstBtn);
    
    if(startPage > 2) {
      const dots = document.createElement('span');
      dots.textContent = 'â€¢â€¢â€¢';
      dots.style.padding = '0 8px';
      container.appendChild(dots);
    }
  }
  
  for(let i = startPage; i <= endPage; i++) {
    const btn = document.createElement('button');
    btn.textContent = i;
    if(i === currentPage) btn.classList.add('active');
    btn.onclick = () => onPageClick(i);
    container.appendChild(btn);
  }
  
  if(endPage < totalPages) {
    if(endPage < totalPages - 1) {
      const dots = document.createElement('span');
      dots.textContent = 'â€¢â€¢â€¢';
      dots.style.padding = '0 8px';
      container.appendChild(dots);
    }
    
    const lastBtn = document.createElement('button');
    lastBtn.textContent = totalPages;
    lastBtn.onclick = () => onPageClick(totalPages);
    container.appendChild(lastBtn);
  }
  
  const nextBtn = document.createElement('button');
  nextBtn.textContent = 'â€º';
  nextBtn.disabled = currentPage === totalPages;
  nextBtn.onclick = () => onPageClick(currentPage + 1);
  container.appendChild(nextBtn);
}

async function loadCategory(slug, page = 1) {
  state.currentCategory = slug;
  state.categoryPage = page;
  
  const overlay = document.getElementById('categoryOverlay');
  overlay.classList.add('active');
  document.getElementById('categoryOverlayTitle').textContent = slug.toUpperCase();
  
  const descriptions = {
    'tech': 'ê¸°ìˆ ê³¼ í˜ì‹ ì— ëŒ€í•œ ì‹¬ì¸µ ë¶„ì„',
    'eat': 'ìŒì‹ê³¼ ì™¸ì‹ ë¬¸í™” íƒêµ¬',
    'style': 'íŒ¨ì…˜ê³¼ ë¼ì´í”„ìŠ¤íƒ€ì¼ íŠ¸ë Œë“œ',
    'culture': 'ë¬¸í™”ì™€ ì˜ˆìˆ ì— ëŒ€í•œ ì¸ì‚¬ì´íŠ¸',
    'life': 'ì¼ìƒê³¼ ì‚¶ì— ëŒ€í•œ ì´ì•¼ê¸°',
    'editors-pick': 'ì—ë””í„°ê°€ ì„ ì •í•œ ì¶”ì²œ ì½˜í…ì¸ '
  };
  document.getElementById('categoryOverlaySubtitle').textContent = descriptions[slug] || 'ì¹´í…Œê³ ë¦¬ ì„¤ëª…';
  
  const grid = document.getElementById('categoryGrid');
  grid.innerHTML = '';
  document.getElementById('categoryLoading').textContent = 'ë¡œë”© ì¤‘...';

  try {
    const catId = CATEGORIES[slug];
    if(!catId) { 
      document.getElementById('categoryLoading').textContent = 'ì•Œ ìˆ˜ ì—†ëŠ” ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤.'; 
      return; 
    }
    
    const res = await fetch(api(`posts?categories=${catId}&per_page=20&page=${page}`));
    if(!res.ok) throw new Error('Failed');
    
    const totalPages = parseInt(res.headers.get('X-WP-TotalPages') || '1');
    state.categoryTotal = totalPages;
    
    const posts = await res.json();
    if(Array.isArray(posts)) {
      posts.forEach(p => {
        state.postsCache[p.id] = p;
        const card = createCardNode(p);
        grid.appendChild(card);
      });
    }
    
    renderPagination('categoryPagination', page, totalPages, (p) => {
      loadCategory(slug, p);
      document.getElementById('categoryOverlay').scrollTop = 0;
    });
    
    document.getElementById('categoryLoading').textContent = '';
  } catch(e) {
    console.error(e);
    document.getElementById('categoryLoading').textContent = 'ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨';
  }
}

async function loadEditors() {
  if(state.editorsLoaded) return;
  document.getElementById('editorsLoading').textContent = 'ë¡œë”© ì¤‘...';
  try {
    const res = await fetch(api(`users?per_page=100`));
    if(!res.ok) throw new Error('editors api fail ' + res.status);
    const users = await res.json();
    state.editorsList = Array.isArray(users) ? users : [];
    renderEditorsGrid();
    state.editorsLoaded = true;
    document.getElementById('editorsLoading').textContent = '';
  } catch(e) {
    console.error(e);
    document.getElementById('editorsLoading').textContent = 'ì—ë””í„° ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
  }
}

function renderEditorsGrid() {
  const wrap = document.getElementById('editorsGrid');
  wrap.innerHTML = '';
  const tpl = document.getElementById('editorTpl');
  state.editorsList.forEach(u => {
    const node = tpl.content.firstElementChild.cloneNode(true);
    const img = node.querySelector('.editor-avatar');
    img.src = (u.avatar_urls && (u.avatar_urls['96']||u.avatar_urls['48']||u.avatar_urls['24'])) ? (u.avatar_urls['96']||u.avatar_urls['48']||u.avatar_urls['24']) : placeholderDataURI(96,96,'U');
    img.alt = u.name || u.slug || 'editor';
    node.querySelector('.editor-name').textContent = u.name || u.slug || 'unknown';
    node.querySelector('.editor-bio').textContent = u.description || '';
    node.addEventListener('click', () => openEditorProfile(u));
    wrap.appendChild(node);
  });
}

async function openEditorProfile(user) {
  if(!user || !user.id) return;
  document.getElementById('editorsGridWrapper').style.display = 'none';
  const section = document.getElementById('editorProfileSection');
  section.style.display = 'block';
  document.getElementById('editorProfileName').textContent = user.name || user.slug || '';
  document.getElementById('editorProfileBio').textContent = user.description || '';
  const grid = document.getElementById('editorPostsGrid');
  grid.innerHTML = '';
  document.getElementById('editorPostsLoading').textContent = 'ë¡œë”© ì¤‘...';

  try {
    const res = await fetch(api(`posts?author=${user.id}&per_page=50`));
    const posts = await res.json();
    if(Array.isArray(posts)) {
      posts.forEach(p => {
        state.postsCache[p.id] = p;
        const card = createCardNode(p);
        grid.appendChild(card);
      });
    }
    document.getElementById('editorPostsLoading').textContent = '';
    history.pushState({page:'editor', id:user.id}, '', `#editor-${user.id}`);
  } catch(e) {
    console.error(e);
    document.getElementById('editorPostsLoading').textContent = 'ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨';
  }
}

function showEditorsList() {
  document.getElementById('editorProfileSection').style.display = 'none';
  document.getElementById('editorsGridWrapper').style.display = 'block';
  history.pushState({page:'editors'}, '', '#editors');
}

async function loadRelatedPosts(categories, currentPostId) {
  if(!categories || categories.length === 0) return [];
  
  try {
    const catId = categories[0].id;
    const res = await fetch(api(`posts?categories=${catId}&per_page=8&exclude=${currentPostId}`));
    if(!res.ok) return [];
    const posts = await res.json();
    return Array.isArray(posts) ? posts.slice(0, 4) : [];
  } catch(e) {
    console.error(e);
    return [];
  }
}

async function openPostOverlayById(id) {
  if(!id) return;
  
  state.currentPostId = id;
  
  const currentHash = window.location.hash;
  const fromPage = currentHash.startsWith('#search') ? 'search' : 
                   currentHash.startsWith('#category-') ? 'category' : 
                   currentHash.startsWith('#editors') || currentHash.startsWith('#editor-') ? 'editors' : 'home';

  let fromHash = currentHash;
  if(fromPage === 'home') {
    fromHash = '';
  }

  const cached = state.postsCache[id];
  if(cached && cached.content && cached.content.rendered) {
    renderPostOverlay(cached, fromPage, fromHash);
    return;
  }
  try {
    const res = await fetch(api(`posts/${id}`));
    if(!res.ok) throw new Error('post fetch failed ' + res.status);
    const post = await res.json();
    if(!(post._embedded && post._embedded.author)) {
      const res2 = await fetch(api(`posts/${id}?_embed`));
      if(res2.ok) {
        const post2 = await res2.json();
        state.postsCache[id] = post2;
        renderPostOverlay(post2, fromPage, fromHash);
        return;
      }
    }
    state.postsCache[id] = post;
    renderPostOverlay(post, fromPage, fromHash);
  } catch(e) {
    console.error(e);
    alert('í¬ìŠ¤íŠ¸ ë¡œë“œ ì‹¤íŒ¨');
  }
}

async function renderPostOverlay(post, fromPage, fromHash) {
  const overlay = document.getElementById('postOverlay');
  const article = document.getElementById('postArticle');

  const title = post.title && post.title.rendered ? post.title.rendered : 'ì œëª© ì—†ìŒ';
  const authorName = (post._embedded && post._embedded.author && post._embedded.author[0] && post._embedded.author[0].name) ? post._embedded.author[0].name : 'ìµëª…';
  const avatar = (post._embedded && post._embedded.author && post._embedded.author[0] && post._embedded.author[0].avatar_urls) ? (post._embedded.author[0].avatar_urls['96'] || post._embedded.author[0].avatar_urls['48']) : '';
  const categories = (post._embedded && post._embedded['wp:term'] && post._embedded['wp:term'][0]) ? post._embedded['wp:term'][0].map(t=>t.name).join(', ') : '-';
  const dateStr = formatDate(post.date);
  const contentHTML = post.content && post.content.rendered ? post.content.rendered : (post.excerpt && post.excerpt.rendered ? post.excerpt.rendered : '');

  const featuredUrl = post._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';

  article.innerHTML = `
    <div class="post-header">
      ${featuredUrl ? `
        <div class="post-thumbnail">
          <img src="${featuredUrl}" alt="featured image">
        </div>
      ` : ''}
      <div class="post-info">
        <h1>${title}</h1>
        <div class="post-meta-info">
          <div class="meta-row">
            <img src="${avatar || placeholderDataURI(96,96,'U')}" alt="author" class="author-avatar">
            <strong>${authorName}</strong>
          </div>
          <div class="meta-row">
            <span>ğŸ“… ${dateStr}</span>
          </div>
          <div class="meta-row">
            <span>ğŸ·ï¸ ${categories}</span>
          </div>
        </div>
      </div>
    </div>
    <div class="post-content">${contentHTML}</div>
    <div id="relatedPostsContainer"></div>
  `;

  article.querySelectorAll('.post-content img').forEach(img=>{
    img.style.maxWidth = '100%';
    img.style.height = 'auto';
    img.style.display = 'block';
    img.style.margin = '12px 0';
  });

  try {
    const allNodes = Array.from(article.querySelectorAll('.post-content *'));
    allNodes.forEach(el => {
      if (el && el.textContent && el.textContent.trim().includes('ì´ ê¸€ ê³µìœ í•˜ê¸°')) {
        el.remove();
      }
    });
  } catch(e) { }

  try {
    article.querySelectorAll('.updated, time[itemprop="dateModified"], [data-modified], .post-modified, .modified-date').forEach(el => el.remove());
  } catch(e) { }

  const postCategories = post._embedded?.['wp:term']?.[0] || [];
  if(postCategories.length > 0) {
    const relatedPosts = await loadRelatedPosts(postCategories, post.id);
    if(relatedPosts.length > 0) {
      const relatedContainer = document.getElementById('relatedPostsContainer');
      const relatedSection = document.createElement('div');
      relatedSection.className = 'related-posts';
      relatedSection.innerHTML = '<h3>ê°™ì€ ì¹´í…Œê³ ë¦¬ì˜ ë‹¤ë¥¸ ê¸€</h3><div class="related-grid" id="relatedGrid"></div>';
      relatedContainer.appendChild(relatedSection);
      
      const relatedGrid = document.getElementById('relatedGrid');
      relatedPosts.forEach(p => {
        state.postsCache[p.id] = p;
        const card = createCardNode(p);
        relatedGrid.appendChild(card);
      });
    }
  }

  overlay.classList.add('active');
  document.body.style.overflow = 'hidden';
  overlay.scrollTop = 0;
  
  const progressBar = document.getElementById('progressBar');
  progressBar.classList.add('active');
  progressBar.style.width = '0%';
  
  history.pushState({
    page:'post', 
    id: post.id,
    fromPage: fromPage,
    fromHash: fromHash
  }, '', `#post-${post.id}`);
}

async function doSearch(q) {
  if(!q || !q.trim()) return;
  
  closeAllOverlays();
  document.getElementById('searchOverlay').classList.add('active');
  document.body.style.overflow = '';
  
  history.pushState({page:'search', query:q}, '', `#search?q=${encodeURIComponent(q)}`);

  const results = document.getElementById('searchResults');
  results.innerHTML = '';
  try {
    const res = await fetch(api(`posts?search=${encodeURIComponent(q)}&per_page=20`));
    if(!res.ok) throw new Error('search failed ' + res.status);
    const posts = await res.json();
    if(!Array.isArray(posts) || posts.length === 0) {
      results.innerHTML = '<div style="padding:20px;color:#666">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
      return;
    }
    posts.forEach(p => {
      state.postsCache[p.id] = p;
      const card = createCardNode(p);
      results.appendChild(card);
    });
  } catch(e) {
    console.error(e);
    results.innerHTML = '<div style="padding:20px;color:#d00">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
  }
}

const ui = {
  toggleNav(close) {
    const ov = document.getElementById('navOverlay');
    if(close === true) {
      ov.classList.remove('active');
    } else if(close === false) {
      ov.classList.add('active');
    } else {
      ov.classList.toggle('active');
    }
    const expanded = ov.classList.contains('active');
    document.body.style.overflow = expanded ? 'hidden' : '';
  },
  closeSearch() {
    document.getElementById('searchOverlay').classList.remove('active');
    document.body.style.overflow = '';
  }
};

const router = {
  goHome() {
    closeAllOverlays();
    document.body.style.overflow = '';
    history.pushState({page:'home'}, '', location.pathname.split('#')[0]);
  },
  openCategory(slug) {
    closeAllOverlays();
    loadCategory(slug, 1);
    document.body.style.overflow = '';
    history.pushState({page:'category', slug:slug}, '', `#category-${slug}`);
  },
  closeCategory() {
    document.getElementById('categoryOverlay').classList.remove('active');
    router.goHome();
  },
  closePost() {
    document.getElementById('postOverlay').classList.remove('active');
    document.body.style.overflow = '';
    
    const progressBar = document.getElementById('progressBar');
    progressBar.classList.remove('active');
    
    const currentState = history.state;
    
    if(currentState && currentState.fromHash) {
      history.pushState({
        page: currentState.fromPage
      }, '', currentState.fromHash);
      
      if(currentState.fromPage === 'search') {
        const urlParams = new URLSearchParams(currentState.fromHash.split('?')[1]);
        const query = urlParams.get('q');
        if(query) {
          document.getElementById('searchInputTop').value = query;
          document.getElementById('searchOverlay').classList.add('active');
          document.body.style.overflow = '';
        }
      } else if(currentState.fromPage === 'category') {
        const slug = currentState.fromHash.replace('#category-', '').split('?')[0];
        if(slug) {
          document.getElementById('categoryOverlay').classList.add('active');
          document.body.style.overflow = '';
        }
      } else if(currentState.fromPage === 'editors') {
        document.getElementById('editorsOverlay').classList.add('active');
        document.body.style.overflow = '';
      }
    } else {
      router.goHome();
    }
  },
  openAbout() {
    closeAllOverlays();
    document.getElementById('aboutPageSection').classList.add('active');
    document.body.style.overflow = '';
    history.pushState({page:'about'}, '', '#about');
  },
  closeAbout() {
    document.getElementById('aboutPageSection').classList.remove('active');
    router.goHome();
  },
  openEditors() {
    closeAllOverlays();
    document.getElementById('editorsOverlay').classList.add('active');
    document.body.style.overflow = '';
    loadEditors();
    history.pushState({page:'editors'}, '', '#editors');
  },
  closeEditors() {
    document.getElementById('editorsOverlay').classList.remove('active');
    router.goHome();
  },
  openNewsletter() {
    closeAllOverlays();
    document.getElementById('newsletterOverlay').classList.add('active');
    document.body.style.overflow = '';
    history.pushState({page:'newsletter'}, '', '#newsletter');
  },
  closeNewsletter() {
    document.getElementById('newsletterOverlay').classList.remove('active');
    router.goHome();
  }
};

function closeAllOverlays() {
  ['categoryOverlay','postOverlay','searchOverlay','aboutPageSection','editorsOverlay','newsletterOverlay','termsOverlay','privacyOverlay'].forEach(id=>{
    const el = document.getElementById(id);
    if(el) { el.classList.remove('active'); }
  });
  if(!document.getElementById('navOverlay').classList.contains('active')) {
    document.body.style.overflow = '';
  }
  
  const progressBar = document.getElementById('progressBar');
  progressBar.classList.remove('active');
}

function routeFromURL() {
  const hash = window.location.hash;
  
  if(!hash || hash === '#' || hash.startsWith('#home')) {
    return;
  }
  
  document.body.style.overflow = '';
  
  if(hash.startsWith('#post-')) {
    const postId = hash.replace('#post-', '').split('?')[0];
    if(postId && !isNaN(postId)) {
      openPostOverlayById(parseInt(postId));
      document.body.style.overflow = 'hidden';
    }
  } else if(hash.startsWith('#category-')) {
    const slug = hash.replace('#category-', '').split('?')[0];
    if(slug) {
      loadCategory(slug, 1);
    }
  } else if(hash.startsWith('#search')) {
    const urlParams = new URLSearchParams(hash.split('?')[1]);
    const query = urlParams.get('q');
    if(query) {
      document.getElementById('searchInputTop').value = query;
      doSearch(query);
    } else {
      openNavlessSearch();
    }
  } else if(hash.startsWith('#editor-')) {
    const editorId = hash.replace('#editor-', '').split('?')[0];
    if(editorId && !isNaN(editorId)) {
      router.openEditors();
      const checkAndOpen = () => {
        if (state.editorsLoaded) {
          openEditorProfile(state.editorsList.find(e => e.id === parseInt(editorId)));
        } else {
          setTimeout(checkAndOpen, 100);
        }
      };
      setTimeout(checkAndOpen, 300);
    }
  } else if(hash === '#editors') {
    router.openEditors();
  } else if(hash === '#about') {
    router.openAbout();
  } else if(hash === '#newsletter') {
    router.openNewsletter();
  }
}

function openNavlessSearch() {
  closeAllOverlays();
  document.getElementById('searchOverlay').classList.add('active');
  document.body.style.overflow = '';
  const input = document.getElementById('searchInputTop');
  if(input) input.focus();
  history.pushState({page:'search'}, '', '#search');
}

function handleNewsletterSubmit(e) {
  e.preventDefault();
  
  const formData = new FormData(e.target);
  const data = {
    email: formData.get('email'),
    name: formData.get('name'),
    interests: formData.get('interests'),
    terms: formData.get('terms') === 'on',
    marketing: formData.get('marketing') === 'on'
  };
  
  if(!data.terms) {
    alert('ì´ìš© ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  console.log('Newsletter subscription:', data);
  alert('ë‰´ìŠ¤ë ˆí„° êµ¬ë…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ê°ì‚¬í•©ë‹ˆë‹¤.');
  e.target.reset();
}

function showTerms(e) {
  e.preventDefault();
  e.stopPropagation();
  document.getElementById('termsOverlay').classList.add('active');
}

function closeTerms() {
  document.getElementById('termsOverlay').classList.remove('active');
}

function showPrivacy(e) {
  e.preventDefault();
  e.stopPropagation();
  document.getElementById('privacyOverlay').classList.add('active');
}

function closePrivacy() {
  document.getElementById('privacyOverlay').classList.remove('active');
}

document.addEventListener('DOMContentLoaded', () => {
  renderNavList();
  loadHomeChunk(1);
  
  routeFromURL();

  const topInput = document.getElementById('searchInputTop');
  if(topInput) {
    topInput.addEventListener('keydown', e => {
      if(e.key === 'Enter') {
        doSearch(e.target.value);
      } else if(e.key === 'Escape') {
        ui.closeSearch();
        router.goHome();
      }
    });
  }

  const globalNavSearch = document.getElementById('globalNavSearch');
  if(globalNavSearch) {
    globalNavSearch.addEventListener('keydown', e => {
      if(e.key === 'Enter') {
        const q = e.target.value;
        ui.toggleNav(true);
        openNavlessSearch();
        setTimeout(()=> { 
            const top = document.getElementById('searchInputTop'); 
            if(top) { 
                top.value = q; 
                if(q) doSearch(q); 
            } 
        }, 120);
      }
    });
  }

  window.addEventListener('popstate', (ev) => {
    const s = ev.state;
    
    closeAllOverlays();
    
    if(!s) {
      routeFromURL();
      return;
    }
    
    if(s.page === 'home') {
      document.body.style.overflow = '';
    } else if(s.page === 'post' && s.id) {
      openPostOverlayById(s.id);
      document.body.style.overflow = 'hidden';
    } else if(s.page === 'category' && s.slug) {
      loadCategory(s.slug, 1);
      document.body.style.overflow = '';
    } else if(s.page === 'search') {
      if(s.query) {
        document.getElementById('searchInputTop').value = s.query;
        doSearch(s.query);
      } else {
        openNavlessSearch();
      }
      document.body.style.overflow = '';
    } else if(s.page === 'editor' && s.id) {
      router.openEditors();
      document.body.style.overflow = '';
      const checkAndOpen = () => {
        if (state.editorsLoaded) {
          openEditorProfile(state.editorsList.find(e => e.id === s.id));
        } else {
          setTimeout(checkAndOpen, 100);
        }
      };
      setTimeout(checkAndOpen, 300);
    } else if(s.page === 'editors') {
      router.openEditors();
      document.body.style.overflow = '';
    } else if(s.page === 'about') {
      router.openAbout();
      document.body.style.overflow = '';
    } else if(s.page === 'newsletter') {
      router.openNewsletter();
      document.body.style.overflow = '';
    }
  });
});
</script>
</body>
</html>
