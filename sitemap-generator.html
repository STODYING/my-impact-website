<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sitemap Generator - IMPACT</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
      background: #f5f5f5;
      color: #333;
    }
    h1 {
      color: #ff6b35;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    button {
      background: linear-gradient(135deg, #ff6b35, #ff8c5a);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    #status {
      margin: 20px 0;
      padding: 15px;
      border-radius: 8px;
      font-weight: 500;
    }
    .info { background: #e3f2fd; color: #1565c0; }
    .success { background: #e8f5e9; color: #2e7d32; }
    .error { background: #ffebee; color: #c62828; }
    #output {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      max-height: 500px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .hidden { display: none; }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .stat-box {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    .stat-number {
      font-size: 32px;
      font-weight: 700;
      color: #ff6b35;
    }
    .stat-label {
      font-size: 14px;
      color: #666;
      margin-top: 5px;
    }
    .copy-btn {
      background: #4caf50;
      margin-top: 10px;
    }
    .download-btn {
      background: #2196f3;
      margin-top: 10px;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <h1>ğŸ—ºï¸ Sitemap Generator</h1>
  <p class="subtitle">WordPress APIì—ì„œ ëª¨ë“  ê²Œì‹œë¬¼ì„ ê°€ì ¸ì™€ sitemap.xmlì„ ìƒì„±í•©ë‹ˆë‹¤.</p>
  
  <div class="card">
    <h2>Sitemap ìƒì„±</h2>
    <p>ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìµœì‹  ê²Œì‹œë¬¼ì´ í¬í•¨ëœ sitemap.xmlì„ ìƒì„±í•˜ì„¸ìš”.</p>
    <button id="generateBtn" onclick="generateSitemap()">Sitemap ìƒì„±í•˜ê¸°</button>
    
    <div id="status" class="hidden"></div>
    
    <div id="statsContainer" class="hidden">
      <div class="stats">
        <div class="stat-box">
          <div class="stat-number" id="totalPosts">0</div>
          <div class="stat-label">ê²Œì‹œë¬¼ ìˆ˜</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="totalUrls">0</div>
          <div class="stat-label">ì´ URL ìˆ˜</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="fileSize">0 KB</div>
          <div class="stat-label">íŒŒì¼ í¬ê¸°</div>
        </div>
      </div>
    </div>
    
    <div id="outputContainer" class="hidden">
      <h3>ìƒì„±ëœ Sitemap XML</h3>
      <div id="output"></div>
      <button class="copy-btn" onclick="copySitemap()">ğŸ“‹ ë³µì‚¬í•˜ê¸°</button>
      <button class="download-btn" onclick="downloadSitemap()">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>
    </div>
  </div>
  
  <div class="card">
    <h2>ğŸ“ ì‚¬ìš© ë°©ë²•</h2>
    <ol>
      <li><strong>Sitemap ìƒì„±:</strong> ìœ„ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìµœì‹  sitemapì„ ìƒì„±í•©ë‹ˆë‹¤.</li>
      <li><strong>íŒŒì¼ ì €ì¥:</strong> ìƒì„±ëœ XMLì„ ë³µì‚¬í•˜ê±°ë‚˜ ë‹¤ìš´ë¡œë“œí•˜ì—¬ <code>sitemap.xml</code> íŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.</li>
      <li><strong>Google Search Console:</strong> <a href="https://search.google.com/search-console" target="_blank">Google Search Console</a>ì—ì„œ ì‚¬ì´íŠ¸ë¥¼ ë“±ë¡í•˜ê³  sitemap URLì„ ì œì¶œí•©ë‹ˆë‹¤.</li>
      <li><strong>Naver Search Advisor:</strong> <a href="https://searchadvisor.naver.com/" target="_blank">ë„¤ì´ë²„ ì„œì¹˜ì–´ë“œë°”ì´ì €</a>ì—ì„œë„ ë™ì¼í•˜ê²Œ ë“±ë¡í•©ë‹ˆë‹¤.</li>
    </ol>
  </div>

  <script>
    const API_BASE = 'https://impactceo.art/wp-json/wp/v2';
    let generatedXml = '';

    function setStatus(message, type = 'info') {
      const statusEl = document.getElementById('status');
      statusEl.className = type;
      statusEl.textContent = message;
      statusEl.classList.remove('hidden');
    }

    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toISOString().split('T')[0];
    }

    async function fetchAllPosts() {
      let allPosts = [];
      let page = 1;
      const perPage = 100;
      
      while (true) {
        try {
          const response = await fetch(`${API_BASE}/posts?per_page=${perPage}&page=${page}&_fields=id,slug,modified`);
          
          if (!response.ok) {
            if (response.status === 400) {
              // ë” ì´ìƒ í˜ì´ì§€ê°€ ì—†ìŒ
              break;
            }
            throw new Error(`API ì˜¤ë¥˜: ${response.status}`);
          }
          
          const posts = await response.json();
          
          if (posts.length === 0) break;
          
          allPosts = allPosts.concat(posts);
          
          setStatus(`ê²Œì‹œë¬¼ ë¡œë”© ì¤‘... (${allPosts.length}ê°œ)`, 'info');
          
          page++;
          
          // ì•ˆì „ì¥ì¹˜: ìµœëŒ€ 50í˜ì´ì§€
          if (page > 50) break;
          
        } catch (error) {
          console.error('ê²Œì‹œë¬¼ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
          break;
        }
      }
      
      return allPosts;
    }

    async function generateSitemap() {
      const btn = document.getElementById('generateBtn');
      btn.disabled = true;
      setStatus('ê²Œì‹œë¬¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'info');
      
      try {
        const posts = await fetchAllPosts();
        
        if (posts.length === 0) {
          setStatus('ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
          btn.disabled = false;
          return;
        }
        
        setStatus(`${posts.length}ê°œì˜ ê²Œì‹œë¬¼ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤. Sitemap ìƒì„± ì¤‘...`, 'info');
        
        // XML ìƒì„±
        let xml = `<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
        xmlns:news="http://www.google.com/schemas/sitemap-news/0.9"
        xmlns:xhtml="http://www.w3.org/1999/xhtml"
        xmlns:mobile="http://www.google.com/schemas/sitemap-mobile/1.0"
        xmlns:image="http://www.google.com/schemas/sitemap-image/1.1">
  
  <!-- í™ˆí˜ì´ì§€ -->
  <url>
    <loc>https://page.gensparksite.com/</loc>
    <lastmod>${formatDate(new Date())}</lastmod>
    <changefreq>daily</changefreq>
    <priority>1.0</priority>
  </url>
  
  <!-- About í˜ì´ì§€ -->
  <url>
    <loc>https://page.gensparksite.com/about</loc>
    <lastmod>${formatDate(new Date())}</lastmod>
    <changefreq>monthly</changefreq>
    <priority>0.8</priority>
  </url>
  
  <!-- Editors í˜ì´ì§€ -->
  <url>
    <loc>https://page.gensparksite.com/editors</loc>
    <lastmod>${formatDate(new Date())}</lastmod>
    <changefreq>weekly</changefreq>
    <priority>0.8</priority>
  </url>
  
  <!-- ê²€ìƒ‰ í˜ì´ì§€ -->
  <url>
    <loc>https://page.gensparksite.com/search</loc>
    <lastmod>${formatDate(new Date())}</lastmod>
    <changefreq>daily</changefreq>
    <priority>0.7</priority>
  </url>
  
  <!-- ì¹´í…Œê³ ë¦¬ í˜ì´ì§€ë“¤ -->
  <url>
    <loc>https://page.gensparksite.com/category/tech</loc>
    <lastmod>${formatDate(new Date())}</lastmod>
    <changefreq>daily</changefreq>
    <priority>0.9</priority>
  </url>
  
  <url>
    <loc>https://page.gensparksite.com/category/eat</loc>
    <lastmod>${formatDate(new Date())}</lastmod>
    <changefreq>daily</changefreq>
    <priority>0.9</priority>
  </url>
  
  <url>
    <loc>https://page.gensparksite.com/category/style</loc>
    <lastmod>${formatDate(new Date())}</lastmod>
    <changefreq>daily</changefreq>
    <priority>0.9</priority>
  </url>
  
  <url>
    <loc>https://page.gensparksite.com/category/culture</loc>
    <lastmod>${formatDate(new Date())}</lastmod>
    <changefreq>daily</changefreq>
    <priority>0.9</priority>
  </url>
  
  <url>
    <loc>https://page.gensparksite.com/category/life</loc>
    <lastmod>${formatDate(new Date())}</lastmod>
    <changefreq>daily</changefreq>
    <priority>0.9</priority>
  </url>
  
  <url>
    <loc>https://page.gensparksite.com/category/editors-pick</loc>
    <lastmod>${formatDate(new Date())}</lastmod>
    <changefreq>daily</changefreq>
    <priority>0.9</priority>
  </url>
  
  <!-- ê°œë³„ ê²Œì‹œë¬¼ë“¤ -->
`;
        
        // ê° ê²Œì‹œë¬¼ ì¶”ê°€
        posts.forEach(post => {
          xml += `  <url>
    <loc>https://page.gensparksite.com/post/${post.slug}</loc>
    <lastmod>${formatDate(post.modified)}</lastmod>
    <changefreq>weekly</changefreq>
    <priority>0.8</priority>
  </url>
  
`;
        });
        
        xml += `</urlset>`;
        
        generatedXml = xml;
        
        // ì¶œë ¥
        document.getElementById('output').textContent = xml;
        document.getElementById('outputContainer').classList.remove('hidden');
        
        // í†µê³„
        const totalUrls = posts.length + 11; // ê²Œì‹œë¬¼ + ê³ ì • í˜ì´ì§€ë“¤
        const fileSize = (new Blob([xml]).size / 1024).toFixed(2);
        
        document.getElementById('totalPosts').textContent = posts.length;
        document.getElementById('totalUrls').textContent = totalUrls;
        document.getElementById('fileSize').textContent = fileSize + ' KB';
        document.getElementById('statsContainer').classList.remove('hidden');
        
        setStatus(`âœ… Sitemapì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! (${totalUrls}ê°œ URL, ${fileSize} KB)`, 'success');
        
      } catch (error) {
        console.error('Sitemap ìƒì„± ì˜¤ë¥˜:', error);
        setStatus('âŒ Sitemap ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
      } finally {
        btn.disabled = false;
      }
    }

    function copySitemap() {
      const output = document.getElementById('output');
      const text = output.textContent;
      
      navigator.clipboard.writeText(text).then(() => {
        alert('âœ… Sitemapì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
      }).catch(err => {
        console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
        alert('âŒ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ì„ íƒí•˜ì—¬ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
      });
    }

    function downloadSitemap() {
      const blob = new Blob([generatedXml], { type: 'application/xml' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'sitemap.xml';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
